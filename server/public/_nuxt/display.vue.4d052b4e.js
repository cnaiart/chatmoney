import{_ as V}from"./index.vue.7f39d825.js";import{E as N}from"./el-image-viewer.d5621b18.js";import{E as O}from"./index.8ad94f19.js";import{m as A,d as H,c$ as J,a as X,j}from"./entry.dfbfd4fd.js";import"./el-tooltip.4ed993c7.js";/* empty css                  */import{k as L,s as D,a as z,r as Y,H as s,I as a,X as i,V as m,J as t,u as o,a7 as Z,S as B,aj as F,U as g,R as u,T as G,Z as y,Y as R,n as K}from"./swiper-vue.2eb6bd20.js";import{b as Q}from"./download.f61d7233.js";import{d as W}from"./music.f06b2c3d.js";import{u as P}from"./player.a8689b22.js";import{E as ee,a as se}from"./el-select.b7a2650e.js";/* empty css               *//* empty css                     */import{c as te,a as oe}from"./task_reward.d02f9b86.js";import{P as ae}from"./index.e94bc8a7.js";import{u as ne}from"./useLockFn.619a13da.js";import{_ as ce}from"./_plugin-vue_export-helper.c27b6911.js";import{E as re}from"./index.17567b0d.js";const le={class:"share-popup"},ie={class:"h-[100px]"},de={class:"dialog-footer flex justify-center pb-2"},ue=L({__name:"music-share",emits:["success","close"],setup(I,{expose:d,emit:k}){const v=A(),_=D(),f=z([]),p=Y({category_id:"",records_id:""}),x=async()=>{try{const l=await oe({type:J.MUSIC,share:1});l.unshift({name:"全部",id:""}),f.value=l}catch(l){console.log("获取音乐分类失败=>",l)}},{lockFn:w,isLock:C}=ne(async()=>{var l;await te(p),await v.getUser(),(l=_.value)==null||l.close(),k("success",p.records_id)}),T=()=>{k("close")};return d({open:l=>{var h;x(),(h=_.value)==null||h.open(),p.records_id=l}}),(l,h)=>{const $=ee,S=se,c=H;return s(),a("div",le,[i(ae,{ref_key:"popupRef",ref:_,title:"分享至广场",async:!0,width:"400px",center:!0,cancelButtonText:"",confirmButtonText:"",appendToBody:!1,onConfirm:o(w),onClose:T},{footer:m(()=>[t("div",de,[i(c,{type:"primary",loading:o(C),class:"!rounded-md",onClick:o(w)},{default:m(()=>[Z(" 分享至广场 ")]),_:1},8,["loading","onClick"])])]),default:m(()=>[t("div",ie,[i(S,{size:"large",class:"w-[360px]",placeholder:"全部",modelValue:o(p).category_id,"onUpdate:modelValue":h[0]||(h[0]=n=>o(p).category_id=n),style:{"--el-fill-color-blank":"#F7F7FB"}},{default:m(()=>[(s(!0),a(B,null,F(o(f),n=>(s(),g($,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["onConfirm"])])}}});const _e=ce(ue,[["__scopeId","data-v-0138da76"]]),pe=["onClick","id"],me={key:0,class:"flex-1 flex flex-col justify-center items-center min-h-[75px]"},fe=t("div",{class:"mt-4"},"歌曲生成中，请稍等！",-1),xe={class:"flex-1 flex items-center"},he={class:"w-[75px] h-[75px] flex items-center justify-center flex-none relative"},ye={key:1,class:"text-tx-secondary"},ve={key:2,class:"absolute inset-0 flex items-center justify-center text-white"},ge={key:3,class:"absolute inset-0 flex items-center justify-center text-white"},ke={key:0,class:"ml-[20px]"},be={key:0,class:"mt-[4px] text-tx-secondary"},we={class:"mt-[4px] text-tx-secondary"},Ce={key:1,class:"flex-1 flex justify-center"},$e={class:"flex flex-col items-end"},Se={class:"text-tx-secondary"},Ee={class:"flex items-center mt-[25px]"},Me=["onClick"],je=["onClick"],Re=["onClick"],ns=L({__name:"list",props:{musicList:{default:()=>[]}},emits:["update"],setup(I,{emit:d}){const k=X(),v=z(!1),_=D(null),f=z([]),{playing:p,currentId:x,setCurrentId:w,togglePlay:C,currentMusic:T,getMusic:U}=P(),l=async(c,n)=>{try{const r=await $request.get({url:c,responseType:"blob",baseURL:""},{isReturnDefaultResponse:!0,apiPrefix:""});console.log(r);const E=new Blob([r._data],{type:r.headers.get("Content-Type")}),b=window.URL.createObjectURL(E);Q(b,n)}catch{j.msgError("文件下载失败")}},h=async(c,n)=>{try{if(f.value.includes(c)||n){j.msgError("该音乐已经分享过了！");return}v.value=!0,await K(),_.value.open(c)}catch(r){console.log(r)}},$=async(c,n)=>{await j.confirm("确定删除？"),await W({id:c}),await U(),x.value=-1,d("update")},S=c=>{if(c.id===x.value){C();return}c.status===2&&w(c.id)};return(c,n)=>{const r=V,E=N,b=O;return s(),a("div",null,[(s(!0),a(B,null,F(c.musicList,(e,q)=>(s(),a("div",{key:e.id},[t("div",{class:"flex bg-page mb-[20px] p-[20px] rounded-[12px] cursor-pointer",onClick:M=>S(e),id:`music-item-${e.id}`},[e.status===1?(s(),a("div",me,[i(r,{class:"is-loading",name:"el-icon-Loading",size:25}),fe])):(s(),a(B,{key:1},[t("div",xe,[t("div",he,[e.image_url?(s(),g(E,{key:0,src:e.image_url,class:"w-full h-full rounded-[12px]"},null,8,["src"])):(s(),a("div",ye,[i(r,{name:"local-icon-music1",size:45})])),o(x)==e.id&&o(p)?(s(),a("div",ve,[i(r,{name:"local-icon-pause1",size:20})])):u("",!0),o(x)==e.id&&!o(p)?(s(),a("div",ge,[i(r,{name:"local-icon-play",size:20})])):u("",!0)]),e.status===2?(s(),a("div",ke,[t("div",{class:G(["text-[16px] font-bold",{"!text-primary":o(x)===e.id}])},y(e.title),3),e.style_desc?(s(),a("div",be,y(e.style_desc),1)):u("",!0),t("div",we,y(e.duration),1)])):u("",!0),e.status===3?(s(),a("div",Ce," 歌曲生成失败，请重试！ ")):u("",!0)]),t("div",$e,[t("div",Se,y(e.create_time),1),t("div",Ee,[e.audio_url?(s(),g(b,{key:0,effect:"dark",content:"下载",placement:"bottom"},{default:m(()=>[t("div",{class:"mr-6",onClick:R(M=>l(e.audio_url,e.title),["stop"])},[i(r,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Download",size:"18",color:"#556477"})],8,Me)]),_:2},1024)):u("",!0),e.audio_url&&o(k).getSquareConfig.music_award.is_open?(s(),g(b,{key:1,effect:"dark",content:"分享至广场",placement:"bottom"},{default:m(()=>[t("div",{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md mr-6 pb-[7px] p-1 box-content",onClick:R(M=>h(e.id,e.is_share),["stop"])},[i(r,{name:"local-icon-share",size:"17",color:"#556477"})],8,je)]),_:2},1024)):u("",!0),i(b,{effect:"dark",content:"删除",placement:"bottom"},{default:m(()=>[t("div",{onClick:R(M=>$(e.id,q),["stop"])},[i(r,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Delete",size:"18",color:"#556477"})],8,Re)]),_:2},1024)])])],64))],8,pe)]))),128)),o(v)?(s(),g(_e,{key:0,ref_key:"shareRef",ref:_,onClose:n[0]||(n[0]=e=>v.value=!1),onSuccess:n[1]||(n[1]=e=>o(f).push(e))},null,512)):u("",!0)])}}}),ze={class:"w-[360px] h-full ml-[16px] flex justify-center"},Be={class:"h-full bg-page w-full rounded-[12px]"},Le={class:"p-[40px] flex flex-col items-center"},Ie=["src"],Te={class:"text-2xl font-bold mt-[30px]"},Ue={key:0,class:"text-tx-secondary mt-[5px]"},Ve={class:"whitespace-pre-wrap text-center mt-[20px] leading-7"},De={key:1,class:"h-full flex flex-col items-center justify-center"},Fe={class:"text-tx-secondary"},Pe=t("div",{class:"my-[10px] text-tx-secondary"}," 当前还没有选中音乐哦 ",-1),cs=L({__name:"display",setup(I){const{currentMusic:d}=P();return(k,v)=>{const _=re,f=V;return s(),a("div",ze,[t("div",Be,[o(d).lyric?(s(),g(_,{key:0},{default:m(()=>[t("div",Le,[t("img",{src:o(d).image_url,class:"w-[200px] h-[200px] rounded-[12px]"},null,8,Ie),t("div",Te,y(o(d).title),1),o(d).style_desc?(s(),a("div",Ue," 风格："+y(o(d).style_desc),1)):u("",!0),t("div",Ve,y(o(d).lyric),1)])]),_:1})):(s(),a("div",De,[t("div",Fe,[i(f,{size:45,name:"local-icon-music1"})]),Pe]))])])}}});export{ns as _,cs as a};
