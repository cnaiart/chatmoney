import{_ as pt}from"./nuxt-link.42058260.js";import{_ as dt}from"./index.b2cc1da3.js";import{b as ut,a as mt,_ as ft}from"./index.ff59938d.js";import{_ as _t}from"./index.vue.7f39d825.js";import{a8 as gt,a as ht,m as yt,h as vt,a5 as wt,a6 as xt,a7 as St,j as T,_ as Ct,d as bt}from"./entry.dfbfd4fd.js";import{_ as kt}from"./index.5054c8b8.js";import{E as Lt}from"./index.2e91aacc.js";import{k as Et,s as J,a as A,aa as W,r as It,b as Rt,E as Tt,n as X,j as At,H as d,I as v,X as u,V as m,J as c,u as t,S as j,aj as z,e as Ut,U as F,a7 as Dt,R as P,Y as Vt,Z as $t,T as Nt,ag as Mt,ah as Bt}from"./swiper-vue.2eb6bd20.js";import{u as Y}from"./asyncData.eaddccf2.js";import{u as jt}from"./useCopy.5611cfa5.js";import{u as zt}from"./useLockFn.619a13da.js";import Ft from"./sample-lists.37b42341.js";import{h as Pt,i as Ht,j as qt,k as Ot,l as Jt,e as Wt,b as Z,c as Xt}from"./chat.01f4dab8.js";import{E as Yt}from"./index.17567b0d.js";import{_ as Zt}from"./_plugin-vue_export-helper.c27b6911.js";/* empty css                     */import"./index.e979a1ab.js";/* empty css               */import"./index.vue.74e23ebc.js";import"./index.edaf9b5e.js";import"./el-image-viewer.d5621b18.js";import"./throttle.d40f833a.js";import"./debounce.8cbe4cfc.js";import"./position.4bcf7430.js";import"./file.598d0601.js";import"./index.f647f618.js";import"./___vite-browser-external.5512611b.js";import"./index.9c8f8f3a.js";import"./index.6c069afb.js";import"./use-dialog.7d399731.js";import"./isUndefined.aa0326a0.js";import"./refs.cabac943.js";/* empty css                  */import"./el-link.5fd49d40.js";import"./useAudioPlay.fe45c428.js";import"./knowledge.51dee290.js";import"./download.f61d7233.js";import"./qrcode.vue.esm.415e365a.js";import"./isString.78966428.js";import"./el-upload.5844c619.js";import"./el-progress.8f5e9f30.js";import"./cloneDeep.4e82bacf.js";import"./_baseClone.20563df6.js";import"./_getTag.83294aff.js";import"./isEqual.0df0ab2c.js";import"./el-select.b7a2650e.js";import"./index.8ad94f19.js";import"./strings.ceb81673.js";import"./_baseIteratee.5e0c38c1.js";import"./index.071e9281.js";import"./castArray.c741e965.js";import"./el-collapse.1527f898.js";import"./index.93ec1a3c.js";/* empty css                  */import"./index.e94bc8a7.js";import"./useQuery.ba65a97e.js";import"./el-tabs.2ed630c1.js";import"./index.15b778d4.js";const Gt=gt({id:"dialogueSate",state:()=>({sessionId:"",sessionLists:[]}),getters:{getCurrentSession:e=>e.sessionLists.find(w=>String(w.id)===String(e.sessionId))||{}},actions:{setSessionId(e=""){this.sessionId=String(e)},setSessionSelect(e){e||([e]=this.sessionLists),this.setSessionId((e==null?void 0:e.id)||"")},async getSessionLists(){const e=await Pt({page_type:0});return this.sessionLists=e.lists||[],this.setSessionSelect(),this.sessionLists},async sessionAdd(){await Ht({}),await this.getSessionLists(),this.setSessionSelect()},async sessionEdit(e){await qt({...e}),await this.getSessionLists(),this.setSessionSelect(e)},async sessionClear(){await Ot(),await this.getSessionLists()},async sessionDelete(e){await Jt({id:e}),await this.getSessionLists()}}}),G=e=>(Mt("data-v-92df4162"),e=e(),Bt(),e),Kt={class:"h-full flex"},Qt={class:"p-[16px]"},te={class:"flex items-center justify-around text-xl font-medium px-[16px] pt-[16px] cursor-pointer"},ee=G(()=>c("div",{class:"pb-[6px] text-primary border-solid border-b-[2px] border-primary"}," 问答助手 ",-1)),oe=G(()=>c("div",{class:"pb-[8px]"},"角色助手",-1)),se={class:"flex-1 min-w-0 pr-4 py-4"},ne={class:"h-full flex flex-col bg-body rounded-[12px]"},ie={class:"flex-1 min-h-0"},ae={class:"my-[5px]"},re={key:0,class:"flex flex-col",style:{"margin-left":"52px"}},le=["onClick"],ce={class:"mr-2 text-tx-primary"},pe={key:1,class:"max-w-[1200px] mx-auto"},de={class:"mb-[10px] px-[30px]"},ue={class:"mr-[10px]"},me=Et({__name:"chat",async setup(e){var O;let w,U;const _=ht(),x=yt(),D=J(),n=Gt(),K=vt(),V=A(""),{copy:Q}=jt();[w,U]=W(()=>Y(()=>n.getSessionLists(),{lazy:!0},"$SUo5FcMjp8")),await w,U();const tt=wt(),{data:r,refresh:N}=([w,U]=W(()=>Y(()=>Wt({type:1,category_id:n.sessionId,page_type:0}),{transform(a){return a.lists||[]},default(){return[]},lazy:!0},"$5oItIRu1UV")),w=await w,U(),w);(O=_.getChatConfig)!=null&&O.is_reopen&&(n.sessionAdd(),_.getChatConfig.is_reopen=0);const et=async()=>{if(!x.isLogin)return x.toggleShowLogin();n.sessionId&&(await T.confirm("确定清空记录？"),await Z({category_id:n.sessionId,type:1}),N())},$=A(-1),{lockFn:ot}=zt(async()=>{const a=r.value[r.value.length-1],i=r.value.find(({id:h})=>h===a.id);i&&($.value=a.id,r.value.splice(r.value.length-2,2),k(i.content))}),g=It({show:!1,data:{url:"",name:"",type:"image"}}),st=a=>{g.show=!!a.support_image,g.show||(g.data.url="")},nt=()=>{var a;if(!x.isLogin)return(a=D.value)==null||a.blur(),x.toggleShowLogin();L()};let o=null;const S=A(!1);let M=!1;const b=A([]),k=async(a,i="input")=>{var E;if(!x.isLogin)return x.toggleShowLogin();if(!a)return T.msgError("请输入问题");if(S.value)return;const h=Date.now();b.value=[],S.value=!0,r.value.push({type:1,content:a,files_plugin:[{...g.data}]}),r.value.push({type:2,typing:!0,content:[""],key:h}),(E=D.value)==null||E.setInputValue();const p=r.value.find(l=>l.key===h);n.sessionId||(M=!0,await n.sessionAdd(),M=!1),n.getCurrentSession.name==="新的会话"&&await n.sessionEdit({id:n.sessionId,name:a}),o=Xt({type:1,other_id:n.sessionId,question:a,model:V.value,file:g.data.url}),o.addEventListener("chat",({data:l})=>{console.log(l);const{data:y,index:f}=l;p.content[f]||(p.content[f]=""),p.content[f]+=y}),o.addEventListener("finish",({data:l})=>{const{data:y,index:f}=l;y&&(p.content[f]+=y),g.data.url=""}),o.addEventListener("question",({data:l})=>{b.value=JSON.parse(l.data)}),o.addEventListener("close",async()=>{$.value!==-1&&p.content[0].length&&(await Z({type:1,id:$.value}),$.value=-1),await x.getUser(),setTimeout(async()=>{await N(),S.value=!1,p.typing=!1,await X(),L()},600)}),o.addEventListener("error",async l=>{var y,f;if(i==="input"&&((y=D.value)==null||y.setInputValue(a)),((f=l.data)==null?void 0:f.code)===1100){_.getIsShowRecharge?(await T.confirm(`${_.getTokenUnit}数量已用完，请前往充值`),K.push("/user/recharge")):T.msgError(`${_.getTokenUnit}数量已用完。请联系客服增加`);return}l.errorType==="connectError"&&T.msgError("请求失败，请重试"),["connectError","responseError"].includes(l.errorType)&&r.value.splice(r.value.length-2,2),p.typing=!1,setTimeout(()=>{S.value=!1},200)})},B=J(),H=A(),L=async()=>{var i,h,p;const a=(h=(i=B.value)==null?void 0:i.wrapRef)==null?void 0:h.scrollHeight;(p=B.value)==null||p.setScrollTop(a)},{height:it}=xt(H);St(it,()=>{S.value&&L()},{immediate:!0});const q=()=>{o==null||o.removeEventListener("chat"),o==null||o.removeEventListener("close"),o==null||o.removeEventListener("error"),o==null||o.removeEventListener("finish"),o==null||o.abort(),S.value=!1,b.value=[]};return Rt(()=>n.sessionId,async()=>{M||(q(),await N(),L())}),Tt(async()=>{await X(),r.value.length&&L()}),At(()=>{q()}),(a,i)=>{const h=pt,p=dt,E=mt,l=_t,y=bt,f=ft,at=kt,rt=ut,lt=Lt,ct=Ct;return d(),v("div",null,[u(ct,{name:"default"},{default:m(()=>[c("div",Kt,[c("div",Qt,[u(p,{modelValue:t(n).sessionId,"onUpdate:modelValue":i[0]||(i[0]=s=>t(n).sessionId=s),data:t(n).sessionLists,onAdd:t(n).sessionAdd,onEdit:t(n).sessionEdit,onDelete:t(n).sessionDelete,onClear:t(n).sessionClear,onClickItem:t(n).setSessionSelect},{top:m(()=>[c("div",te,[ee,u(h,{to:"/dialogue/role"},{default:m(()=>[oe]),_:1})])]),_:1},8,["modelValue","data","onAdd","onEdit","onDelete","onClear","onClickItem"])]),c("div",se,[u(lt,{class:"h-full",content:t(_).getChatConfig.watermark,font:{color:t(tt)?"rgba(256,256,256,0.08)":"rgba(0,0,0,0.06)",fontSize:12}},{default:m(()=>[c("div",ne,[c("div",ie,[u(t(Yt),{ref_key:"scrollbarRef",ref:B},{default:m(()=>[c("div",null,[t(r).length?(d(),v("div",{key:0,ref_key:"innerRef",ref:H,class:"px-8"},[(d(!0),v(j,null,z(t(r),(s,C)=>(d(),v("div",{key:s.id+""+C,class:"mt-4 sm:pb-[20px]"},[s.type==1?(d(),F(f,{key:0,type:"right",avatar:t(x).userInfo.avatar,color:"white"},{actions:m(()=>[c("div",ae,[u(y,{link:"",type:"info",onClick:I=>t(Q)(s.content)},{icon:m(()=>[u(l,{name:"el-icon-CopyDocument"})]),default:m(()=>[Dt(" 复制 ")]),_:2},1032,["onClick"])])]),default:m(()=>[u(E,{content:s.content,"files-plugin":s.files_plugin},null,8,["content","files-plugin"])]),_:2},1032,["avatar"])):P("",!0),s.type==2?(d(),F(f,{key:1,type:"left",avatar:t(_).getChatConfig.chat_logo,time:s.create_time,bg:"var(--el-bg-color-page)",modelName:s.model},{outer_actions:m(()=>[C===t(r).length-1&&!t(S)?(d(),v("div",re,[(d(!0),v(j,null,z(t(b).length?t(b):s.correlation,(I,R)=>(d(),v("div",{key:R,class:"inline-flex items-center rounded-[12px] bg-page cursor-pointer mt-[10px] hover:bg-primary-light-9",style:{padding:"8px 12px",width:"fit-content"},onClick:Vt(fe=>k(I,"input"),["stop"])},[c("span",ce,$t(I),1),u(l,{name:"el-icon-Right",color:"#999",size:"20"})],8,le))),128))])):P("",!0)]),default:m(()=>[(d(!0),v(j,null,z(s.content,(I,R)=>(d(),F(E,{key:R,content:I,type:"html",typing:s.typing,"line-numbers":!t(_).isMobile,"show-rewrite":C===t(r).length-1,"show-copy":"","show-voice":t(_).getIsVoiceOpen,class:Nt(["mb-[15px] last-of-type:mb-0",{"pt-[15px] border-t border-solid border-br-light":R>0}]),"show-poster":"","record-list":t(r),index:R,"record-id":s.id,onRewrite:t(ot)},null,8,["content","typing","line-numbers","show-rewrite","show-voice","class","record-list","index","record-id","onRewrite"]))),128))]),_:2},1032,["avatar","time","modelName"])):P("",!0)]))),128))],512)):(d(),v("div",pe,[u(Ft,{onClickItem:i[1]||(i[1]=s=>k(s,"sample"))})]))])]),_:1},512)]),c("div",de,[u(rt,{ref_key:"chatActionRef",ref:D,loading:t(S),"file-plugin":g.data,"onUpdate:filePlugin":i[3]||(i[3]=s=>g.data=s),onEnter:k,onClear:et,onPause:i[4]||(i[4]=s=>{var C;return(C=t(o))==null?void 0:C.abort()}),onFocus:nt,"show-continue":t(r).length,"show-file-upload":g.show,onContinue:i[5]||(i[5]=s=>k("继续","btn"))},{btn:m(()=>[c("div",ue,[u(at,{class:"min-w-[280px] select-class",sub_id:t(V),"onUpdate:sub_id":i[2]||(i[2]=s=>Ut(V)?V.value=s:null),"onUpdate:modelConfig":st},null,8,["sub_id","onUpdate:modelConfig"])])]),_:1},8,["loading","file-plugin","show-continue","show-file-upload"])])])]),_:1},8,["content","font"])])])]),_:1})])}}});const wo=Zt(me,[["__scopeId","data-v-92df4162"]]);export{wo as default};
