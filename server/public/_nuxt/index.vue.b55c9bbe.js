import{E as ae}from"./el-image-viewer.d5621b18.js";import{E as Se}from"./index.6c069afb.js";import{m as G,dF as pe,da as C,dp as oe,dq as M,dG as me,E as z,d as X,a as K,ds as re,cF as te,dH as _e,dI as fe,v as ge,dd as ee,dt as Te,dJ as Fe,dr as ce}from"./entry.dfbfd4fd.js";/* empty css                  */import{E as ye,a as ve}from"./el-tabs.2ed630c1.js";import{_ as xe}from"./nuxt-link.42058260.js";import{E as se,a as le}from"./el-select.b7a2650e.js";import{E as q,a as Y}from"./index.883ed08b.js";import{_ as Z}from"./index.e708d765.js";/* empty css               *//* empty css                     *//* empty css                  */import"./el-form-item.4ed993c7.js";/* empty css                */import{u as Q}from"./useLockFn.619a13da.js";import{k as B,s as U,r as W,l as D,H as n,I as k,J as i,X as t,V as s,u as e,U as v,R as m,a7 as I,A as ke,E as we,j as be,$ as he,S as P,a as Ae,aj as Ce,b as ne,Z as Pe,e as Ge}from"./swiper-vue.2eb6bd20.js";import{_ as Ee}from"./index.vue.7f39d825.js";import{u as Le}from"./usePolling.de4d6c35.js";import{_ as Ie}from"./_plugin-vue_export-helper.c27b6911.js";const Ue={class:"pt-[10px]"},Be={class:"flex justify-center leading-5 w-[90px] pl-2.5 border-l border-br"},Me={class:"flex"},qe={class:"flex-1 flex"},je=B({__name:"mobile-login",setup(l){const o=G(),_=U(),y={mobile:[{required:!0,message:"请输入手机号"}],password:[{required:!0,message:"请输入密码"}],code:[{required:!0,message:"请输入验证码"}]},c=W({code:"",mobile:"",password:"",scene:1,terminal:pe}),g=D(()=>c.scene===3),u=D(()=>c.scene===1),r=x=>{c.scene=x},b=U(),E=async()=>{var x,d;await((x=_.value)==null?void 0:x.validateField(["account"])),await oe({scene:M.LOGIN,mobile:c.mobile}),(d=b.value)==null||d.start()},{lockFn:N,isLock:a}=Q(async()=>{var d;await((d=_.value)==null?void 0:d.validate());const x=await me(c);o.login(x.token),location.reload(),await o.getUser(),o.toggleShowLogin(!1)});return(x,d)=>{const p=se,O=le,w=z,R=q,V=Z,A=X,$=Y;return n(),k("div",Ue,[i("div",null,[t($,{ref_key:"formRef",ref:_,size:"large",model:e(c),rules:y},{default:s(()=>[t(R,{prop:"mobile"},{default:s(()=>[t(w,{modelValue:e(c).mobile,"onUpdate:modelValue":d[0]||(d[0]=F=>e(c).mobile=F),placeholder:"请输入手机号"},{prepend:s(()=>[t(O,{"model-value":"+86",style:{width:"80px"}},{default:s(()=>[t(p,{label:"+86",value:"+86"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u)?(n(),v(R,{key:0,prop:"password"},{default:s(()=>[t(w,{modelValue:e(c).password,"onUpdate:modelValue":d[1]||(d[1]=F=>e(c).password=F),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):m("",!0),e(g)?(n(),v(R,{key:1,prop:"code"},{default:s(()=>[t(w,{modelValue:e(c).code,"onUpdate:modelValue":d[2]||(d[2]=F=>e(c).code=F),placeholder:"请输入验证码"},{suffix:s(()=>[i("div",Be,[t(V,{ref_key:"verificationCodeRef",ref:b,onClickGet:E},null,512)])]),_:1},8,["modelValue"])]),_:1})):m("",!0),i("div",Me,[i("div",qe,[e(u)?(n(),v(A,{key:0,type:"primary",link:"",onClick:d[3]||(d[3]=F=>r(3))},{default:s(()=>[I(" 手机验证码登录 ")]),_:1})):m("",!0),e(g)?(n(),v(A,{key:1,type:"primary",link:"",onClick:d[4]||(d[4]=F=>r(1))},{default:s(()=>[I(" 手机密码登录 ")]),_:1})):m("",!0)]),e(u)?(n(),v(A,{key:0,link:"",onClick:d[5]||(d[5]=F=>e(o).setLoginPopupType(e(C).FORGOT_PWD_MOBILE))},{default:s(()=>[I(" 忘记密码？ ")]),_:1})):m("",!0)]),t(R,{class:"my-[30px]"},{default:s(()=>[t(A,{class:"w-full",type:"primary",loading:e(a),onClick:e(N)},{default:s(()=>[I(" 登录 ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model"])])])}}}),ze={class:"pt-[10px]"},Xe={class:"flex justify-center leading-5 w-[90px] pl-2.5 border-l border-br"},He={class:"flex justify-end"},Je={class:"flex-1 flex"},Ke=B({__name:"mailbox-login",setup(l){const o=G(),_=K(),y=U(),c={email:[{required:!0,message:"请输入邮箱账号"},{type:"email",message:"请输入正确的邮箱账号"}],password:[{required:!0,message:"请输入密码"}],code:[{required:!0,message:"请输入验证码"}]},g=W({code:"",email:"",password:"",scene:4,terminal:pe}),u=D(()=>g.scene===4),r=D(()=>g.scene===2),b=d=>{g.scene=d},E=U(),N=async()=>{var d,p;await((d=y.value)==null?void 0:d.validateField(["email"])),await re({scene:M.LOGIN,email:g.email}),(p=E.value)==null||p.start()},{lockFn:a,isLock:x}=Q(async()=>{var p;await((p=y.value)==null?void 0:p.validate());const d=await me(g);!d.mobile&&_.getLoginConfig.coerce_mobile?(o.temToken=d.token,o.setLoginPopupType(C.BIND_MOBILE)):(o.login(d.token),o.setUser(d),o.toggleShowLogin(!1),location.reload())});return(d,p)=>{const O=z,w=q,R=Z,V=X,A=Y;return n(),k("div",ze,[i("div",null,[t(A,{ref_key:"formRef",ref:y,size:"large",model:e(g),rules:c},{default:s(()=>[t(w,{prop:"email"},{default:s(()=>[t(O,{modelValue:e(g).email,"onUpdate:modelValue":p[0]||(p[0]=$=>e(g).email=$),placeholder:"请输入邮箱账号"},null,8,["modelValue"])]),_:1}),e(r)?(n(),v(w,{key:0,prop:"password"},{default:s(()=>[t(O,{modelValue:e(g).password,"onUpdate:modelValue":p[1]||(p[1]=$=>e(g).password=$),type:"password","show-password":"",placeholder:"请输入密码"},null,8,["modelValue"])]),_:1})):m("",!0),e(u)?(n(),v(w,{key:1,prop:"code"},{default:s(()=>[t(O,{modelValue:e(g).code,"onUpdate:modelValue":p[2]||(p[2]=$=>e(g).code=$),placeholder:"请输入验证码"},{suffix:s(()=>[i("div",Xe,[t(R,{ref_key:"verificationCodeRef",ref:E,onClickGet:N},null,512)])]),_:1},8,["modelValue"])]),_:1})):m("",!0),i("div",He,[i("div",Je,[e(r)?(n(),v(V,{key:0,type:"primary",link:"",onClick:p[3]||(p[3]=$=>b(4))},{default:s(()=>[I(" 邮箱验证码登录 ")]),_:1})):m("",!0),e(u)?(n(),v(V,{key:1,type:"primary",link:"",onClick:p[4]||(p[4]=$=>b(2))},{default:s(()=>[I(" 邮箱密码登录 ")]),_:1})):m("",!0)]),t(V,{link:"",onClick:p[5]||(p[5]=$=>e(o).setLoginPopupType(e(C).FORGOT_PWD_MAILBOX))},{default:s(()=>[I(" 忘记密码？ ")]),_:1})]),t(w,{class:"my-[30px]"},{default:s(()=>[t(V,{class:"w-full",type:"primary",loading:e(x),onClick:e(a)},{default:s(()=>[I(" 登录 ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model"])])])}}}),ue=G(),Ye=K(),Ze=()=>{const l=te(()=>({pending:!0,data:{}}),"$OO04Zgg9KB");return{state:l,getData:async()=>{try{l.value.pending=!0;const _=await _e();l.value.data=_,l.value.pending=!1}catch(_){return l.value.pending=!1,Promise.reject(_)}}}};var S=(l=>(l[l.CODE_ERROR=-1]="CODE_ERROR",l[l.INVALID=0]="INVALID",l[l.NORMAL=1]="NORMAL",l[l.SCANNED_CODE=2]="SCANNED_CODE",l[l.LOGIN_FAIL=3]="LOGIN_FAIL",l[l.LOGIN_SUCCESS=4]="LOGIN_SUCCESS",l))(S||{});const Qe=l=>{const o=te(()=>1,"$u1hDQUKMyG"),_=async()=>{try{const r=await fe({key:l.value.key});return o.value=r.status,o.value==4&&(We(r.user),g()),r}catch{o.value=3}},y=()=>{o.value=0},{start:c,end:g,result:u}=Le(_,{key:"wx_login",totalTime:120*1e3,callback:y});return{status:o,start:c,end:g,result:u}},We=async l=>{const{login:o,setUser:_,toggleShowLogin:y,setLoginPopupType:c}=ue;!l.mobile&&Ye.getLoginConfig.coerce_mobile?(ue.temToken=l.token,c(C.BIND_MOBILE)):(o(l.token),_(l),y(!1),location.reload())},eo={class:"pb-[10px]"},oo={class:"flex flex-col items-center mt-[20px]"},to={class:"relative w-[180px] h-[180px]"},so={key:1,class:"absolute left-0 top-0 w-full h-full bg-mask",style:{background:"rgba(0, 0, 0, 0.5)"}},lo={class:"h-full text-primary flex justify-center items-center"},no=i("div",{class:"h-full flex flex-col justify-center items-center text-white"},[i("div",null,"点击刷新")],-1),ao=[no],ro=i("div",{class:"mt-3"},"扫码成功",-1),io=i("div",{class:"mt-5 text-error text-sm"}," 请在微信公众号中确认登录 ",-1),co=i("div",{class:"mt-3 text-error"},"二维码失效",-1),uo=i("div",{class:"mt-5 text-sm"},"请在点击二维码刷新",-1),po=i("div",{class:"mt-3 text-error"},"登录失败，请重新登录",-1),mo=i("div",{class:"mt-5 text-sm"},"请在点击二维码刷新",-1),_o=i("div",{class:"mt-3"},"微信扫码登录/注册",-1),fo=i("div",{class:"mt-5 text-tx-secondary text-sm"}," 首次扫码关注公众号后将自动注册新账号 ",-1),go=B({__name:"weixin-login",setup(l){G();const{state:o,getData:_}=Ze(),{pending:y,data:c}=ke(o.value),{start:g,end:u,status:r}=Qe(c),b=async()=>{r.value=S.NORMAL;try{await _(),g()}catch{r.value=S.CODE_ERROR}};return we(()=>{console.log("123"),b()}),be(()=>{u()}),(E,N)=>{const a=Ee,x=ge;return n(),k("div",eo,[i("div",oo,[he((n(),k("div",to,[e(c).url?(n(),v(e(ae),{key:0,src:e(c).url,class:"w-full h-full"},null,8,["src"])):m("",!0),e(r)==e(S).SCANNED_CODE?(n(),k("div",so,[i("div",lo,[t(a,{name:"el-icon-SuccessFilled",size:30})])])):m("",!0),e(r)==e(S).INVALID||e(r)==e(S).LOGIN_FAIL||e(r)==e(S).CODE_ERROR?(n(),k("div",{key:2,class:"absolute left-0 top-0 w-full h-full bg-overlay cursor-pointer",style:{background:"rgba(0, 0, 0, 0.5)"},onClick:b},ao)):m("",!0)])),[[x,e(y)]]),e(r)==e(S).SCANNED_CODE?(n(),k(P,{key:0},[ro,io],64)):m("",!0),e(r)==e(S).INVALID?(n(),k(P,{key:1},[co,uo],64)):m("",!0),e(r)==e(S).LOGIN_FAIL?(n(),k(P,{key:2},[po,mo],64)):m("",!0),e(r)==e(S).NORMAL||e(r)==e(S).LOGIN_SUCCESS||e(r)==e(S).CODE_ERROR?(n(),k(P,{key:3},[_o,fo],64)):m("",!0)])])}}}),yo={class:"flex flex-col h-full"},vo={class:"flex-1 pt-[20px] px-[30px] min-h-0"},xo={key:0,class:"bg-[#f4f4f4] px-[20px] py-[15px] flex dark:bg-[#333]"},ko={key:0,class:"flex-1 text-tx-secondary"},wo=["href"],bo=["href"],ho=B({__name:"index",setup(l){const o=K(),_=G(),y=[{name:"微信登录",type:"3"},{name:"手机号登录",type:"1"},{name:"邮箱登录",type:"2"}],c=Ae(1),g=D(()=>y.filter(a=>u.value.includes(a.type))),u=D(()=>{var a;return((a=o.getLoginConfig)==null?void 0:a.login_way)||[]}),r=D(()=>{var a;return((a=o.getLoginConfig)==null?void 0:a.register_way)||[]}),b=D(()=>o.getLoginConfig.is_agreement===1),E=D(()=>(c.value=o.getLoginConfig.default_login_way.toString(),o.getLoginConfig.default_login_way.toString())),N=a=>{c.value=a};return(a,x)=>{const d=ve,p=ye,O=xe;return n(),k("div",yo,[i("div",vo,[t(p,{"model-value":e(E),onTabChange:N},{default:s(()=>[(n(!0),k(P,null,Ce(e(g),(w,R)=>(n(),v(d,{key:R,label:w.name,name:w.type},{default:s(()=>[w.type==="3"&&e(c)==="3"?(n(),v(go,{key:0})):m("",!0),w.type==="1"?(n(),v(je,{key:1})):m("",!0),w.type==="2"?(n(),v(Ke,{key:2})):m("",!0)]),_:2},1032,["label","name"]))),128))]),_:1},8,["model-value"])]),e(r).length&&e(c)!="3"||e(b)?(n(),k("div",xo,[e(b)?(n(),k("div",ko,[I(" 您登录即同意 "),t(O,{to:`/policy/${e(ee).SERVICE}`,custom:""},{default:s(({href:w})=>[i("a",{class:"text-tx-primary",href:w,target:"_blank"}," 用户协议 ",8,wo)]),_:1},8,["to"]),I(" 和 "),t(O,{class:"text-tx-primary",to:`/policy/${e(ee).PRIVACY}`,custom:""},{default:s(({href:w})=>[i("a",{class:"text-tx-primary",href:w,target:"_blank"}," 隐私政策 ",8,bo)]),_:1},8,["to"])])):m("",!0),e(r).length&&e(c)!="3"?(n(),v(e(X),{key:1,type:"primary",link:"",onClick:x[0]||(x[0]=w=>e(_).setLoginPopupType(e(C).REGISTER))},{default:s(()=>[I(" 注册新账号 ")]),_:1})):m("",!0)])):m("",!0)])}}});const Co=Ie(ho,[["__scopeId","data-v-b05048cb"]]),Eo={class:"flex-1 flex flex-col"},Lo={class:"flex flex-1 flex-col pt-[30px] px-[30px] min-h-0"},Io=i("span",{class:"text-2xl font-medium text-tx-primary"},"更换密码",-1),Oo={class:"flex justify-center leading-5 w-[90px] pl-2.5 border-l border-br"},Ro={class:"flex justify-center flex-1"},Vo=B({__name:"forgot-pwd",setup(l){const o=G(),{setLoginPopupType:_}=G(),y=U(),c=U(),g={mobile:[{required:!0,message:"请输入手机号码"}],email:[{required:!0,message:"请输入邮箱账号"},{type:"email",message:"请输入正确的邮箱账号"}],code:[{required:!0,message:"请输入验证码",trigger:["change","blur"]}],password:[{required:!0,message:"请输入6-20位数字+字母或符号组合",trigger:["change","blur"]},{min:6,max:20,message:"密码长度应为6-20",trigger:["change","blur"]}],password_confirm:[{validator(d,p,O){p===""?O(new Error("请再次输入密码")):p!==u.password?O(new Error("两次输入的密码不一致")):O()},trigger:["change","blur"]}]},u=W({email:"",mobile:"",password:"",code:"",password_confirm:""}),r=async()=>{var d;o.loginPopupType===C.FORGOT_PWD_MOBILE?await b():await E(),(d=c.value)==null||d.start()},b=async()=>{var d;await((d=y.value)==null?void 0:d.validateField(["mobile"])),await oe({scene:M.FIND_PASSWORD,mobile:u.mobile})},E=async()=>{var d;await((d=y.value)==null?void 0:d.validateField(["email"])),await re({scene:M.FIND_PASSWORD,email:u.email})},N=async()=>{var d;await((d=y.value)==null?void 0:d.validate()),await Te({...u,scene:o.loginPopupType===C.FORGOT_PWD_MOBILE?1:2}),o.logout(),_(C.LOGIN)},{lockFn:a,isLock:x}=Q(N);return(d,p)=>{const O=se,w=le,R=z,V=q,A=Z,$=X,F=Y;return n(),k("div",Eo,[i("div",Lo,[Io,t(F,{ref_key:"formRef",ref:y,class:"mt-[35px]",size:"large",model:e(u),rules:g},{default:s(()=>[e(o).loginPopupType===e(C).FORGOT_PWD_MOBILE?(n(),v(V,{key:0,prop:"mobile"},{default:s(()=>[t(R,{modelValue:e(u).mobile,"onUpdate:modelValue":p[0]||(p[0]=f=>e(u).mobile=f),placeholder:"请输入手机号"},{prepend:s(()=>[t(w,{"model-value":"+86",style:{width:"80px"}},{default:s(()=>[t(O,{label:"+86",value:"+86"})]),_:1})]),_:1},8,["modelValue"])]),_:1})):m("",!0),e(o).loginPopupType===e(C).FORGOT_PWD_MAILBOX?(n(),v(V,{key:1,prop:"email"},{default:s(()=>[t(R,{modelValue:e(u).email,"onUpdate:modelValue":p[1]||(p[1]=f=>e(u).email=f),placeholder:"请输入邮箱账号"},null,8,["modelValue"])]),_:1})):m("",!0),t(V,{prop:"code"},{default:s(()=>[t(R,{modelValue:e(u).code,"onUpdate:modelValue":p[2]||(p[2]=f=>e(u).code=f),placeholder:"请输入验证码"},{suffix:s(()=>[i("div",Oo,[t(A,{ref_key:"verificationCodeRef",ref:c,onClickGet:r},null,512)])]),_:1},8,["modelValue"])]),_:1}),t(V,{prop:"password"},{default:s(()=>[t(R,{modelValue:e(u).password,"onUpdate:modelValue":p[3]||(p[3]=f=>e(u).password=f),placeholder:"请输入6-20位数字+字母或符号组合",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(V,{prop:"password_confirm"},{default:s(()=>[t(R,{modelValue:e(u).password_confirm,"onUpdate:modelValue":p[4]||(p[4]=f=>e(u).password_confirm=f),placeholder:"请再次输入密码",type:"password","show-password":""},null,8,["modelValue"])]),_:1}),t(V,{class:"mt-[30px]"},{default:s(()=>[t($,{class:"w-full",type:"primary",loading:e(x),onClick:e(a)},{default:s(()=>[I(" 确认 ")]),_:1},8,["loading","onClick"])]),_:1}),t(V,{class:"mt-[20px]"},{default:s(()=>[i("div",Ro,[e(o).isLogin?m("",!0):(n(),v($,{key:0,type:"primary",link:"",onClick:p[5]||(p[5]=f=>e(_)(e(C).LOGIN))},{default:s(()=>[I(" 返回登录 ")]),_:1}))])]),_:1})]),_:1},8,["model"])])])}}}),$o={class:"flex-1 flex flex-col"},Do={class:"flex flex-1 flex-col py-[20px] px-[30px] min-h-0"},No={class:"flex justify-center leading-5 w-[90px] pl-2.5 border-l border-br"},So={class:"flex justify-center"},To={key:0,class:"bg-[#f4f4f4] px-[20px] py-[15px] flex dark:bg-[#333]"},Fo={class:"flex-1 text-tx-secondary"},Ao=["href"],Po=["href"],Go=B({__name:"index",setup(l){const o=[{name:"手机号注册",type:"1"},{name:"邮箱注册",type:"2"}],_=D(()=>{var f;return((f=w.getLoginConfig)==null?void 0:f.register_way)||[]}),y=D(()=>o.filter(f=>_.value.includes(f.type))),c=G(),{login:g,setUser:u,toggleShowLogin:r,setLoginPopupType:b}=c,E=U(),N={mobile:[{required:!0,message:"请输入手机号"}],email:[{required:!0,message:"请输入邮箱账号"},{type:"email",message:"请输入正确的邮箱账号"}],code:[{required:!0,message:"请输入验证码"}],password:[{required:!0,message:"请输入6-20位数字+字母或符号组合"},{min:6,max:20,message:"密码长度应为6-20"}],password_confirm:[{validator(f,h,H){h===""?H(new Error("请再次输入密码")):h!==a.password?H(new Error("两次输入的密码不一致")):H()}}]},a=W({scene:"",mobile:"",code:"",email:"",password:"",password_confirm:""}),x=U(),d=async()=>{var f;a.scene==="1"?await p():O(),(f=x.value)==null||f.start()},p=async()=>{var f;await((f=E.value)==null?void 0:f.validateField(["mobile"])),await oe({scene:M.REGISTER,mobile:a.mobile})},O=async()=>{var f;await((f=E.value)==null?void 0:f.validateField(["email"])),await re({scene:M.REGISTER,email:a.email})},w=K(),R=D(()=>{var f;return((f=w.getLoginConfig)==null?void 0:f.register_sms_verify)===1}),V=D(()=>w.getLoginConfig.is_agreement===1),A=async()=>{var h;await((h=E.value)==null?void 0:h.validate());const f=await Fe(a);!f.mobile&&w.getLoginConfig.coerce_mobile?(c.temToken=f.token,b(C.BIND_MOBILE)):(g(f.token),u(f),r(!1),location.reload())},{lockFn:$,isLock:F}=Q(A);return ne(()=>a.scene,()=>{var f;a.password="",a.code="",a.password="",(f=E.value)==null||f.clearValidate()}),ne(_,f=>{if(f.includes("1")){a.scene="1";return}const[h]=f;a.scene=h||""},{immediate:!0}),(f,h)=>{const H=ve,Oe=ye,Re=se,Ve=le,J=z,j=q,$e=Z,ie=X,De=Y,de=xe;return n(),k("div",$o,[i("div",Do,[t(Oe,{modelValue:e(a).scene,"onUpdate:modelValue":h[0]||(h[0]=L=>e(a).scene=L)},{default:s(()=>[(n(!0),k(P,null,Ce(e(y),(L,Ne)=>(n(),v(H,{key:Ne,label:L.name,name:L.type},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),e(_).length?(n(),v(De,{key:0,ref_key:"formRef",ref:E,class:"mt-[10px]",size:"large",model:e(a),rules:N},{default:s(()=>[e(a).scene==="1"?(n(),v(j,{key:0,prop:"mobile"},{default:s(()=>[t(J,{modelValue:e(a).mobile,"onUpdate:modelValue":h[1]||(h[1]=L=>e(a).mobile=L),placeholder:"请输入手机号"},{prepend:s(()=>[t(Ve,{"model-value":"+86",style:{width:"80px"}},{default:s(()=>[t(Re,{label:"+86",value:"+86"})]),_:1})]),_:1},8,["modelValue"])]),_:1})):m("",!0),e(a).scene==="2"?(n(),v(j,{key:1,prop:"email"},{default:s(()=>[t(J,{modelValue:e(a).email,"onUpdate:modelValue":h[2]||(h[2]=L=>e(a).email=L),placeholder:"请输入邮箱账号"},null,8,["modelValue"])]),_:1})):m("",!0),e(R)?(n(),v(j,{key:2,prop:"code"},{default:s(()=>[t(J,{modelValue:e(a).code,"onUpdate:modelValue":h[3]||(h[3]=L=>e(a).code=L),placeholder:"请输入验证码"},{suffix:s(()=>[i("div",No,[t($e,{ref_key:"verificationCodeRef",ref:x,onClickGet:d},null,512)])]),_:1},8,["modelValue"])]),_:1})):m("",!0),t(j,{prop:"password"},{default:s(()=>[t(J,{modelValue:e(a).password,"onUpdate:modelValue":h[4]||(h[4]=L=>e(a).password=L),type:"password","show-password":"",placeholder:"请输入6-20位数字+字母或符号组合"},null,8,["modelValue"])]),_:1}),t(j,{prop:"password_confirm"},{default:s(()=>[t(J,{modelValue:e(a).password_confirm,"onUpdate:modelValue":h[5]||(h[5]=L=>e(a).password_confirm=L),type:"password","show-password":"",placeholder:"请再次输入密码"},null,8,["modelValue"])]),_:1}),t(j,{class:"mt-[30px]"},{default:s(()=>[t(ie,{class:"w-full",type:"primary",loading:e(F),onClick:e($)},{default:s(()=>[I(" 注册 ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1},8,["model"])):m("",!0),i("div",So,[I(" 已有账号？ "),t(ie,{type:"primary",link:"",onClick:h[6]||(h[6]=L=>e(b)(e(C).LOGIN))},{default:s(()=>[I(" 立即登录 ")]),_:1})])]),e(V)?(n(),k("div",To,[i("div",Fo,[I(" 您注册即同意 "),t(de,{to:`/policy/${e(ee).SERVICE}`,custom:""},{default:s(({href:L})=>[i("a",{class:"text-tx-primary",href:L,target:"_blank"}," 用户协议 ",8,Ao)]),_:1},8,["to"]),I(" 和 "),t(de,{class:"text-tx-primary",to:`/policy/${e(ee).PRIVACY}`,custom:""},{default:s(({href:L})=>[i("a",{class:"text-tx-primary",href:L,target:"_blank"}," 隐私政策 ",8,Po)]),_:1},8,["to"])])])):m("",!0)])}}});const Uo=Ie(Go,[["__scopeId","data-v-3c8cc549"]]),Bo={class:"flex-1 flex flex-col"},Mo={class:"flex flex-1 flex-col pt-[30px] px-[30px] min-h-0"},qo={class:"text-2xl font-medium text-tx-primary"},jo={class:"flex justify-center leading-5 w-[90px] pl-2.5 border-l border-br"},zo=B({__name:"bind-mobile",setup(l){const o=G(),_=U(),y=U(),c={mobile:[{required:!0,message:"请输入手机号码",trigger:["change","blur"]}],code:[{required:!0,message:"请输入验证码",trigger:["change","blur"]}]},g=D(()=>!!o.userInfo.mobile),u=W({type:g.value?"change":"bind",mobile:"",code:""}),r=async()=>{var a,x;await((a=_.value)==null?void 0:a.validateField(["mobile"])),await oe({scene:g.value?M.CHANGE_MOBILE:M.BIND_MOBILE,mobile:u.mobile}),(x=y.value)==null||x.start()},b=async()=>{var a;await((a=_.value)==null?void 0:a.validate()),o.isLogin?await ce(u):(await ce(u,{token:o.temToken}),o.login(o.temToken),location.reload(),await o.getUser()),o.toggleShowLogin(!1)},{lockFn:E,isLock:N}=Q(b);return(a,x)=>{const d=Z;return n(),k("div",Bo,[i("div",Mo,[i("span",qo,Pe(e(g)?"更换手机号":"绑定手机号"),1),t(e(Y),{ref_key:"formRef",ref:_,class:"mt-[35px]",size:"large",model:e(u),rules:c},{default:s(()=>[t(e(q),{prop:"mobile"},{default:s(()=>[t(e(z),{modelValue:e(u).mobile,"onUpdate:modelValue":x[0]||(x[0]=p=>e(u).mobile=p),placeholder:"请输入手机号"},{prepend:s(()=>[t(e(le),{"model-value":"+86",style:{width:"80px"}},{default:s(()=>[t(e(se),{label:"+86",value:"+86"})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(e(q),{prop:"code"},{default:s(()=>[t(e(z),{modelValue:e(u).code,"onUpdate:modelValue":x[1]||(x[1]=p=>e(u).code=p),placeholder:"请输入验证码"},{suffix:s(()=>[i("div",jo,[t(d,{ref_key:"verificationCodeRef",ref:y,onClickGet:r},null,512)])]),_:1},8,["modelValue"])]),_:1}),t(e(q),{class:"mt-[60px]"},{default:s(()=>[t(e(X),{class:"w-full",type:"primary",onClick:e(E),loading:e(N)},{default:s(()=>[I(" 确认 ")]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model"])])])}}}),Xo=()=>{const l=te(()=>({pending:!0,data:{}}),"$SqqwjC5BAv");return{state:l,getData:async()=>{try{l.value.pending=!0;const _=await _e({channel:"bind"});l.value.data=_,l.value.pending=!1}catch(_){return l.value.pending=!1,Promise.reject(_)}}}};var T=(l=>(l[l.CODE_ERROR=-1]="CODE_ERROR",l[l.INVALID=0]="INVALID",l[l.NORMAL=1]="NORMAL",l[l.SCANNED_CODE=2]="SCANNED_CODE",l[l.BIND_FAIL=3]="BIND_FAIL",l[l.BIND_SUCCESS=4]="BIND_SUCCESS",l))(T||{});const Ho=l=>{const o=te(()=>1,"$5Bc8VhT1Td"),_=async()=>{try{const r=await fe({key:l.value.key,channel:"bind"});return o.value=r.status,o.value==4&&(Jo(r.user),g()),r}catch{o.value=3,g()}},y=()=>{o.value=0},{start:c,end:g,result:u}=Le(_,{key:"bind_wx",totalTime:120*1e3,callback:y});return{status:o,start:c,end:g,result:u}},Jo=async l=>{location.reload()},Ko={class:"pb-[10px]"},Yo=i("div",{class:"text-xl font-medium pt-4 pl-4"},"绑定微信",-1),Zo={class:"flex flex-col items-center mt-[20px] pt-3 pb-[30px]"},Qo={class:"relative w-[180px] h-[180px]"},Wo={key:1,class:"absolute left-0 top-0 w-full h-full bg-mask",style:{background:"rgba(0, 0, 0, 0.5)"}},et={class:"h-full text-primary flex justify-center items-center"},ot=i("div",{class:"h-full flex flex-col justify-center items-center text-white"},[i("div",null,"点击刷新")],-1),tt=[ot],st=i("div",{class:"mt-3"},"扫码成功",-1),lt=i("div",{class:"mt-5 text-error text-sm"}," 请在微信公众号中确认绑定 ",-1),nt=i("div",{class:"mt-3 text-error"},"二维码失效",-1),at=i("div",{class:"mt-5 text-sm"},"请在点击二维码刷新",-1),rt=i("div",{class:"mt-3 text-error"},"绑定失败，请重新绑定",-1),it=i("div",{class:"mt-5 text-sm"},"请在点击二维码刷新",-1),dt=i("div",{class:"mt-3"},"使用手机微信扫码绑定",-1),ct=i("div",{class:"mt-2 text-tx-placeholder"},"绑定后可使用微信扫码登录",-1),ut=B({__name:"bind-weixin",setup(l){const{state:o,getData:_}=Xo(),{pending:y,data:c}=ke(o.value),{start:g,end:u,status:r}=Ho(c),b=async()=>{r.value=T.NORMAL;try{await _(),g()}catch{r.value=T.CODE_ERROR}};return we(()=>{b()}),be(()=>{u()}),(E,N)=>{const a=Ee,x=ge;return n(),k("div",Ko,[Yo,i("div",Zo,[he((n(),k("div",Qo,[e(c).url?(n(),v(e(ae),{key:0,src:e(c).url,class:"w-full h-full"},null,8,["src"])):m("",!0),e(r)==e(T).SCANNED_CODE?(n(),k("div",Wo,[i("div",et,[t(a,{name:"el-icon-SuccessFilled",size:30})])])):m("",!0),e(r)==e(T).INVALID||e(r)==e(T).BIND_FAIL||e(r)==e(T).CODE_ERROR?(n(),k("div",{key:2,class:"absolute left-0 top-0 w-full h-full bg-overlay cursor-pointer",style:{background:"rgba(0, 0, 0, 0.5)"},onClick:b},tt)):m("",!0)])),[[x,e(y)]]),e(r)==e(T).SCANNED_CODE?(n(),k(P,{key:0},[st,lt],64)):m("",!0),e(r)==e(T).INVALID?(n(),k(P,{key:1},[nt,at],64)):m("",!0),e(r)==e(T).BIND_FAIL?(n(),k(P,{key:2},[rt,it],64)):m("",!0),e(r)==e(T).NORMAL||e(r)==e(T).BIND_SUCCESS||e(r)==e(T).CODE_ERROR?(n(),k(P,{key:3},[dt,ct],64)):m("",!0)])])}}}),pt={class:"flex"},mt={key:0},_t={class:"flex-1 text-tx-primary flex flex-col w-[400px]"},St=B({__name:"index",setup(l){const o=G(),_=K(),y=D({get(){return o.showLogin},set(c){o.showLogin=c}});return ne(()=>o.showLogin,c=>{c||(o.temToken=null)}),(c,g)=>{const u=ae,r=Se;return n(),v(r,{modelValue:e(y),"onUpdate:modelValue":g[0]||(g[0]=b=>Ge(y)?y.value=b:null),width:"auto",class:"login-popup","append-to-body":"","show-close":e(o).loginPopupType!==e(C).BIND_MOBILE,"close-on-click-modal":!1,style:{"border-radius":"16px",overflow:"hidden",padding:"0"}},{default:s(()=>[i("div",pt,[e(_).getWebsiteConfig.pc_login_image&&e(o).loginPopupType==e(C).LOGIN&&!e(_).isMobile?(n(),k("div",mt,[t(u,{class:"w-[320px] h-full",fit:"cover",src:e(_).getWebsiteConfig.pc_login_image},null,8,["src"])])):m("",!0),i("div",_t,[e(o).loginPopupType==e(C).LOGIN?(n(),v(Co,{key:0})):m("",!0),e(o).loginPopupType==e(C).FORGOT_PWD_MAILBOX||e(o).loginPopupType==e(C).FORGOT_PWD_MOBILE?(n(),v(Vo,{key:1})):m("",!0),e(o).loginPopupType==e(C).REGISTER?(n(),v(Uo,{key:2})):m("",!0),e(o).loginPopupType==e(C).BIND_MOBILE?(n(),v(zo,{key:3})):m("",!0),e(o).loginPopupType==e(C).BIND_WEIXIN?(n(),v(ut,{key:4})):m("",!0)])])]),_:1},8,["modelValue","show-close"])}}});export{St as _};
