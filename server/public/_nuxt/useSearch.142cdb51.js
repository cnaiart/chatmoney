import{cF as c,m as x,j as g,l as w}from"./entry.dfbfd4fd.js";import{ModelEnums as b,TypeEnums as y,StatusEnums as i}from"./searchEnums.5f291054.js";import{i as A}from"./isString.78966428.js";import{b as C,a as L}from"./swiper-vue.2eb6bd20.js";function _(){return $request.get({url:"/search/example"})}function $(e){return $request.sse({url:"/search/query",params:e,method:"POST"})}function q(){return $request.get({url:"/search/config"})}const s=c(()=>({model:b.BASE,type:y.ALL,ask:"",probe:0}),"$sd7cibyGCt");C(()=>s.value.model,e=>{e!==b.STUDY&&(s.value.type=y.ALL)},{flush:"post",immediate:!0});let t;const D=()=>{const e=c(()=>({query:"",data:[],status:-1,search:[],outline:{},outline_json:{}}),"$843Kh9xI0P"),r=c(()=>!1,"$T48Tb6Ybal"),l=c(()=>!1,"$JUXG1OFsCM"),f=x(),m=c(()=>({status:0,price:0,isVipFree:!1}),"$Flf2S1CS6o"),p=async()=>{m.value=await q()};return{config:m,getConfig:p,showSearchResult:l,options:s,result:e,launchSearch:async(d="")=>{if(d&&(s.value.ask=d),!f.isLogin)return f.toggleShowLogin();if(!s.value.ask)return g.msgError("请输入你想搜索的问题");if(r.value)return g.msgWarning("正在搜索中...");r.value=!0,l.value=!0,t=$({...s.value,stream:!0}),e.value.query=s.value.ask,e.value.data=[],e.value.status=i.ANALYSIS,e.value.search=[],e.value.outline={},e.value.outline_json={};const k=(h,u,n)=>{const a=e.value.data.find(o=>o.type=="markdown"&&o.target=="update");a?(A(a.content)&&(a.content+=n),w(a.content)&&a.content.push(n),a.target=u):e.value.data.push({type:h,target:u,content:n})};t.onmessage=({data:h})=>{var o;const{card_type:u,target:n,data:a}=h;switch(u){case"error":g.msgError(a),r.value=!1,l.value=!1;break;case"action":{e.value.status=i.SEARCH;break}case"markdown":e.value.status=i.SUMMARY;case"expand_query":case"search_result":case"suggestion":{k(u,n,a);break}case"outline_json":{e.value.outline_json=a;break}case"outline":{e.value.outline=a;break}case"done":{e.value.status=i.SUCCESS+1;const v=e.value.data.findLast(S=>S.type==="search_result");e.value.search=((o=v==null?void 0:v.content)==null?void 0:o.map((S,E)=>({...S,index:E+1})))||[],f.getUser(),p();break}}},t.onerror=()=>{r.value=!1,l.value=!1},t.onclose=()=>{r.value=!1}},abortSearch:()=>{t==null||t.abort()}}},G=()=>{const e=L([]);return{searchEx:e,getSearchEx:async()=>{e.value=await _()}}};export{D as useSearch,G as useSearchEx};
