import{ap as h,m as k,e as M,cX as y}from"./entry.dfbfd4fd.js";import{u as b}from"./usePaging.b2b97b82.js";import{u as C}from"./usePolling.de4d6c35.js";import{DrawModeEnum as w,DrawTypeEnum as P}from"./DrawEnum.ea2da3f6.js";import{r as T,a as t}from"./swiper-vue.2eb6bd20.js";function z(e){return $request.post({url:"/draw.draw/drawing",params:e})}function U(e){return $request.post({url:"/draw.draw_records/detail",params:e})}function j(e){return $request.get({url:"/draw.draw_records/records",params:e})}function F(e){return $request.post({url:"/draw.draw_records/delete",params:e})}function ee(e){return $request.get({url:"/draw.draw_prompt/category",params:e})}function ae(e){return $request.get({url:"/draw.draw_prompt/prompt",params:e})}function re(e){return $request.get({url:"/draw.draw_prompt/example",params:e})}function te(e){return $request.get({url:"/draw.draw_prompt/translate",params:e})}function I(e){return $request.get({url:"/draw.draw/getSdModel",params:e})}function O(){return $request.get({url:"/draw.draw/getSdModelCategory"})}function se(){return $request.get({url:"/draw.draw/getSdSamplers"})}function S(e){return $request.get({url:"/draw.draw/config",params:e})}const m=T({status:-1,model:w.SD}),l=t([]),g=t(!1),o=t(!1),u=t(!1),f=t({}),q=t([]),p=t([]),d=t(0),L=t([]),s=t({draw_api:w.SD,draw_type:"txt2img",draw_model:"",draw_loras:[],denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7},quality:"",style:"",version:"",origin_task_id:""}),{pager:D,getLists:n}=b({fetchFun:j,params:m}),H=async e=>{x()||(m.status=e,o.value=!0,await n(),o.value=!1)},_=()=>{l.value=G(D.lists),l.value.length>0&&X()},R=async()=>{try{o.value=!0,await n(),f.value=await S({draw_api:s.value.draw_api}),o.value=!1,_()}catch{o.value=!1}},A=async e=>{await F({ids:[e]}),h.success("删除成功"),n()},N=async()=>{const e=M();try{if(!l.value.length)return c();const a=await U({records_id:l.value});return(a.filter(r=>(r.status===3&&!e.fullPath.includes("/draw")?y({title:"绘画成功",type:"success",dangerouslyUseHTMLString:!0,message:'<div>点击前往<a class="text-primary font-bold" href="/draw/sd">绘画记录</a>查看</div>',duration:1e4}):r.status===2&&!e.fullPath.includes("/draw/sd")&&y({title:"绘画失败",message:r.fail_reason,type:"error",duration:1e4}),r.status===3||r.status===2)).length||!a.length)&&$(),a}catch(a){c(),console.log("获取详情失败=>",a)}},$=async()=>{c(),console.log("获取详情结束=>"),k().getUser(),await n(),_(),f.value=await S({draw_api:s.value.draw_api})},{start:X,end:c}=C(N,{key:"draw",totalTime:10*60*1e3,time:2e3,callback:$}),B=async e=>{try{c(),await J(e),e.draw_type!=="img2img"&&e.draw_api===w.SD&&(e.image_mask=""),u.value=!0,await z(e),await n(),u.value=!1,g.value=!g.value,_()}catch{u.value=!1}finally{E({action:"generate"})}},G=e=>e.filter(a=>a.status===1).map(a=>a.id),J=e=>new Promise((a,i)=>{try{const r=e||s.value;if(r.draw_type===P.img2img&&r.image_mask==="")throw new Error("请上传参考图");if(r.prompt==="")throw new Error("请输入提示词");if(r.draw_api==="")throw new Error("请选择主要模型");a(!0)}catch(r){h.error(r.message),i(r)}}),K=async()=>O().then(async e=>{L.value=[{label:"全部",value:0},...e.map(a=>({value:a.id,label:a.name}))],d.value=0,await v()}),v=()=>{I({category_id:d.value}).then(e=>{p.value=e})},E=async e=>{if(e){s.value={...s.value,...e};const a=p.value.find(i=>i.model_name===e.draw_model);a&&(d.value=a==null?void 0:a.category_id,await v(),q.value=a.loras)}else s.value={...s.value,draw_model:"",draw_loras:[],denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7}}},x=()=>{const e=k();return e.isLogin||e.toggleShowLogin(),!e.isLogin},oe=Object.freeze(Object.defineProperty({__proto__:null,checkOngoingTask:R,checkUserLogin:x,config:f,createLoading:u,createTask:B,deleteHandle:A,formData:s,getLists:n,getModel:v,getModelCategory:K,loraList:q,modelCategory:d,modelCategoryList:L,modelList:p,pageLoading:o,pager:D,resetFormData:E,scroll:g,taskIds:l,taskStatusChange:H,taskStatusParams:m},Symbol.toStringTag,{value:"Module"}));export{oe as A,f as a,x as b,u as c,B as d,o as e,s as f,n as g,A as h,ae as i,re as j,ee as k,te as l,q as m,K as n,d as o,D as p,L as q,E as r,g as s,H as t,p as u,v,se as w,m as x,R as y,j as z};
