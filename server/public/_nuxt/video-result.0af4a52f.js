import{E as Y}from"./el-segmented.5d590d1a.js";import{E as ee}from"./index.e979a1ab.js";import{_ as te}from"./index.vue.7f39d825.js";import{E as oe}from"./index.8ad94f19.js";import{_ as se}from"./index.vue.79ff26cb.js";import{E as ae}from"./index.828bffd0.js";import{E as re}from"./el-image-viewer.d5621b18.js";import{E as le}from"./el-result.4bbc7c45.js";import{a as ne,v as ie,ah as ce,j as C,ap as de}from"./entry.dfbfd4fd.js";/* empty css               */import"./el-tooltip.4ed993c7.js";/* empty css                  *//* empty css                   */import{b as pe}from"./download.f61d7233.js";import{D as ue}from"./video_empty.69222421.js";import{d as _e}from"./error.77075b9a.js";import{d as me,g as fe}from"./video.14e78cb7.js";import ge from"./video-share.478cbcbe.js";import{E as ve}from"./index.17567b0d.js";import{E as be}from"./index.a258b1c6.js";import{k as he,r as ye,a as R,s as V,j as xe,H as r,I as c,J as s,X as l,u as n,e as ke,$ as z,U as f,V as i,S as D,aj as we,R as d,a7 as B,Z as g,ag as Se,ah as Ee,n as Ce}from"./swiper-vue.2eb6bd20.js";import{_ as Re}from"./_plugin-vue_export-helper.c27b6911.js";import"./isUndefined.aa0326a0.js";import"./index.f647f618.js";import"./___vite-browser-external.5512611b.js";import"./index.9c8f8f3a.js";import"./dropdown.cd5c481a.js";import"./throttle.d40f833a.js";import"./debounce.8cbe4cfc.js";import"./position.4bcf7430.js";import"./el-select.b7a2650e.js";import"./strings.ceb81673.js";import"./isEqual.0df0ab2c.js";import"./_getTag.83294aff.js";import"./_baseIteratee.5e0c38c1.js";import"./index.071e9281.js";import"./castArray.c741e965.js";/* empty css                     */import"./task_reward.d02f9b86.js";import"./index.e94bc8a7.js";import"./index.6c069afb.js";import"./use-dialog.7d399731.js";import"./refs.cabac943.js";/* empty css                  */import"./useLockFn.619a13da.js";const y=v=>(Se("data-v-05d8ce9d"),v=v(),Ee(),v),Ve={class:"bg-body h-full flex-1 rounded-[12px] p-4 flex flex-col gap-4 relative"},ze={class:"sticky top-0"},Ne=y(()=>s("div",{class:"border-b border-b-[#eff0f2] dark:border-[#333333] pb-4 text-2xl font-medium"}," 生成记录 ",-1)),Te={class:"mt-4",style:{"--el-border-radius-base":"12px"}},Ie={key:0,"infinite-scroll-distance":"50"},$e={class:"grid grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-4"},je={class:"flex justify-between"},De={key:0,class:"flex items-center"},Be=["onClick"],Le=["onClick"],Ue=["onClick"],He=["onClick"],Pe=["onClick"],qe={class:"relative flex-1"},Ae={class:"bg-[var(--el-bg-color-page)] rounded-[12px] overflow-hidden"},Fe={key:0,class:"w-full pb-[75%]"},Me={class:"w-full h-full px-4 flex flex-col justify-center items-center absolute left-0 top-0"},Oe=["src"],Ge=y(()=>s("div",{class:"my-[10px]"},"生成视频失败",-1)),Je={class:"text-xs text-[#798696] dark:text-white line-clamp-3 w-full break-all text-center"},Xe={key:1,class:"video-loading w-full pb-[75%]","element-loading-text":"正在生成中..."},Ze={class:"w-full box-border"},Ke={class:"line-clamp-1"},Qe={class:"flex justify-between items-center"},We={class:"text-[#8794A3]"},Ye={key:1,class:"h-full flex items-center justify-center"},et=y(()=>s("div",{class:"text-xl"},"当前任务是空的哦",-1)),tt=y(()=>s("div",{class:"text-info"}," 在左侧输入描述，创建你的作品吧! ",-1)),ot=he({__name:"video-result",emits:["regenerate"],setup(v,{expose:L,emit:U}){const H=ne(),t=ye({pageNo:1,count:0,pageSize:10,loading:!0,lists:[]}),N={1:{label:"生成中",type:"warning"},3:{label:"生成失败",type:"danger"},2:{label:"生成成功",type:"success"}},u=R(-1),P=[{label:"全部",value:-1},{label:"生成中",value:1},{label:"生成成功",value:2},{label:"生成失败",value:3}],x=R(!1),T=V(null),I=R([]),q=async o=>{u.value=o,$()},k=V(),A=async()=>{clearTimeout(k.value),t.lists.filter(a=>a.status===1).map(a=>a.id).length>0&&(k.value=setTimeout(()=>{S()},6e3))},F=async o=>{await C.confirm("确定删除？"),await me({id:o}),de.success("删除成功"),S()},M=async(o,a)=>{if(I.value.includes(o)||a){C.msgError("该视频已分享过了！");return}x.value=!0,await Ce(),T.value.open(o)},O=async(o,a)=>{try{const _=await $request.get({url:o,responseType:"blob",baseURL:""},{isReturnDefaultResponse:!0,apiPrefix:""});console.log(_);const b=new Blob([_._data],{type:_.headers.get("Content-Type")}),p=window.URL.createObjectURL(b);pe(p,a)}catch{C.msgError("文件下载失败")}},w=async()=>{try{const o=await fe({status:u.value,page_no:t.pageNo,page_size:t.pageSize});t.count=o.count,t.pageNo===1&&(t.lists=[]),t.lists.push(...o.lists)}catch{}finally{t.loading=!1,A()}},G=()=>{t.count>=t.pageNo*t.pageSize&&(t.pageNo++,w())},J=o=>{const a={type:o.type,prompt:o.prompt,scale:o.scale,image:o.image,style_id:o.style_id};U("regenerate",a)},S=async()=>{t.pageSize=t.pageNo*t.pageSize,t.pageNo=1,await w()},E=V(),$=async()=>{var o;t.loading=!0,t.pageSize=10,t.pageNo=1,await w(),(o=E.value)==null||o.setScrollTop(0)};return $(),xe(()=>{clearTimeout(k.value)}),L({refresh:async()=>{u.value=-1,await S(),E.value.setScrollTop(0)}}),(o,a)=>{const _=Y,b=ee,p=te,m=oe,X=se,Z=ae,K=re,Q=le,j=ie,W=be;return r(),c("div",Ve,[s("div",ze,[Ne,s("div",Te,[l(_,{class:"task-type !bg-[transparent]",modelValue:n(u),"onUpdate:modelValue":a[0]||(a[0]=e=>ke(u)?u.value=e:null),options:P,onChange:q},null,8,["modelValue"])])]),z((r(),f(n(ve),{class:"video-result flex-1",ref_key:"scrollBarRef",ref:E},{default:i(()=>[n(t).lists.length>0?z((r(),c("div",Ie,[s("div",$e,[(r(!0),c(D,null,we(n(t).lists,(e,st)=>(r(),c("div",{key:e.id,class:"rounded-[12px] p-4 flex flex-col gap-2 border border-[#eff0f2] dark:border-[#333333]"},[s("div",je,[l(b,{type:N[e.status].type,effect:"light"},{default:i(()=>[B(g(N[e.status].label),1)]),_:2},1032,["type"]),e.status!==1||e.status===0?(r(),c("div",De,[e.status===2?(r(),f(m,{key:0,effect:"dark",content:"复制提示词",placement:"bottom"},{default:i(()=>[s("div",{onClick:h=>n(ce)(e.prompt)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-CopyDocument",size:"18",color:"#556477"})],8,Be)]),_:2},1024)):d("",!0),e.status===2?(r(),c(D,{key:1},[l(m,{effect:"dark",content:"下载视频",placement:"bottom"},{default:i(()=>[s("div",{onClick:h=>O(e.video_url,"视频")},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Download",size:"18",color:"#556477"})],8,Le)]),_:2},1024),n(H).getSquareConfig.video_award.is_open?(r(),f(m,{key:0,effect:"dark",content:"分享至广场",placement:"bottom"},{default:i(()=>[s("div",{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md pb-[7px] p-1 box-content",onClick:h=>M(e.id,e.is_share)},[l(p,{name:"local-icon-share",size:"17",color:"#556477"})],8,Ue)]),_:2},1024)):d("",!0)],64)):d("",!0),l(m,{effect:"dark",content:"重新生成",placement:"bottom"},{default:i(()=>[s("div",{onClick:h=>J(e)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-RefreshRight",size:"18",color:"#556477"})],8,He)]),_:2},1024),l(m,{effect:"dark",content:"删除",placement:"bottom"},{default:i(()=>[s("div",{onClick:h=>F(e.id)},[l(p,{class:"cursor-pointer dark:hover:bg-[rgba(255,255,255,0.05)] hover:bg-[rgba(0,0,0,0.05)] rounded-md p-1 box-content",name:"el-icon-Delete",size:"18",color:"#556477"})],8,Pe)]),_:2},1024)])):d("",!0)]),s("div",qe,[s("div",Ae,[e.status===2?(r(),f(X,{key:0,src:e.video_url,type:"video",ratio:[4,3]},null,8,["src"])):d("",!0)]),e.status===3?(r(),c("div",Fe,[s("div",Me,[s("img",{class:"w-1/2 mb-4",src:n(_e),alt:"生成视频失败"},null,8,Oe),Ge,s("div",Je," 错误信息："+g(e.fail_reason),1)])])):d("",!0),e.status===0||e.status===1?z((r(),c("div",Xe,null,512)),[[j,!0]]):d("",!0)]),l(Z,{placement:"bottom",title:"提示词","show-arrow":!1,transition:"custom-popover",width:"300px",trigger:"hover",content:e.prompt},{reference:i(()=>[s("div",Ze,[s("div",Ke,g(e.prompt),1)])]),_:2},1032,["content"]),s("div",Qe,[s("span",We,g(e.create_time),1),l(b,null,{default:i(()=>[B(g(e.type_desc),1)]),_:2},1024)])]))),128))])])),[[W,G]]):n(t).loading?d("",!0):(r(),c("div",Ye,[l(Q,null,{icon:i(()=>[l(K,{class:"w-[150px] dark:opacity-60",src:n(ue)},null,8,["src"])]),title:i(()=>[et]),"sub-title":i(()=>[tt]),_:1})]))]),_:1})),[[j,n(t).loading]]),n(x)?(r(),f(ge,{key:0,ref_key:"shareRef",ref:T,onClose:a[1]||(a[1]=e=>x.value=!1),onSuccess:a[2]||(a[2]=e=>n(I).push(e))},null,512)):d("",!0)])}}});const Zt=Re(ot,[["__scopeId","data-v-05d8ce9d"]]);export{Zt as default};
