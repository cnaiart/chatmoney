import{_ as ue}from"./index.vue.7f39d825.js";import{j as N,d as Z,E as Q,e as de,a as pe,m as me,v as ce}from"./entry.dfbfd4fd.js";import{E as _e,a as fe}from"./index.883ed08b.js";import{E as ge,a as ye}from"./el-radio-group.c427f46d.js";import{P as be}from"./index.e94bc8a7.js";import"./el-form-item.4ed993c7.js";/* empty css                 *//* empty css                */import{k as Y,s as T,r as J,H as m,I as V,X as e,V as a,N as ke,a7 as _,J as c,u as t,Z as E,U as $,R as k,a as I,i as ve,E as we,a6 as xe,$ as he,e as Ve,n as W}from"./swiper-vue.2eb6bd20.js";import{E as Ee,a as Re}from"./el-select.b7a2650e.js";import{a as Ce,E as Se}from"./el-table-column.ac121129.js";import{_ as $e}from"./index.vue.c62cb732.js";import{_ as ze}from"./index.vue.e0bcb29b.js";/* empty css               *//* empty css                     *//* empty css                  *//* empty css                    */import{u as De}from"./usePaging.b2b97b82.js";import{_ as Fe}from"./editPop.vue.5c50c9eb.js";import{i as X,g as qe,h as Ue,j as Ie}from"./my_database.3adef370.js";import{u as Ne}from"./usePolling.de4d6c35.js";const Pe={class:"export-data"},je={class:"flex"},Be=c("span",{class:"flex-none ml-2 mr-2"},"页，至",-1),Le=Y({__name:"index",props:{params:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},fetchFun:{type:Function,required:!0},exportFun:{type:Function}},setup(z){const f=z,R=T(),x=T(),i=J({page_type:0,page_start:1,page_end:200,file_name:""}),P={page_start:[{required:!0,message:"请输入起始页码"},{type:"number",message:"页码必须是整数"},{validator:(r,l,n)=>{if(l<=0)return n(new Error("页码必须大于0"));n()}}],page_end:[{required:!0,message:"请输入结束页码"},{type:"number",message:"页码必须是整数"},{validator:(r,l,n)=>{if(l<=0)return n(new Error("页码必须大于0"));n()}}]},g=J({count:0,sum_page:0,page_size:0,max_page:0,all_max_size:0}),v=async()=>{const r=await f.fetchFun({...f.params,page_size:f.pageSize,export:1});Object.assign(g,r),i.file_name=r.file_name,i.page_end=r.page_end,i.page_start=r.page_start},D=async()=>{var r,l;await((r=R.value)==null?void 0:r.validate()),N.loading("正在导出中...");try{const n=f.exportFun?await f.exportFun({...f.params,...i,page_size:f.pageSize,export:2}):await f.fetchFun({...f.params,...i,page_size:f.pageSize,export:2});(l=x.value)==null||l.close(),N.closeLoading(),n!=null&&n.url&&window.open(n.url,"blank")}catch{N.closeLoading()}};return v(),(r,l)=>{const n=Z,u=_e,w=ge,F=ye,q=Q,j=fe,B=be;return m(),V("div",Pe,[e(B,{ref_key:"popupRef",ref:x,title:"导出设置",width:"500px","confirm-button-text":"确认导出",async:!0,onOpen:v,onConfirm:D},{trigger:a(()=>[ke(r.$slots,"trigger",{},()=>[e(n,null,{default:a(()=>[_("导出")]),_:1})])]),default:a(()=>[c("div",null,[e(j,{ref_key:"formRef",ref:R,model:t(i),"label-width":"120px",rules:P},{default:a(()=>[e(u,{label:"数据量："},{default:a(()=>[_(" 预计导出"+E(t(g).count)+"条数据， 共"+E(t(g).sum_page)+"页，每页"+E(t(g).page_size)+"条数据 ",1)]),_:1}),e(u,{label:"导出限制："},{default:a(()=>[_(" 每次导出最大允许"+E(t(g).max_page)+"页，共"+E(t(g).all_max_size)+"条数据 ",1)]),_:1}),e(u,{prop:"page_type",label:"导出范围：",required:""},{default:a(()=>[e(F,{modelValue:t(i).page_type,"onUpdate:modelValue":l[0]||(l[0]=y=>t(i).page_type=y)},{default:a(()=>[e(w,{label:0},{default:a(()=>[_("全部导出")]),_:1}),e(w,{label:1},{default:a(()=>[_("分页导出")]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(i).page_type==1?(m(),$(u,{key:0,label:"分页范围："},{default:a(()=>[c("div",je,[e(u,{prop:"page_start"},{default:a(()=>[e(q,{style:{width:"140px"},modelValue:t(i).page_start,"onUpdate:modelValue":l[1]||(l[1]=y=>t(i).page_start=y),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1}),Be,e(u,{prop:"page_end"},{default:a(()=>[e(q,{style:{width:"140px"},modelValue:t(i).page_end,"onUpdate:modelValue":l[2]||(l[2]=y=>t(i).page_end=y),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1})])]),_:1})):k("",!0),e(u,{label:"导出文件名称：",prop:"file_name"},{default:a(()=>[e(q,{modelValue:t(i).file_name,"onUpdate:modelValue":l[3]||(l[3]=y=>t(i).file_name=y),placeholder:"请输入导出文件名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:3},512)])}}}),Te={class:"pb-[20px] flex items-center font-bold cursor-pointer"},Oe={class:"ml-2"},Ke={class:"flex"},Me={class:"ml-auto flex"},Ae={class:"min-w-[240px]"},Ge={class:"min-w-[180px] ml-2"},He={key:0},Je={key:1,class:"text-warning"},We={key:2,class:"text-success"},Xe={key:3,class:"text-danger"},Ze={key:4,class:"text-danger"},Qe={class:"flex justify-end mt-4"},vt=Y({__name:"itemList",props:{itemId:{type:Number,default:0},itemName:{type:String,default:""}},emits:["back"],setup(z,{emit:f}){const R=z,x=de(),i=pe(),P=me(),g=x.query.id,v=I(),D=ve("knowDetail"),r=I(!1),l=T(),n=I({keyword:"",status:"",fd_id:R.itemId,kb_id:x.query.id}),{pager:u,getLists:w,resetPage:F,resetParams:q}=De({fetchFun:X,params:n.value}),j=I(0),B=async()=>{const d=u.lists.map(p=>p.uuid),{tasks:s,lists:b}=await Ie({...n.value,uuids:d});u.lists.map(p=>{const U=b.findIndex(L=>p.uuid==L.uuid);p.status=b[U].status,p.tokens=b[U].tokens}),j.value=s.length,s.length==0&&(ee(),P.getUser())},y=async()=>{B()},{start:C,end:ee}=Ne(y,{time:3e3,key:"kb_id"}),te=async()=>{r.value=!0,await W(),l.value.open({kb_id:x.query.id,fd_id:R.itemId})},ae=async d=>{r.value=!0,await W(),l.value.open({kb_id:x.query.id,fd_id:R.itemId,uuid:d})},O=async d=>{await qe({kb_id:g,uuids:d}),w(),C()},K=async d=>{await N.confirm("请确认是否删除！"),await Ue({kb_id:g,uuids:d}),w(),C()},oe=async()=>{var s;const d=(s=v.value)==null?void 0:s.getSelectionRows().map(b=>b.uuid);await K(d)},se=async()=>{var s;const d=(s=v.value)==null?void 0:s.getSelectionRows().map(b=>b.uuid);await O(d)},ne=()=>{F()};return we(async()=>{await w(),C()}),(d,s)=>{var A,G;const b=ue,p=Z,U=Le,L=Q,S=Ee,le=Re,h=Se,M=$e,ie=ze,re=ce;return m(),V("div",null,[c("div",Te,[c("div",{onClick:s[0]||(s[0]=o=>d.$emit("back")),class:"flex items-center"},[e(b,{name:"el-icon-Back",size:"16"}),c("span",Oe,E(z.itemName),1)])]),c("div",Ke,[c("div",null,[e(p,{type:"primary",disabled:t(D).power===3,onClick:te},{default:a(()=>[_(" 录入数据 ")]),_:1},8,["disabled"]),e(U,{class:"mx-2.5 inline-block","fetch-fun":t(X),params:t(n),"page-size":t(u).size},{trigger:a(()=>[e(p,{disabled:t(D).power===3},{default:a(()=>[_(" 一键导出 ")]),_:1},8,["disabled"])]),_:1},8,["fetch-fun","params","page-size"]),e(p,{disabled:!((A=t(v))!=null&&A.getSelectionRows().length),onClick:se},{default:a(()=>[_(" 批量重试 ")]),_:1},8,["disabled"]),e(p,{disabled:!((G=t(v))!=null&&G.getSelectionRows().length),onClick:oe},{default:a(()=>[_(" 批量删除 ")]),_:1},8,["disabled"])]),c("div",Me,[c("div",Ae,[e(L,{modelValue:t(n).keyword,"onUpdate:modelValue":s[1]||(s[1]=o=>t(n).keyword=o),placeholder:"请输入问题/回答内容关键词进行搜索",clearable:"",onKeyup:xe(t(F),["enter"])},null,8,["modelValue","onKeyup"])]),c("div",Ge,[e(le,{modelValue:t(n).status,"onUpdate:modelValue":s[2]||(s[2]=o=>t(n).status=o),onChange:ne},{default:a(()=>[e(S,{label:"全部",value:""}),e(S,{label:"等待学习",value:0}),e(S,{label:"学习中",value:1}),e(S,{label:"学习失败",value:3}),e(S,{label:"学习成功",value:2})]),_:1},8,["modelValue"])])])]),he((m(),$(t(Ce),{ref_key:"tableRef",ref:v,class:"mt-4",data:t(u).lists,size:"large","row-class-name":"h-[70px]"},{default:a(()=>[e(h,{type:"selection",width:"55"}),e(h,{label:"文档内容",prop:"question","min-width":"200"},{default:a(({row:o})=>[e(M,{content:o.question,line:2,teleported:!0,effect:"light",placement:"right"},null,8,["content"])]),_:1}),e(h,{label:"补充内容",prop:"answer","min-width":"200"},{default:a(({row:o})=>[e(M,{content:o.answer||"-",line:2,teleported:!0,effect:"light",placement:"right"},null,8,["content"])]),_:1}),e(h,{label:"学习状态",prop:"source","min-width":"150"},{default:a(({row:o})=>[o.status==0?(m(),V("div",He,"等待学习")):k("",!0),o.status==1?(m(),V("div",Je," 学习中 ")):k("",!0),o.status==2?(m(),V("div",We," 学习成功 ")):k("",!0),o.status==3?(m(),V("div",Xe," 学习失败 ")):k("",!0),o.status==3?(m(),V("div",Ze," 原因："+E(o.error),1)):k("",!0)]),_:1}),e(h,{label:`消耗${t(i).getTokenUnit}`,prop:"tokens","min-width":"150"},null,8,["label"]),e(h,{label:"最后更新时间",prop:"update_time","min-width":"150"}),e(h,{label:"操作",prop:"source","min-width":"180"},{default:a(({row:o})=>[o.status!=1?(m(),$(p,{key:0,type:"primary",onClick:H=>ae(o.uuid),link:""},{default:a(()=>[_("修正")]),_:2},1032,["onClick"])):k("",!0),o.status==3?(m(),$(p,{key:1,type:"primary",onClick:H=>O([o.uuid]),link:""},{default:a(()=>[_("重试")]),_:2},1032,["onClick"])):k("",!0),e(p,{type:"danger",onClick:H=>K([o.uuid]),link:""},{default:a(()=>[_("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,t(u).loading]]),c("div",Qe,[e(ie,{modelValue:t(u),"onUpdate:modelValue":s[3]||(s[3]=o=>Ve(u)?u.value=o:null),onChange:s[4]||(s[4]=()=>{t(C)(),t(w)()})},null,8,["modelValue"])]),t(r)?(m(),$(Fe,{key:0,ref_key:"popEntryRef",ref:l,onSuccess:s[5]||(s[5]=()=>{r.value=!1,t(w)(),t(C)()}),onClose:s[6]||(s[6]=o=>r.value=!1)},null,512)):k("",!0)])}}});export{vt as _};
