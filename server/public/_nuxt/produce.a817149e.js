import{k as de,a as f,s as ce,p as ue,r as J,aa as E,b as B,j as pe,H as V,I as H,X as w,V as L,J as _,S as me,aj as fe,u as a,e as M,aw as ve,U as ge,T as _e,Z as he,R as ye,n as xe,ax as we}from"./swiper-vue.2eb6bd20.js";import{_ as Se}from"./index.5054c8b8.js";import{C as Ce,a as ke,_ as Ie}from"./create-results.6f6d04aa.js";import{e as be,a as Le,m as Re,h as Ee,cE as Ve,j as D,l as Me,_ as De}from"./entry.dfbfd4fd.js";import{u as $}from"./asyncData.eaddccf2.js";import{u as $e}from"./useLockFn.619a13da.js";import ze from"./create-panel.31bcd096.js";import Ne from"./model-select.5a683e1a.js";import{b as Ue,e as Te,c as Fe}from"./chat.01f4dab8.js";import{g as qe,a as Ae,b as Be}from"./create.257daca9.js";import{u as He}from"./recharge.97d70211.js";import{c as X}from"./cloneDeep.4e82bacf.js";import{_ as je}from"./_plugin-vue_export-helper.c27b6911.js";import"./el-select.b7a2650e.js";import"./index.8ad94f19.js";import"./isUndefined.aa0326a0.js";import"./index.17567b0d.js";import"./index.e979a1ab.js";import"./strings.ceb81673.js";import"./isEqual.0df0ab2c.js";import"./_getTag.83294aff.js";import"./debounce.8cbe4cfc.js";import"./_baseIteratee.5e0c38c1.js";import"./index.071e9281.js";import"./castArray.c741e965.js";import"./index.vue.7f39d825.js";import"./el-collapse.1527f898.js";import"./index.93ec1a3c.js";/* empty css               *//* empty css                     *//* empty css                  */import"./index.e94bc8a7.js";import"./index.6c069afb.js";import"./use-dialog.7d399731.js";import"./refs.cabac943.js";/* empty css                  */import"./useQuery.ba65a97e.js";import"./el-segmented.5d590d1a.js";import"./index.vue.74e23ebc.js";import"./index.edaf9b5e.js";import"./useAudioPlay.fe45c428.js";import"./el-empty.6e01cec2.js";import"./index.vue.c62cb732.js";import"./el-tooltip.4ed993c7.js";import"./useCopy.5611cfa5.js";import"./create_record_null.e42f56ab.js";import"./index.a258b1c6.js";import"./position.4bcf7430.js";import"./throttle.d40f833a.js";import"./index.883ed08b.js";import"./_baseClone.20563df6.js";import"./el-form-item.4ed993c7.js";/* empty css                */import"./el-radio-group.c427f46d.js";/* empty css                        */import"./index.76d1875c.js";import"./nuxt-link.42058260.js";import"./el-image-viewer.d5621b18.js";const Ke=(S,o="yyyy-mm-dd")=>{S||(S=Number(new Date)),S.toString().length===10&&(S*=1e3);const i=new Date(S);let p;const C={"y+":i.getFullYear().toString(),"m+":(i.getMonth()+1).toString(),"d+":i.getDate().toString(),"h+":i.getHours().toString(),"M+":i.getMinutes().toString(),"s+":i.getSeconds().toString()};for(const v in C)p=new RegExp(`(${v})`).exec(o),p&&(o=o.replace(p[1],p[1].length===1?C[v]:C[v].padStart(p[1].length,"0")));return o},Oe={class:"flex flex-col h-full"},Pe={class:"px-[16px] pt-[16px] round-[12px]"},Je=["onClick"],Xe={class:"flex-1 min-h-0 flex"},Ze={class:"py-[16px] pl-[16px]"},Ge={class:"flex-1 min-w-0 p-4"},Ye={class:"h-full flex bg-body rounded-[12px]"},Qe={class:"h-full border-r border-solid border-br-light"},We={class:"flex-1 min-w-0"},et=de({__name:"produce",async setup(S){let o,i;const p=f(""),C=be();He();const v=f(!0),j=f([]),u=f({}),z=Le(),Z=Re(),N=Ee(),{cateId:G,modelId:Y}=C.query,k=f("current"),I=ce({});ue("chatModel",I);const s=J({cateId:G||"0",modelId:Y,modelKey:""}),Q=async e=>{s.cateId=e,await K();const[t]=q.value||[];N.replace({path:"",query:{cateId:e,modelId:t==null?void 0:t.id}})},{data:U,pending:tt,refresh:ot}=([o,i]=E(()=>$(()=>qe(),{default(){return[]},lazy:!0},"$3iMOmfmgi4")),o=await o,i(),o);f(!1),f(0);let T=null;const F=e=>{try{T==null||T.slideTo(e)}catch(t){console.error(t)}},{data:q,refresh:K}=([o,i]=E(()=>$(()=>Ae({keyword:p.value,category_id:s.cateId}),{lazy:!0},"$VSSSR0UZJy")),o=await o,i(),o);Ve(p,e=>{K()},{debounce:500});const W=async()=>{await D.confirm("确定清空创作记录？"),await Ue({type:2,other_id:s.modelId}),d.value=[],R()},{data:b,refresh:ee}=([o,i]=E(()=>$(()=>Be({id:s.modelId}),{default(){return{}},transform(e){return e},lazy:!0},"$dzxelPzSXF")),o=await o,i(),o),c=J({pageNo:1,count:0,pageSize:15,lists:[]}),{refresh:A,pending:te}=([o,i]=E(()=>$(()=>Te({other_id:s.modelId||0,page_size:c.pageSize,page_no:c.pageNo,type:2}),{default(){return[]},transform(e){c.count=e.count;const t=e.lists.map(n=>{let m="";if(Me(n.ask)){const h=(n==null?void 0:n.ask[0])||{};m=`${h.title}：${h.value}`}else m=n.ask;return{...n,title:m}});return c.pageNo===1&&(c.lists=[]),c.lists.push(...t),t},lazy:!0},"$T4LGrdB7sx")),o=await o,i(),o),R=async()=>{Object.assign(c,{pageNo:1,count:0,pageSize:15,lists:[]}),await A()},oe=()=>{te.value||c.count>=c.pageNo*c.pageSize&&(c.pageNo++,A())},re=e=>{console.log("model",e),s.modelId=e.id,R()},{lockFn:ae}=$e(async e=>{e.extra&&(u.value=e.extra,await xe(),O())}),le=()=>{var e,t;(t=(e=b.value)==null?void 0:e.form)==null||t.forEach(n=>{n.props.placeholder&&!n.props.defaultValue&&(u.value[n.props.field]=n.props.placeholder)})},se=()=>{var e;(e=b.value)==null||e.form.forEach(t=>{t.props.defaultValue?u.value[t.props.field]=X(t.props.defaultValue):u.value[t.props.field]=void 0})},ne=()=>{v.value?(v.value=!1,j.value=[]):(j.value=U.value.map(e=>e.id),v.value=!0)},d=f([]),ie=()=>{var t;const e=((t=b.value)==null?void 0:t.form[0])||{};return`${e.props.title}：${u.value[e.props.field]||""}`},g=f(!1);let r;const O=async()=>{if(!g.value){k.value="current",g.value=!0,d.value=[],F(1);try{r=Fe({other_id:s.modelId,question:u.value,type:2,creation_type:ke.Normal,model:s.modelKey}),r.addEventListener("close",async()=>{Z.getUser(),setTimeout(async()=>{g.value=!1,await R();const e=d.value.length;d.value[e-1].id=c.lists[0].id},200)}),r.addEventListener("error",async e=>{var t;if(((t=e.data)==null?void 0:t.code)===1100){z.getIsShowRecharge?(await D.confirm(`${z.getTokenUnit}数量已用完，请前往充值`),N.push("/user/recharge")):D.msgError(`${z.getTokenUnit}数量已用完。请联系客服增加`);return}e.errorType==="connectError"&&D.msgError("请求失败，请重试"),setTimeout(()=>{g.value=!1,F(0)},200)}),r.addEventListener("chat",({data:e})=>{const{id:t,event:n,data:m,code:h,index:y}=e;let x=d.value.findIndex(l=>l.id===t);x===-1&&(d.value.push({create_time:Ke(Date.now(),"yyyy-mm-dd hh:MM:ss"),title:u.value.question?u.value.question:ie(),reply:[],extra:X(u.value),id:t}),x=d.value.length-1),m&&(d.value[x].reply[y]||(d.value[x].reply[y]=""),d.value[x].reply[y]+=m)}),r.addEventListener("finish",({data:e})=>{const{data:t,index:n,id:m}=e,h=d.value.findIndex(y=>y.id===m);t&&(d.value[h].reply[n]+=t),se()})}catch{g.value=!1}}};B(U,e=>{v.value=!1,ne()},{immediate:!0});const P=()=>{r==null||r.removeEventListener("close"),r==null||r.removeEventListener("chat"),r==null||r.removeEventListener("error"),r==null||r.removeEventListener("finish"),r==null||r.abort(),g.value=!1};return B(()=>C.query,({cateId:e,modelId:t})=>{s.cateId=e,s.modelId=t,d.value=[],k.value="current",F(0),P(),t?(ee(),R()):b.value={}}),B(()=>q.value,e=>{e.length&&s.modelId==null&&N.replace({path:"",query:{cateId:s.cateId,modelId:e[0].id}})},{deep:!0}),pe(()=>{P()}),(e,t)=>{const n=we,m=ve,h=Se,y=Ie,x=De;return V(),H("div",null,[w(x,{name:"default"},{default:L(()=>[_("div",Oe,[_("div",Pe,[w(m,{slidesPerView:"auto",spaceBetween:16,class:"my-swiper category-lists"},{default:L(()=>[(V(!0),H(me,null,fe(a(U),(l,rt)=>(V(),ge(n,{key:l.id,style:{width:"auto"}},{default:L(()=>[Object.keys(l).includes("name")?(V(),H("div",{key:0,class:_e(["category-item",{"is-active":a(s).cateId==l.id}]),onClick:at=>Q(l.id)},he(l.name),11,Je)):ye("",!0)]),_:2},1024))),128))]),_:1})]),_("div",Xe,[_("div",Ze,[w(Ne,{modelValue:a(p),"onUpdate:modelValue":t[0]||(t[0]=l=>M(p)?p.value=l:null),"model-state":a(s),"current-model-list":a(q),onSelect:re},null,8,["modelValue","model-state","current-model-list"])]),_("div",Ge,[_("div",Ye,[_("div",Qe,[w(ze,{modelValue:a(u),"onUpdate:modelValue":t[3]||(t[3]=l=>M(u)?u.value=l:null),class:"h-full 2xl:w-[400px] xl:w-[350px] lg:w-[320px] w-[250px]","model-data":a(b),loading:a(g),onInsert:le,onCreate:O},{actions:L(()=>[w(h,{class:"w-full my-[10px]",sub_id:a(s).modelKey,"onUpdate:sub_id":t[1]||(t[1]=l=>a(s).modelKey=l),modelConfig:a(I),"onUpdate:modelConfig":t[2]||(t[2]=l=>M(I)?I.value=l:null)},null,8,["sub_id","modelConfig"])]),_:1},8,["modelValue","model-data","loading"])]),_("div",We,[w(y,null,{default:L(()=>[w(Ce,{current:a(k),"onUpdate:current":t[4]||(t[4]=l=>M(k)?k.value=l:null),chatModel:a(I),"current-creation-history":a(d),loading:a(g),"page-info":a(c),onLoad:oe,onClean:W,onRewrite:a(ae),onRefresh:a(A)},null,8,["current","chatModel","current-creation-history","loading","page-info","onRewrite","onRefresh"])]),_:1})])])])])])]),_:1})])}}});const co=je(et,[["__scopeId","data-v-3ec7ff71"]]);export{co as default};
