"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/video.js"),s=require("../../../utils/client.js"),a=require("../../../hooks/useCopy.js"),o=require("../../../utils/download.js"),u=require("../../../common/assets.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-loading")+e.resolveComponent("u-tag")+e.resolveComponent("z-paging")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+i)();const i=()=>"./_components/video-share.js",n=e.defineComponent({__name:"video_list",setup(i){const n=e.useRouter(),r=e.shallowRef(),{copy:l}=a.useCopy(),p=e.ref([]),c=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}],d=e.ref(!1),m=e.shallowRef(null),v=e.ref([]),g=e.ref(-1),f=e.reactive({show:!1,item:{}}),h=async()=>{await l(f.item.video_url),f.show=!1},y=e.shallowRef(),w=async(e,s)=>{try{const{lists:a}=await t.getVideoLists({page_no:e,page_size:s,status:g.value});r.value.complete(a)}catch(a){r.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(y.value),[-1,1].includes(g.value)&&p.value.some((e=>1===e.status))&&(y.value=setTimeout((()=>{j()}),6e3))}),100)}},j=()=>{var e;null==(e=r.value)||e.refresh()};return e.watch(g,(()=>{j()})),e.onUnmounted((()=>{clearTimeout(y.value)})),(a,i)=>e.e({a:a.$theme.navColor,b:a.$theme.navBgColor,c:a.$theme.pageStyle,d:e.p({"back-text":"历史记录"}),e:e.f(c,((t,s,a)=>({a:e.t(t.name),b:t.type===g.value?1:"",c:e.o((e=>g.value=t.type),t.type),d:t.type}))),f:e.f(p.value,((a,i,r)=>e.e({a:1===a.status},1===a.status?{b:"39eee475-2-"+r+",39eee475-0",c:e.p({mode:"flower",size:"80"})}:{},{d:2===a.status||3===a.status},2===a.status||3===a.status?e.e({e:2===a.status},2===a.status?{f:"39eee475-3-"+r+",39eee475-0",g:e.p({text:a.status_desc,"border-color":"transparent",type:"success"})}:{},{h:3===a.status},3===a.status?{i:"39eee475-4-"+r+",39eee475-0",j:e.p({text:a.status_desc,"border-color":"transparent",type:"error"})}:{},{k:2===a.status},2===a.status?{l:e.unref(u._imports_1$2),m:e.o((t=>e.unref(l)(a.prompt)),a.id),n:e.unref(u.IconDownload),o:e.o((e=>(e=>{s.isWeixinClient()?(f.show=!0,f.item=e):o.downloadFile(e.video_url,"视频","video")})(a)),a.id)}:{},{p:e.unref(u.IconReload),q:e.o((t=>(async t=>{const s={type:t.type,prompt:t.prompt,scale:t.scale,image:t.image,style_id:t.style_id};getCurrentPages().length>1?(await n.navigateBack(),e.index.$emit("videoRegenerate",s)):await n.redirectTo({path:"/packages/pages/video/video",query:{data:JSON.stringify(s)}})})(a)),a.id),r:e.unref(u.IconShare),s:e.o((t=>(async(t,s)=>{if((v.value.includes(t)||s)&&(await e.index.showModal({title:"温馨提示",content:"该视频已分享过，是否确认重复分享？"})).cancel)return;d.value=!0,await e.nextTick$1(),m.value.open(t)})(a.id,a.is_share)),a.id),t:e.unref(u.IconDelete),v:e.o((s=>(async s=>{const{cancel:a}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});a||(await t.deleteVideo({id:s}),j())})(a.id)),a.id),w:3===a.status},3===a.status?e.e({x:e.unref(u.ImageError),y:a.fail_reason},a.fail_reason?{z:e.t(a.fail_reason)}:{}):2===a.status?{B:a.video_url}:{},{A:2===a.status,C:e.t(a.prompt),D:e.t(a.create_time),E:"39eee475-5-"+r+",39eee475-0",F:e.p({text:a.type_desc,size:"mini","border-color":"transparent"})}):{},{G:a.id}))),g:e.sr(r,"39eee475-0",{k:"pagingRef"}),h:e.o(w),i:e.o((e=>p.value=e)),j:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:p.value}),k:e.o(h),l:e.p({type:"primary",shape:"circle"}),m:e.o((e=>f.show=e)),n:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:f.show}),o:d.value},d.value?{p:e.sr(m,"39eee475-8",{k:"shareRef"}),q:e.o((e=>d.value=!1)),r:e.o((e=>v.value.push(e)))}:{})}});wx.createPage(n);
