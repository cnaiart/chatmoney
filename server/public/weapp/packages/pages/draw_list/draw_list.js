"use strict";const e=require("../../../common/vendor.js"),a=require("../../../api/draw.js"),t=require("../../../utils/client.js"),s=require("../../../hooks/useCopy.js"),o=require("../../../utils/download.js"),r=require("../../../common/assets.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-loading")+e.resolveComponent("u-tag")+e.resolveComponent("u-image")+e.resolveComponent("z-paging")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+i)();const i=()=>"./_components/draw-share.js",n=e.defineComponent({__name:"draw_list",setup(i){const n={1:"文生图",2:"图生图",3:"选中放大",4:"选中变换"},u=e.useRouter(),l=e.shallowRef(),{copy:p}=s.useCopy(),m=e.ref([]),c={0:{label:"生成中",type:"warning"},1:{label:"生成中",type:"warning"},2:{label:"生成失败",type:"error"},3:{label:"生成成功",type:"success"}},d=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:3},{name:"生成失败",type:2}],g=e.ref(!1),v=e.shallowRef(null),w=e.ref([]),h=e.ref(-1),y=e.reactive({show:!1,item:{}}),f=async()=>{await p(y.item.image),y.show=!1},_=e.shallowRef(),j=async(e,t)=>{try{const{lists:s}=await a.drawingRecord({page_no:e,page_size:t,status:h.value});l.value.complete(s)}catch(s){l.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(_.value),[-1,1].includes(h.value)&&m.value.some((e=>1===e.status))&&(_.value=setTimeout((()=>{q()}),6e3))}),100)}},q=()=>{var e;null==(e=l.value)||e.refresh()};return e.watch(h,(()=>{q()})),e.onUnmounted((()=>{clearTimeout(_.value)})),(s,i)=>e.e({a:s.$theme.navColor,b:s.$theme.navBgColor,c:s.$theme.pageStyle,d:e.p({"back-text":"历史记录"}),e:e.f(d,((a,t,s)=>({a:e.t(a.name),b:a.type===h.value?1:"",c:e.o((e=>h.value=a.type),a.type),d:a.type}))),f:e.f(m.value,((i,l,m)=>e.e({a:1===i.status},1===i.status?{b:"2e32eca9-2-"+m+",2e32eca9-0",c:e.p({mode:"flower",size:"80"})}:{},{d:2===i.status||3===i.status},2===i.status||3===i.status?e.e({e:"2e32eca9-3-"+m+",2e32eca9-0",f:e.p({text:c[i.status].label,"border-color":"transparent",type:c[i.status].type}),g:3===i.status},3===i.status?{h:e.unref(r._imports_1$2),i:e.o((a=>e.unref(p)(i.prompt)),i.id),j:e.unref(r.IconDownload),k:e.o((e=>(e=>{t.isWeixinClient()?(y.show=!0,y.item=e):o.downloadFile(e.image,"图片","image")})(i)),i.id),l:e.unref(r.IconShare),m:e.o((a=>(async a=>{const t={image:a.image,prompts:a.prompt,records_id:a.id};if((w.value.includes(a.id)||a.is_share)&&(await e.index.showModal({title:"温馨提示",content:"该图片已分享过，是否确认重复分享？"})).cancel)return;g.value=!0,await e.nextTick$1(),v.value.open(t)})(i)),i.id)}:{},{n:e.unref(r.IconReload),o:e.o((a=>(async a=>{const t={draw_model:a.engine,image_mask:a.image_base,negative_prompt:a.negative_prompt,prompt:a.prompt,size:a.scale,draw_loras:a.loras};a.image_base&&(t.draw_type="img2img"),getCurrentPages().length>1?(await u.navigateBack(),e.index.$emit("drawRegenerate",t)):await u.redirectTo({path:"/packages/pages/video/video",query:{data:JSON.stringify(t)}})})(i)),i.id),p:e.unref(r.IconDelete),q:e.o((t=>(async t=>{const{cancel:s}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});s||(await a.drawingDelete({ids:[t]}),q())})(i.id)),i.id),r:2===i.status},2===i.status?e.e({s:e.unref(r.ImageError),t:i.fail_reason},i.fail_reason?{v:e.t(i.fail_reason)}:{}):3===i.status?{x:"2e32eca9-5-"+m+",2e32eca9-4-"+m,y:e.p({mode:"circle",color:s.$theme.primaryColor,size:"40"}),z:"2e32eca9-4-"+m+",2e32eca9-0",A:e.p({src:i.image,width:"640rpx",height:"640rpx",mode:"aspectFit","border-radius":"0"})}:{},{w:3===i.status,B:e.t(i.prompt),C:e.t(i.create_time),D:"2e32eca9-6-"+m+",2e32eca9-0",E:e.p({text:n[i.type],size:"mini","border-color":"transparent"}),F:e.o((e=>(e=>{2!==e.status&&u.navigateTo({path:"/packages/pages/draw_detail/draw_detail",query:{data:encodeURIComponent(JSON.stringify(e))}})})(i)),i.id)}):{},{G:i.id}))),g:e.sr(l,"2e32eca9-0",{k:"pagingRef"}),h:e.o(j),i:e.o((e=>m.value=e)),j:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:m.value}),k:e.o(f),l:e.p({type:"primary",shape:"circle"}),m:e.o((e=>y.show=e)),n:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:y.show}),o:g.value},g.value?{p:e.sr(v,"2e32eca9-9",{k:"shareRef"}),q:e.o((e=>g.value=!1)),r:e.o((e=>w.value.push(e)))}:{})}});wx.createPage(n);
