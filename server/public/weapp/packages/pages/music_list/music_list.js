"use strict";const e=require("../../../common/vendor.js"),a=require("../../../common/assets.js"),t=require("../../../api/music.js"),s=require("../../../hooks/useCopy.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../enums/constantEnums.js"),require("../../../utils/auth.js"),require("../../../utils/cache.js"),require("../../../utils/unique-id.js"),require("../../../router/index.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-image")+e.resolveComponent("u-icon")+e.resolveComponent("u-loading")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-loading/u-loading.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+u)();const u=()=>"./_components/music-share.js",o=e.defineComponent({__name:"music_list",setup(u){const o=e.useRouter(),i=e.shallowRef(),{copy:n}=s.useCopy(),r=e.ref([]),l=[{name:"全部",type:-1},{name:"生成中",type:1},{name:"生成成功",type:2},{name:"生成失败",type:3}],m=e.ref(!1),c=e.shallowRef(null),p=e.ref([]),d=e.ref(-1),v=e.reactive({show:!1,item:{}}),f=e.computed((()=>{const e=[{value:"delete",text:"删除",color:"#EA0000"}];return 2==v.item.status&&e.unshift({value:"download",text:"下载"}),e})),h=e=>{v.show=!0,v.item=e},w=e.ref(),g=async a=>{const s=f.value[a].value,u=v.item;switch(s){case"delete":(async a=>{const{cancel:s}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});s||(await t.deleteMusic({id:a}),_())})(u.id);break;case"download":w.value=!0}},j=async()=>{await n(v.item.audio_url),w.value=!1},q=e.shallowRef(),y=async(e,a)=>{try{const{lists:s}=await t.getMusicLists({page_no:e,page_size:a,status:d.value});i.value.complete(s)}catch(s){i.value.complete(!1)}finally{setTimeout((()=>{clearTimeout(q.value),[-1,1].includes(d.value)&&r.value.some((e=>1===e.status))&&(q.value=setTimeout((()=>{_()}),6e3))}),100)}},_=()=>{var e;null==(e=i.value)||e.refresh()};return e.watch(d,(()=>{_()})),e.onUnmounted((()=>{clearTimeout(q.value)})),(t,s)=>e.e({a:t.$theme.navColor,b:t.$theme.navBgColor,c:t.$theme.pageStyle,d:e.p({"back-text":"历史记录"}),e:e.f(l,((a,t,s)=>({a:e.t(a.name),b:a.type===d.value?1:"",c:e.o((e=>d.value=a.type),a.type),d:a.type}))),f:e.f(r.value,((t,s,u)=>e.e({a:"5df6aa96-2-"+u+",5df6aa96-0",b:e.p({src:t.image_url,width:"100%",height:"100%"}),c:e.t(t.duration),d:"5df6aa96-3-"+u+",5df6aa96-0",e:e.o((a=>(async(a,t)=>{if((p.value.includes(a)||t)&&(await e.index.showModal({title:"温馨提示",content:"该音乐已分享过，是否确认重复分享？"})).cancel)return;m.value=!0,await e.nextTick$1(),c.value.open(a)})(t.id,t.is_share)),t.id),f:e.t(t.title),g:e.t(t.create_time),h:"5df6aa96-4-"+u+",5df6aa96-0",i:e.o((e=>h(t)),t.id),j:3==t.status||1==t.status},3==t.status||1==t.status?e.e({k:1==t.status},1==t.status?{l:"5df6aa96-5-"+u+",5df6aa96-0",m:e.p({size:50,mode:"flower"})}:{n:"5df6aa96-6-"+u+",5df6aa96-0",o:e.p({name:e.unref(a.music_fail),size:50}),p:e.t(t.create_time),q:"5df6aa96-7-"+u+",5df6aa96-0",r:e.p({name:"more-dot-fill",size:32}),s:e.o((e=>h(t)),t.id)}):{},{t:e.o((e=>{return a=t.id,void o.navigateTo({path:"/packages/pages/music_player/music_player",query:{id:a}});var a}),t.id),v:t.id}))),g:a._imports_0$4,h:e.p({name:"share"}),i:e.p({name:"more-dot-fill",size:32}),j:e.sr(i,"5df6aa96-0",{k:"pagingRef"}),k:e.o(y),l:e.o((e=>r.value=e)),m:e.p({"auto-clean-list-when-reload":!1,"safe-area-inset-bottom":!0,fixed:!0,modelValue:r.value}),n:e.o(g),o:e.o((e=>v.show=e)),p:e.p({"safe-area-inset-bottom":!0,list:e.unref(f),modelValue:v.show}),q:e.o(j),r:e.p({type:"primary",shape:"circle"}),s:e.o((e=>w.value=e)),t:e.p({mode:"center","border-radius":"15",closeable:!0,modelValue:w.value}),v:m.value},m.value?{w:e.sr(c,"5df6aa96-11",{k:"shareRef"}),x:e.o((e=>m.value=!1)),y:e.o((e=>p.value.push(e)))}:{})}});wx.createPage(o);
