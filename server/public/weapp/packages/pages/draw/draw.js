"use strict";const e=require("../../../common/vendor.js"),a=require("../../../stores/app.js"),o=require("../../../stores/user.js"),r=require("../../../hooks/useLockFn.js"),s=require("../../../api/draw.js"),t=require("../../../utils/util.js");if(require("../../../api/app.js"),require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../router/index.js"),require("../../../utils/cache.js"),require("../../../enums/constantEnums.js"),require("../../../config/index.js"),require("../../../utils/client.js"),require("../../../enums/appEnums.js"),require("../../../api/shop.js"),require("../../../api/user.js"),require("../../../utils/auth.js"),require("../../../utils/unique-id.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("router-navigate")+e.resolveComponent("u-navbar")+e.resolveComponent("u-form")+e.resolveComponent("u-button")+e.resolveComponent("tabbar"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../node-modules/uniapp-router-next/components/router-navigate/router-navigate.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+p+i+n+u+m+l+(()=>"../../../uni_modules/vk-uview-ui/components/u-form/u-form.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../components/tabbar/tabbar.js"))();const i=()=>"./components/prompt.js",n=()=>"./components/draw-size.js",u=()=>"./components/draw-model.js",m=()=>"./components/draw-lora.js",l=()=>"./components/draw-options.js",p=()=>"./components/uploader-picture.js";var d=(e=>(e.TEXT="txt2img",e.IMAGE="img2img",e))(d||{});const c=e.defineComponent({__name:"draw",setup(i){const n=e.useRouter(),u=e.useRoute(),m=e.shallowRef(),l=a.useAppStore(),p=o.useUserStore(),c=e.ref([{mode:"txt2img",name:"文生图"},{mode:"img2img",name:"图生图"}]),g=e.ref({draw_api:"sd",draw_type:"txt2img",draw_model:"",draw_loras:"",denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7}}),v=e.reactive({model:{cate:[],list:[]},config:{},loras:[],samplers:[]}),_=async()=>{v.config=await s.getSdConfig()},w=async()=>s.getModelCategoryList().then((async e=>{const a=e.map((e=>({value:e.id,label:e.name})));v.model.cate=[{label:"全部",value:0},...a],await j()})),j=async(e=0)=>{const a=await s.getModelList({category_id:e});v.model.list=a},f=async()=>{v.samplers=await s.getSdSamplersList()},q=t.series(_,w,j,f),{lockFn:b,isLock:y}=r.useLockFn((async()=>{try{if("img2img"===g.value.draw_type&&""===g.value.image_mask)return e.index.$u.toast("请上传参考图");if(""===g.value.prompt)return e.index.$u.toast("请输入提示词");if(""===g.value.draw_api)return e.index.$u.toast("请选择主要模型");"img2img"!==g.value.draw_type&&(g.value.image_mask=""),await s.drawing({...g.value}),g.value.prompt="",n.navigateTo("/packages/pages/draw_list/draw_list")}catch(a){}}));return q(),e.onLoad((()=>{e.index.$on("drawRegenerate",(e=>{Object.assign(g.value,e)}));const a=u.query;try{const e=JSON.parse(a.data);Object.assign(g.value,e)}catch(o){}})),(a,o)=>e.e({a:a.$theme.navColor,b:a.$theme.navBgColor,c:a.$theme.pageStyle,d:e.p({name:"clock",size:32}),e:e.p({to:"/packages/pages/draw_list/draw_list"}),f:e.p({"back-text":"绘画工作台"}),g:e.f(c.value,((a,o,r)=>({a:e.t(a.name),b:a.mode,c:g.value.draw_type===a.mode?1:"",d:e.o((e=>g.value.draw_type=a.mode),a.mode)}))),h:"img2img"===g.value.draw_type},"img2img"===g.value.draw_type?{i:e.o((e=>g.value.image_mask=e)),j:e.p({modelValue:g.value.image_mask})}:{},{k:e.o((e=>g.value.prompt=e)),l:e.o((e=>g.value.negative_prompt=e)),m:e.p({example:v.example,typeEnum:d,showTranslate:!!v.config.translate_switch,modelValue:g.value.prompt,negative:g.value.negative_prompt}),n:e.o((e=>g.value.size=e)),o:e.p({modelValue:g.value.size}),p:e.o((e=>j(e))),q:e.o((e=>g.value.draw_model=e)),r:e.p({"cate-list":v.model.cate,"model-list":v.model.list,modelValue:g.value.draw_model}),s:e.o((e=>g.value.draw_loras=e)),t:e.p({"model-list":v.model.list,"current-lora":g.value.draw_model,modelValue:g.value.draw_loras}),v:e.o((e=>g.value.complex_params=e)),w:e.p({samplers:v.samplers,modelValue:g.value.complex_params}),x:e.sr(m,"dd03f716-3",{k:"uFormRef"}),y:e.p({model:g.value,"label-position":"top","border-bottom":!1}),z:v.config.is_member},(v.config.is_member,{}),{A:0!=v.config.power&&!v.config.is_member&&e.unref(p).isLogin},0!=v.config.power&&!v.config.is_member&&e.unref(p).isLogin?{B:e.t(v.config.power||"--"),C:e.t(e.unref(l).getTokenUnit)}:{},{D:e.o(e.unref(b)),E:e.p({type:"primary",loading:e.unref(y)})})}});wx.createPage(c);
