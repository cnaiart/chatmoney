"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/robot.js"),u=require("../../../../stores/user.js"),i=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../router/index.js"),require("../../../../utils/cache.js"),require("../../../../enums/constantEnums.js"),require("../../../../config/index.js"),require("../../../../utils/client.js"),require("../../../../enums/appEnums.js"),require("../../../../api/user.js"),require("../../../../utils/auth.js"),require("../../../../utils/unique-id.js"),require("../../../../api/app.js"),require("../../../../api/shop.js"),!Array){(e.resolveComponent("u-search")+e.resolveComponent("u-tag")+e.resolveComponent("u-icon")+e.resolveComponent("u-image")+e.resolveComponent("z-paging")+e.resolveComponent("u-action-sheet"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-tag/u-tag.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-image/u-image.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+s+t+(()=>"../../../../uni_modules/vk-uview-ui/components/u-action-sheet/u-action-sheet.js")+o)();const s=()=>"../add-btn.js",t=()=>"./add-popup.js",o=()=>"./share-popup.js",r=e.defineComponent({__name:"index",props:{tabIndex:null,currentIndex:null},setup(s,{expose:t}){const o=s,r=u.useUserStore(),n=i.useAppStore(),l=e.ref([]),c=e.shallowRef(),d=e.ref(!1),p=e.ref(!1),v=e.ref(!1),h=e.ref(""),m=e.reactive({show:!1,currentId:-1,isShare:-1}),g=e.shallowRef([{value:"begin",text:"开始对话"},{value:"release",text:"发布智能体"},{value:"dialogue",text:"对话数据"},{value:"share",text:"分享至广场"},{value:"delete",text:"删除"}]),f=e.ref(!1),j=e.shallowRef(null),w=e.ref([]),x=e=>{w.value.push(e),I()},q=async u=>{const i=g.value[u].value,s=m.currentId;switch(i){case"delete":(async u=>{const{cancel:i}=await e.index.showModal({title:"温馨提示",content:"确定删除？"});if(i)return;await a.delRobot({id:u});const s=l.value.findIndex((e=>e.id==u));l.value.splice(s,1)})(s);break;case"dialogue":case"release":k(s,i);break;case"share":m.isShare?await a.cancelShare({id:s}):(async(a,u)=>{if((w.value.includes(a)||u)&&(await e.index.showModal({title:"温馨提示",content:"该音乐已分享过，是否确认重复分享？"})).cancel)return;f.value=!0,await e.nextTick$1(),j.value.open(a)})(s,m.isShare),I();break;case"begin":b.navigateTo({path:"/packages/pages/robot_chat/robot_chat",query:{id:s}})}},b=e.useRouter(),k=(e,a)=>{b.navigateTo({path:"/packages/pages/robot_info/robot_info",query:{id:e,type:a||null}})},_=async()=>{if(!r.isLogin)return b.navigateTo("/pages/login/login");if(r.userInfo.robot_num<=0){if(n.getIsShowRecharge){const{cancel:a}=await e.index.showModal({title:"温馨提示",content:"智能体数量已用完，请前往充值"});if(a)return;b.navigateTo({path:"/packages/pages/recharge/recharge"})}else e.index.$u.toast("智能体数量已用完。请联系客服增加");return Promise.reject()}v.value=!0},y=async(e,u)=>{var i,s;try{const{lists:s=[]}=await a.getRobotLists({page_size:u,page_no:e,keyword:h.value});null==(i=c.value)||i.complete(s)}catch(t){null==(s=c.value)||s.complete(!1)}},I=()=>{e.nextTick$1((()=>{c.value&&c.value.refresh()}))};return e.watch((()=>o.currentIndex),(a=>{a===o.tabIndex&&(d.value||e.nextTick$1((()=>{setTimeout((()=>{p.value=!0}),100)})))}),{immediate:!0}),t({reload:I}),(a,u)=>e.e({a:d.value||p.value},d.value||p.value?{b:e.o((a=>e.unref(c).reload())),c:e.o((a=>e.unref(c).reload())),d:e.o((a=>e.unref(c).reload())),e:e.o((e=>h.value=e)),f:e.p({placeholder:"请输入关键词搜索",height:"72","bg-color":"#F7F8F9",modelValue:h.value}),g:e.f(l.value,((a,u,i)=>e.e({a:a.is_public},a.is_public?{b:"9c3d3604-2-"+i+",9c3d3604-0",c:e.p({type:"warning",text:"公开",size:"mini"})}:{d:"9c3d3604-3-"+i+",9c3d3604-0",e:e.p({type:"primary",text:"私有",size:"mini"})},{f:"9c3d3604-4-"+i+",9c3d3604-0",g:e.o((e=>{return u=a.id,i=a.is_share,s=a.is_public,m.show=!0,m.currentId=u,m.isShare=i,void(g.value[3].text=s?"取消发布广场":"分享至广场");var u,i,s}),a.id),h:e.o((()=>{}),a.id),i:"9c3d3604-5-"+i+",9c3d3604-0",j:e.p({src:a.image,width:"100",height:"100",shape:"circle"}),k:e.t(a.name),l:e.t(a.intro||"这个智能体还没介绍呢"),m:e.o((e=>k(a.id)),a.id),n:a.id}))),h:e.p({name:"more-dot-fill"}),i:e.sr(c,"9c3d3604-0",{k:"pagingRef"}),j:e.o(y),k:e.o((e=>l.value=e)),l:e.p({"auto-clean-list-when-reload":!1,fixed:!1,modelValue:l.value})}:{},{m:e.o(_),n:e.o((a=>e.unref(c).reload())),o:e.o((e=>v.value=e)),p:e.p({modelValue:v.value}),q:e.o(q),r:e.o((e=>m.show=e)),s:e.p({list:e.unref(g),modelValue:m.show}),t:f.value},f.value?{v:e.sr(j,"9c3d3604-9",{k:"shareRef"}),w:e.o((e=>f.value=!1)),x:e.o(x)}:{})}});wx.createComponent(r);
