import{d as e,L as l,u as t,A as a,s,G as i,M as o,H as r,o as u,k as c,b as m,w as n,f as d,F as p,l as f,e as x,c as _,p as g,g as A,t as y,B as k,z as h,ad as b,r as v,a as w,j,i as C,h as B,q as U,I,m as V,R as X,S as L}from"./index-9f08b835.js";import{_ as z}from"./page-meta.d2ccf398.js";import{_ as q}from"./u-icon.f0423eb2.js";import{_ as F}from"./router-navigate.3e9d7fb5.js";import{_ as E}from"./u-navbar.9b578443.js";import{_ as S}from"./u-input.6dc4a2b4.js";import{_ as J}from"./u-form-item.95df05ac.js";import{_ as Q}from"./u-loading.15b95fef.js";import{_ as T}from"./l-textarea.5288c032.js";import{_ as O}from"./u-switch.2a75b2d9.js";import{_ as R}from"./u-image.e6fb9592.js";import{_ as Z}from"./u-form.1bf0b756.js";import{_ as D}from"./u-button.cd082997.js";import{_ as G}from"./tabbar.vue_vue_type_script_setup_true_lang.da8cbb67.js";import{g as K,p as W,a as Y}from"./music.82052fd1.js";import{u as H}from"./useLockFn.cde70c0d.js";import{_ as P}from"./_plugin-vue_export-helper.1b428a4d.js";import"./emitter.1571a5d9.js";import"./u-badge.508fc5b2.js";const M=P(e({__name:"music",setup(e){const P=h();b();const M=l(),N=t(),$=a(),ee=s([{mode:0,name:"灵感模式",tips:"只需输入一段歌曲描述，即可生成一首歌"},{mode:1,name:"歌词模式",tips:"输入自己的歌词，即可生成一首歌"}]),le=i({channel:"go_api",custom_mode:0,title:"",prompt:"",style_id:[],is_style_custom:0,style_custom:"",make_instrumental:0,version:""}),te=o((()=>0===le.custom_mode)),ae=s(8),se=e=>ce.value.style.slice(ae.value*e,ae.value*(e+1)),ie=o((()=>Math.ceil(ce.value.style.length/ae.value))),oe=()=>{$.isLogin||P.navigateTo("/pages/login/login")},re=()=>{le.is_style_custom=le.is_style_custom?0:1},ue=(e,l)=>{X({title:e,content:l,showCancel:!1})},ce=s({model:{},style:[],imagine:{}}),me=o((()=>!te.value&&ce.value.imagine.status)),ne=o((()=>ce.value.model[le.channel]||{})),{lockFn:de,isLock:pe}=H((async()=>{if(!le.title)return uni.$u.toast("请输入歌曲名称");const e=await W({prompt:le.title});le.prompt=e.content})),{lockFn:fe,isLock:xe}=H((async()=>{try{if(!le.title)return uni.$u.toast("请输入歌曲名称");if(!le.prompt)return uni.$u.toast("请输入"+(te.value?"歌曲描述":"歌词"));await Y({...le,style_id:le.is_style_custom?[]:le.style_id}),le.prompt="",le.title="",le.style_id=[],le.style_custom="",P.navigateTo("/packages/pages/music_list/music_list")}catch(e){}}));return r((()=>{(async()=>{ce.value=await K(),le.channel=ce.value.channel,le.version||(le.version=Object.keys(ne.value.version)[0]||"")})()})),(e,l)=>{const t=v(w("page-meta"),z),a=v(w("u-icon"),q),s=j,i=v(w("router-navigate"),F),o=v(w("u-navbar"),E),r=v(w("u-input"),S),h=v(w("u-form-item"),J),b=v(w("u-loading"),Q),X=C,K=B,W=v(w("l-textarea"),T),Y=v(w("u-switch"),O),H=v(w("u-image"),R),P=L,$=U,ae=v(w("u-form"),Z),_e=I,ge=v(w("u-button"),D),Ae=v(w("tabbar"),G);return u(),c(p,null,[m(t,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),m(s,{class:"h-full flex flex-col"},{default:n((()=>[m(o,{"back-text":"音乐"},{right:n((()=>[m(i,{to:"/packages/pages/music_list/music_list"},{default:n((()=>[m(s,{class:"flex items-center mr-[20rpx]"},{default:n((()=>[m(s,{class:"text-primary flex"},{default:n((()=>[m(a,{name:"clock",size:32})])),_:1}),m(s,{class:"text-muted ml-[10rpx]"},{default:n((()=>[d("历史记录")])),_:1})])),_:1})])),_:1})])),_:1}),m(s,{class:"p-[20rpx]"},{default:n((()=>[m(s,{class:"flex p-[14rpx] bg-white rounded-full"},{default:n((()=>[(u(!0),c(p,null,f(ee.value,(e=>(u(),_(s,{key:e.mode,class:V(["flex items-center px-[10rpx] py-[5rpx] flex-1 justify-center text-primary rounded-full",{"!bg-primary !text-white":le.custom_mode===e.mode}]),onClick:l=>le.custom_mode=e.mode},{default:n((()=>[m(s,null,{default:n((()=>[d(y(e.name),1)])),_:2},1024),m(s,{class:"flex p-[16rpx]",onClick:g((l=>ue(e.name,e.tips)),["stop"])},{default:n((()=>[m(a,{name:"error-circle",size:32})])),_:2},1032,["onClick"])])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),m(s,{class:"flex-1 min-h-0"},{default:n((()=>[m(_e,{class:"h-full","scroll-y":""},{default:n((()=>[m(s,{class:"px-[20rpx]"},{default:n((()=>[m(ae,{ref_key:"uFormRef",ref:M,model:le,"label-position":"top","border-bottom":!1},{default:n((()=>[m(h,{label:"歌曲名称",prop:"title",required:""},{default:n((()=>[m(s,{class:"flex-1 min-w-0"},{default:n((()=>[m(r,{"placeholder-style":"color: #9CA3AF;",height:80,modelValue:le.title,"onUpdate:modelValue":l[0]||(l[0]=e=>le.title=e),placeholder:"给你的歌曲起个好听的名字",border:!0,onClick:oe},null,8,["modelValue"])])),_:1})])),_:1}),m(h,{label:x(te)?"歌曲描述":"歌词","label-position":"left",required:"","label-width":x(te)?250:70},{default:n((()=>[m(s,{class:"flex flex-1"},{default:n((()=>[x(te)?A("v-if",!0):(u(),_(s,{key:0,class:"flex",onClick:l[1]||(l[1]=g((e=>ue("温馨提示","建议歌词长度100-1250，太长或太短容易生成失败")),["stop"]))},{default:n((()=>[m(a,{name:"error-circle",size:32})])),_:1})),m(s,{class:"flex items-center text-content text-xs ml-auto",onClick:l[2]||(l[2]=g((e=>le.prompt=""),["stop"]))},{default:n((()=>[m(a,{name:"trash"}),m(s,{class:"ml-[8rpx]"},{default:n((()=>[d(" 清空 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["label","label-width"]),m(h,null,{default:n((()=>[m(s,{class:"flex-1 min-w-0 overflow-hidden mt-[-25rpx]"},{default:n((()=>[m(W,{modelValue:le.prompt,"onUpdate:modelValue":l[3]||(l[3]=e=>le.prompt=e),maxlength:"1300",rows:4,"show-word-limit":!0,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入"+(x(te)?"灵感，，例如写一首关于夏天的歌曲":"歌词"),onClick:oe},{"length-suffix":n((()=>[m(s,{class:"flex length-suffix"},{default:n((()=>[m(s,{class:"flex-1"},{default:n((()=>[x(me)?(u(),_(s,{key:0,class:"inline-flex items-center text-primary bg-primary-light-9 rounded-[10rpx] px-[15rpx] leading-[50rpx]",onClick:g(x(de),["stop"])},{default:n((()=>[x(pe)?(u(),_(b,{key:0,mode:"flower",color:e.$theme.primaryColor,size:"24"},null,8,["color"])):(u(),_(X,{key:1,class:"w-[24rpx] h-[24rpx]",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAxCAYAAACcXioiAAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAUOSURBVGiB7VnLcdtIFOw3A50XIWAjWPoqiyUwAksBUAIjsBSBxAgkRSDYDkByBEKVtL6ajsDYCJZ7tTGv90CQBGmAxPCzLldtnzhT8+nHeX8I9oTXfXchghuIZIHIaZbKeB/3mH0cCgAiuAIAkLGDi/d1z94EABA2/N4p9inAf4L/BfjZCH42gSbECSMHFzvY0adURk3rGgU4TNixqg8EQjG8fE6DdC9MaxAnjJzqEyGRgY7jhL83ueFGFbLUcwIRgJAq992kOPEhIUDus36KOXlE5VT4bf77BzTbgPJLdUiV+8OEndZMDIciyEWQWtjHNltqyAMi2SoVklUHHp25a6AMSBOM1ZjeqgNL3e1QpSOC3wCEJP4Sw9zCZlkqeXvyGAViequi+EoBfITo9ouExpyDjFceKDIC+TEw5nZKLE4YOtXPvuSBFm705b29BjCsTIWGvJ8ODhN2umfuK0Xu15IHALID4KpQ/Tq1Kwd3sgn5VgJMhRBBujx/dOauzfI/1x4hVR665+7GwmazWQ/yk+UeODpz1xA5VpFLo3qCRdWaHChIIfzoYPOpmk19OijHJE6wlBuJIKXoO3ESWWsffTJXLwEWBFkiL4LUihk2GekUccLQUa9IXCztv31+Zy99uXgLcJR8j6HmqTpH4vLPD/a2bn2cMCzIewE7AB4p+vElPci6SZFQ5QaV1xBy8PzBL2B6C9A9c1+rOi+Gg1VRelbYLNwqj4HIoEDRqf4ZAuTWmN66V6zCK5nr9otkyWCH61IMA/6oz+SJU/0cIMhR8XAEokI18eHkJQCNOZ8NBKPSxa5EqRJDkcXUgkBUUB9e3tvratohwDk80FqF4oRhofr3bKPh6XMatEoRpijt5wFLeg8AFJnFFhjTe0kla3Nm6xdwcNVkbrzgu1viJT3IAmNeAZirlciVtUu5kmrc9sz29QDlj8ql2aZdhiyV/OjM3aF0wwSib0BkRLJZJJfJXd1+kVAkqqVDjA+seQxqvUQVk7bIwFHnzw7mm5CfIjAmLVQX4wiYcz4Mu0lxQq2o1Q+0AKf61szaH02YtEU6i1P4ZyPmJbJUchKXZbp9W5fdUmVt6k4gDAQYc03bg+BYNgvajSgDX23wA8pXIo9XJYgkhoE1pvfd6YlIvRBC5s/pQdY9d2/mkxV72BEI6QATJRIwz1KTA+it2xeUUa/xn5hB+QUyeQWhR2XWAqWLjmZXKb6sWL6A1m7U2rnbJBAdJS1y/5YoW49zJ2G1seJbRmsBslRySMXYyNXG7wHSvK0Mxy/pQdZ2r1cqIap3lVvjbr9IfPbX4XXfXSwZ6l3T2lpOvhcuZaPjwJhXPtljFYcJO0b1CXP1GQfGNPaA6uDdWqTRQWUYOtUnr3ZLiRryEMOBb4T3FqDUz4UU2Kh+ft13F827FjGtpVElL7j1TQ6BDUtKAOieu5vlshDAcF2K3VSOPr+zg/odq7Fxd7qsX6vtlra5/Nul8XBT8sCW7fWX9/ZaDGeXr2uvxAkjLOr8aZuiaBW2/j5A2HzTvRa2dcBqwi//geOXF2DnX2hW5UgOLtzC8dViawEUGC884yQ41YI7Jg/sQIU+pTLa6GuMyGjTFKSKndiANabnI4QAeSByuou7d/amccLwGxCZFl/l2/Z82mArAeKE3q3AKqatkW1UaSsjLsgHABuXlyJAQb5Bi9q3CdvZABlttR+AYLsztjXiO1TbhP4Yq/pVYMv4F7BDYuZt/gOrAAAAAElFTkSuQmCC"})),m(K,{class:"ml-[8rpx]"},{default:n((()=>[m(K,null,{default:n((()=>[d(" 智能联想 ")])),_:1}),ce.value.imagine.price>0?(u(),_(K,{key:0},{default:n((()=>[d("：消耗"+y(ce.value.imagine.price)+y(x(N).getTokenUnit),1)])),_:1})):A("v-if",!0)])),_:1})])),_:1},8,["onClick"])):A("v-if",!0)])),_:1})])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})])),_:1}),m(h,{prop:"version",label:"选择版本",required:""},{default:n((()=>[k("div",{class:"flex flex-wrap"},[(u(!0),c(p,null,f(x(ne).version,((e,l)=>(u(),_(s,{key:e,class:V(["mr-[20rpx] h-[70rpx] leading-[70rpx] px-[40rpx] rounded-[8rpx] border-solid border-light border-[1px]",{"!text-primary !border-primary":le.version===String(l)}]),onClick:e=>le.version=String(l)},{default:n((()=>[d(y(e),1)])),_:2},1032,["class","onClick"])))),128))])])),_:1}),x(te)?(u(),_(h,{key:0,label:"纯音乐","label-position":"left","label-width":"150"},{default:n((()=>[m(s,{class:"flex justify-end flex-1"},{default:n((()=>[m(Y,{modelValue:le.make_instrumental,"onUpdate:modelValue":l[4]||(l[4]=e=>le.make_instrumental=e)},null,8,["modelValue"])])),_:1})])),_:1})):A("v-if",!0),x(te)?A("v-if",!0):(u(),c(p,{key:1},[m(h,{label:"音乐风格","label-position":"left","label-width":"200"},{default:n((()=>[m(s,{class:"flex-1 min-w-0 flex justify-end"},{default:n((()=>[m(s,{class:"text-primary",onClick:re},{default:n((()=>[d(y(le.is_style_custom?"系统风格":"自定义风格"),1)])),_:1})])),_:1})])),_:1}),m(h,{class:"mt-[-15px]"},{default:n((()=>[le.is_style_custom?(u(),_(s,{key:1,class:"flex-1 min-w-0 overflow-hidden"},{default:n((()=>[m(W,{modelValue:le.style_custom,"onUpdate:modelValue":l[5]||(l[5]=e=>le.style_custom=e),maxlength:"1024",rows:4,"show-word-limit":!1,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:"请输入自定义风格，多个风格以,隔开"},null,8,["modelValue"])])),_:1})):(u(),_(s,{key:0,class:"flex-1 min-w-0 bg-white rounded-[16rpx]"},{default:n((()=>[m($,{class:"h-[520rpx]",circular:"","indicator-dots":x(ie)>1,"indicator-active-color":e.$theme.primaryColor},{default:n((()=>[(u(!0),c(p,null,f(x(ie),((e,l)=>(u(),_(P,{key:l},{default:n((()=>[m(s,{class:"flex flex-wrap px-[20rpx] pt-[20rpx] mx-[-10rpx]"},{default:n((()=>[(u(!0),c(p,null,f(se(l),(e=>(u(),_(s,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:n((()=>[m(s,{class:"h-full cursor-pointer",onClick:l=>(e=>{const l=le.style_id.findIndex((l=>l===e));-1!==l?le.style_id.splice(l,1):le.style_id.push(e)})(e.id)},{default:n((()=>[m(s,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:n((()=>[m(s,{class:"absolute inset-0 left-0 top-0"},{default:n((()=>[m(H,{src:e.image,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),le.style_id.includes(e.id)?(u(),_(s,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:n((()=>[m(a,{name:"checkmark-circle-fill",size:40})])),_:1})):A("v-if",!0)])),_:2},1024),m(s,{class:"text-center text-xs"},{default:n((()=>[d(y(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["indicator-dots","indicator-active-color"])])),_:1}))])),_:1})],64))])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),m(s,{class:"p-[20rpx] bg-white"},{default:n((()=>[m(ge,{type:"primary",loading:x(xe),onClick:x(fe)},{default:n((()=>[m(s,null,{default:n((()=>[m(K,{class:"text-xl font-bold"},{default:n((()=>[d("立即生成")])),_:1}),ce.value.is_member?(u(),_(K,{key:0,class:"text-sm ml-[4px]"},{default:n((()=>[d(" 会员免费 ")])),_:1})):x(ne).price>0?(u(),_(K,{key:1,class:"text-sm ml-[4px]"},{default:n((()=>[d(" 消耗 "+y(x(ne).price)+" "+y(x(N).getTokenUnit),1)])),_:1})):A("v-if",!0)])),_:1})])),_:1},8,["loading","onClick"])])),_:1}),m(Ae)])),_:1})],64)}}}),[["__scopeId","data-v-6d020803"]]);export{M as default};
