import{d as e,u as a,A as l,s as t,bf as s,L as u,bc as o,H as r,Z as n,a9 as i,aa as c,a2 as d,ab as p,bg as m,a4 as f,o as v,k as x,b as _,w as b,g as h,f as g,t as w,e as y,c as k,F as j,bh as V,$ as C,a0 as I,a3 as U,a8 as N,bi as $,O as A,bj as B,bk as E,bl as D,bm as z,r as M,a as O,j as T,a5 as H,a6 as L,a7 as S}from"./index-9f08b835.js";import{_ as W}from"./page-meta.d2ccf398.js";import{_ as X}from"./avatar-upload.c4d4d1d3.js";import{_ as G}from"./u-icon.f0423eb2.js";import{_ as R}from"./u-button.cd082997.js";import{_ as F}from"./u-form-item.95df05ac.js";import{_ as K}from"./u-popup.6c89de8e.js";import{_ as P}from"./u-input.6dc4a2b4.js";import{_ as Z}from"./u-verification-code.cfa37ce6.js";import{_ as q}from"./u-action-sheet.11119791.js";import{u as J}from"./useCopy.7659937f.js";import{F as Q}from"./floating-menu.a8f47c3e.js";import{_ as Y}from"./_plugin-vue_export-helper.1b428a4d.js";import"./lodash.d83f57d8.js";import"./_commonjsHelpers.157f59fb.js";import"./emitter.1571a5d9.js";const ee=Y(e({__name:"user_set",setup(e){const Y=a(),{copy:ee}=J(),ae=l(),le=t({}),te=t(s.NONE),se=t(!1),ue=t(!1),oe=t(!1),re=t(!1),ne=t([{text:"修改密码"},{text:"忘记密码"}]),ie=t(""),ce=t(""),de=t(""),pe=t(""),me=t(""),fe=u(),ve=async()=>{le.value=await V()},xe=e=>{me.value=e},_e=async()=>{var e,a;if(!de.value)return uni.$u.toast("请输入新的手机号码");(null==(e=fe.value)?void 0:e.canGetCode)&&(await C({scene:le.value.mobile?I.CHANGE_MOBILE:I.BIND_MOBILE,mobile:de.value}),uni.$u.toast("发送成功"),null==(a=fe.value)||a.start())},be=async e=>{d({title:"正在上传中..."});try{const a=await U(e);he(a.uri),f()}catch(a){f(),uni.$u.toast(a)}},he=e=>{te.value=s.AVATAR,we(e)},ge=async()=>{await N({type:le.value.mobile?"change":"bind",mobile:de.value,code:pe.value}),uni.$u.toast("操作成功"),oe.value=!1,ve()},we=async e=>{await $({field:te.value,value:e}),uni.$u.toast("操作成功"),ve()},ye=()=>""==ce.value?uni.$u.toast("账号不能为空"):ce.value.length>10?uni.$u.toast("账号长度不得超过十位数"):(te.value=s.USERNAME,we(ce.value),void(ue.value=!1)),ke=async e=>(ie.value=e.detail.value.nickname,""==ie.value?uni.$u.toast("昵称不能为空"):ie.value.length>10?uni.$u.toast("昵称长度不得超过十位数"):(te.value=s.NICKNAME,await we(ie.value),void(se.value=!1))),je=()=>{A.navigateTo("/packages/pages/cancelaccount/cancelaccount")},Ve=()=>{if(!le.value.has_password)return A.navigateTo("/packages/pages/change_password/change_password?type=set");re.value=!0},Ce=e=>{switch(e){case 0:A.navigateTo("/packages/pages/change_password/change_password");break;case 1:A.navigateTo("/packages/pages/forget_pwd/forget_pwd?type="+(le.value.mobile?2:3))}},Ie=()=>{ae.logout(),A.reLaunch("/pages/index/index")},Ue=t(!0);Ue.value=o();const Ne=async()=>{if(!(null==le?void 0:le.value.has_auth)){d({title:"请稍后..."});try{if(B()==E.MP_WEIXIN){const{code:e}=await D({provider:"weixin"});await z({code:e})}else B()==E.OA_WEIXIN&&i.getUrl(c.BIND_WX)}catch(e){uni.$u.toast(e)}finally{f()}}};return r((async()=>{ve()})),n((async e=>{const{code:a,scene:l}=i.getAuthData();if(a.length&&l===c.BIND_WX){d({title:"请稍后..."}),p.set("code",a);try{await m({code:a})}catch(t){}finally{f(),i.setAuthData()}}})),(e,a)=>{const l=M(O("page-meta"),W),t=M(O("avatar-upload"),X),s=T,u=M(O("u-icon"),G),o=M(O("u-button"),R),r=H,n=M(O("u-form-item"),F),i=L,c=S,d=M(O("u-popup"),K),p=M(O("u-input"),P),m=M(O("u-verification-code"),Z),f=M(O("u-action-sheet"),q);return v(),x(j,null,[_(l,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),_(s,{class:"user-set p-[20rpx]"},{default:b((()=>[_(s,{class:"bg-white rounded-[14rpx]"},{default:b((()=>[_(s,{class:"header pt-[30rpx]"},{default:b((()=>[_(s,{class:"flex justify-center pb-5"},{default:b((()=>[_(t,{modelValue:le.value.avatar,"onUpdate:modelValue":a[0]||(a[0]=e=>le.value.avatar=e),"file-key":"url",round:!0,onUpload:be},{footer:b((()=>[])),_:1},8,["modelValue"])])),_:1})])),_:1}),_(s,{class:"px-[20rpx]"},{default:b((()=>[h(" 用户ID "),h("                <view"),h('                    class="item text-nr flex justify-between"'),h('                    @click="'),h("                        ;(showUserName = true),"),h("                            (newUsername = userInfo?.username)"),h('                    "'),h("                >"),h('                    <view class="label">账号</view>'),h('                    <view class="content">{{ userInfo?.account }}</view>'),h('                    <u-icon name="arrow-right" size="22" color="#666"></u-icon>'),h("                </view>"),h(" 昵称 "),_(s,{class:"item text-nr flex justify-between",onClick:a[1]||(a[1]=e=>{var a;se.value=!0,ie.value=null==(a=le.value)?void 0:a.nickname})},{default:b((()=>[_(s,{class:"label"},{default:b((()=>[g("昵称")])),_:1}),_(s,{class:"content"},{default:b((()=>{var e;return[g(w(null==(e=le.value)?void 0:e.nickname),1)]})),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),_(s,{class:"item text-nr flex justify-between",onClick:a[2]||(a[2]=e=>{var a;return y(ee)(null==(a=le.value)?void 0:a.sn)})},{default:b((()=>[_(s,{class:"label"},{default:b((()=>[g("用户ID")])),_:1}),_(s,{class:"content"},{default:b((()=>{var e;return[g(w(null==(e=le.value)?void 0:e.sn),1)]})),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1}),h(" 手机号 "),_(s,{class:"item text-nr flex justify-between"},{default:b((()=>[_(s,{class:"label"},{default:b((()=>[g("手机号")])),_:1}),_(s,{class:"content"},{default:b((()=>{var e,a;return[g(w(""==(null==(e=le.value)?void 0:e.mobile)?"未绑定手机号":null==(a=le.value)?void 0:a.mobile),1)]})),_:1}),_(o,{onClick:a[3]||(a[3]=e=>oe.value=!0),size:"mini",type:"primary",shape:"circle",plain:!0},{default:b((()=>{var e;return[g(w(""==(null==(e=le.value)?void 0:e.mobile)?"绑定手机号":"更换手机号"),1)]})),_:1})])),_:1}),h(" 注册时间 "),_(s,{class:"item text-nr flex justify-between"},{default:b((()=>[_(s,{class:"label"},{default:b((()=>[g("注册时间")])),_:1}),_(s,{class:"content"},{default:b((()=>{var e;return[g(w(null==(e=le.value)?void 0:e.create_time),1)]})),_:1})])),_:1}),h(" 微信绑定 "),Ue.value?(v(),k(s,{key:0,class:"item text-nr flex justify-between",onClick:Ne},{default:b((()=>{var e;return[_(s,{class:"label"},{default:b((()=>[g("微信绑定")])),_:1}),_(s,{class:"content"},{default:b((()=>{var e;return[g(w(0==(null==(e=le.value)?void 0:e.has_auth)?"未绑定":"已绑定"),1)]})),_:1}),0==(null==(e=le.value)?void 0:e.has_auth)?(v(),k(u,{key:0,name:"arrow-right",size:"22",color:"#666"})):h("v-if",!0)]})),_:1})):h("v-if",!0)])),_:1})])),_:1}),h(" 登录密码 "),_(s,{class:"text-nr flex justify-between mt-[20rpx] rounded-[14rpx] px-[30rpx] bg-white h-[100rpx] items-center",onClick:Ve},{default:b((()=>[_(s,{class:""},{default:b((()=>[g("登录密码")])),_:1}),_(u,{name:"arrow-right",color:"#666"})])),_:1}),h(" 注销账号 "),1==y(Y).getSwitchConfig.account_cancelled?(v(),k(s,{key:0,class:"text-nr flex justify-between mt-[20rpx] px-[30rpx] rounded-[14rpx] bg-white h-[100rpx] items-center",onClick:je},{default:b((()=>[_(s,{class:"label"},{default:b((()=>[g("注销账号")])),_:1}),_(u,{name:"arrow-right",size:"22",color:"#666"})])),_:1})):h("v-if",!0),h(" 退出登录 "),_(s,{class:"item text-nr flex justify-center items-center mt-[20rpx] rounded-[14rpx] px-[30rpx] bg-white h-[100rpx]",style:{border:"none"},onClick:Ie},{default:b((()=>[g(" 退出登录 ")])),_:1}),h(" 昵称修改组件 "),_(d,{modelValue:se.value,"onUpdate:modelValue":a[4]||(a[4]=e=>se.value=e),closeable:!0,mode:"center",maskCloseAble:!1,"border-radius":"20"},{default:b((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:b((()=>[_(c,{onSubmit:ke},{default:b((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:b((()=>[g(" 修改昵称 ")])),_:1}),_(n,{borderBottom:""},{default:b((()=>[_(r,{class:"nr h-[60rpx] w-full",value:le.value.nickname,name:"nickname",type:"nickname",placeholder:"请输入昵称"},null,8,["value"])])),_:1}),_(s,{class:"mt-[80rpx]"},{default:b((()=>[_(i,{"form-type":"submit",class:"bg-primary rounded-full h-[80rpx] text-lg leading-[80rpx] text-btn-text"},{default:b((()=>[g(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(" 账号修改组件 "),_(d,{modelValue:ue.value,"onUpdate:modelValue":a[6]||(a[6]=e=>ue.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:b((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:b((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:b((()=>[g("修改账号")])),_:1}),_(n,{borderBottom:""},{default:b((()=>[_(p,{class:"flex-1",modelValue:ce.value,"onUpdate:modelValue":a[5]||(a[5]=e=>ce.value=e),placeholder:"请输入账号",border:!1},null,8,["modelValue"])])),_:1}),_(s,{class:"mt-[80rpx]"},{default:b((()=>[_(o,{onClick:ye,type:"primary",shape:"circle"},{default:b((()=>[g(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),h(" 账号修改组件 "),_(d,{modelValue:oe.value,"onUpdate:modelValue":a[9]||(a[9]=e=>oe.value=e),closeable:!0,mode:"center","border-radius":"20"},{default:b((()=>[_(s,{class:"px-[50rpx] py-[40rpx] bg-white",style:{width:"85vw"}},{default:b((()=>[_(s,{class:"mb-[70rpx] text-xl text-center"},{default:b((()=>[g(" 修改手机号码 ")])),_:1}),_(n,{borderBottom:""},{default:b((()=>[_(p,{class:"flex-1",modelValue:de.value,"onUpdate:modelValue":a[7]||(a[7]=e=>de.value=e),placeholder:"请输入新的手机号码",border:!1},null,8,["modelValue"])])),_:1}),_(n,{borderBottom:""},{default:b((()=>[_(p,{class:"flex-1",modelValue:pe.value,"onUpdate:modelValue":a[8]||(a[8]=e=>pe.value=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),_(s,{class:"border-l border-solid border-0 border-light pl-3 text-muted leading-4 ml-3 w-[180rpx]",onClick:_e},{default:b((()=>[_(m,{ref_key:"uCodeRef",ref:fe,seconds:60,onChange:xe,"change-text":"x秒"},null,512),g(" "+w(me.value),1)])),_:1})])),_:1}),_(s,{class:"mt-[80rpx]"},{default:b((()=>[_(o,{onClick:ge,type:"primary",shape:"circle"},{default:b((()=>[g(" 确定 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"]),h("    选择密码    "),_(f,{list:ne.value,modelValue:re.value,"onUpdate:modelValue":a[10]||(a[10]=e=>re.value=e),onClick:Ce,"safe-area-inset-bottom":!0},null,8,["list","modelValue"]),h("    悬浮菜单    "),_(Q)])),_:1})],64)}}}),[["__scopeId","data-v-450a7c0a"]]);export{ee as default};
