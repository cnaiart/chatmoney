import{d as e,G as l,o as a,c as t,w as s,b as u,k as o,l as r,F as i,j as m,I as d,r as n,a as p,m as c,e as f,n as _,f as x,t as g,s as v,q as h,p as w,g as y,i as b,h as V,S as k,x as j,a5 as L,L as C,u as z,A as U,Z as E,bo as T,z as A,ad as I,af as $}from"./index-9f08b835.js";import{_ as F}from"./page-meta.d2ccf398.js";import{_ as D}from"./u-empty.765dbffc.js";import{_ as q}from"./tabbar.vue_vue_type_script_setup_true_lang.da8cbb67.js";import{_ as S}from"./u-icon.f0423eb2.js";import{_ as G}from"./router-navigate.3e9d7fb5.js";import{_ as M}from"./u-navbar.9b578443.js";import{_ as O}from"./u-form.1bf0b756.js";import{_ as X}from"./u-button.cd082997.js";import{u as B}from"./useLockFn.cde70c0d.js";import{g as J,b as R,c as N,e as P,f as Q}from"./draw.0416aa95.js";import{_ as W,D as Z,a as H,p as K}from"./item-title.vue_vue_type_script_setup_true_lang.01a451c0.js";import{_ as Y}from"./u-form-item.95df05ac.js";import{a as ee}from"./index.f8572cdb.js";import{_ as le}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as ae}from"./u-image.e6fb9592.js";import{u as te,j as se}from"./index.73309c03.js";import{_ as ue}from"./app-slider.58a81c69.js";import{_ as oe}from"./app-select.e953affb.js";import{_ as re,a as ie}from"./u-collapse.3475c9a9.js";import{U as me}from"./uploader-picture.87a63e0a.js";import"./u-badge.508fc5b2.js";import"./l-textarea.5288c032.js";import"./u-loading.15b95fef.js";import"./u-popup.6c89de8e.js";import"./emitter.1571a5d9.js";import"./u-tag.d6be710f.js";import"./u-search.333cf11c.js";import"./u-radio-group.31ee5ed9.js";import"./u-checkbox.468f126b.js";import"./uni-file-picker.55c7ce72.js";import"./image-uploader.b31ee9fb.js";const de=le(e({__name:"sd-size",props:{modelValue:{default:"512x512"}},emits:["update:modelValue"],setup(e,{emit:v}){const h=e,{modelValue:w}=ee(h,v),y=l({lists:[{name:"头像",scaleLabel:"1:1",scaleValue:"512x512",width:40,height:40},{name:"手机壁纸",scaleLabel:"1:2",scaleValue:"720x1440",width:20,height:40},{name:"小红书",scaleLabel:"2:3",scaleValue:"800x1200",width:25,height:40},{name:"文章",scaleLabel:"4:3",scaleValue:"1365x1024",width:40,height:30},{name:"媒体",scaleLabel:"3:4",scaleValue:"1024x1365",width:30,height:40},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"720x1280",width:24,height:40},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"1920x1080",width:40,height:24},{name:"横版名片",scaleLabel:"3:2",scaleValue:"960x640",width:40,height:30}]});return w.value="512x512",(e,l)=>{const v=m,h=d,b=n(p("u-form-item"),Y);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(W,{title:"图片尺寸",tips:"分辨率越高生成结果越慢，服务器配置比较低时可能会出现绘画失败、超时、缓慢等情况",required:""}),u(b,{prop:"size"},{default:s((()=>[u(v,{class:"flex-1 bg-white rounded-lg py-[20rpx] pr-[20rpx] overflow-hidden"},{default:s((()=>[u(h,{class:"flex-1 min-w-0 whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),o(i,null,r(y.lists,((e,l)=>(a(),t(v,{key:l,class:"inline-block w-[140rpx] ml-[20rpx]"},{default:s((()=>[u(v,{class:c(["picture-size text-center hover:text-primary",{"picture-size-active":f(w)==(null==e?void 0:e.scaleValue)}]),onClick:l=>w.value=e.scaleValue},{default:s((()=>[u(v,{class:"flex justify-center items-center h-[40rpx]"},{default:s((()=>[u(v,{class:"rect",style:_({width:`${e.width}rpx`,height:`${e.height}rpx`})},null,8,["style"])])),_:2},1024),u(v,{class:"text-[#101010] font-medium mt-[8rpx] size-scale"},{default:s((()=>[x(g(e.scaleLabel),1)])),_:2},1024),u(v,{class:"text-[#808D9C] mt-[8rpx] text-xs size-scale"},{default:s((()=>[x(g(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-dee587f4"]]),ne="/mobile/assets/empty-98182726.png",pe=e({__name:"sd-model",props:{modelValue:{default:()=>[]},cateList:null,modelList:null},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const _=e,{modelValue:j}=ee(_,l),L=v(0),C=te((e=>{const a=se(e)?e:e.detail.current;L.value!==a&&(L.value=a,l("changeCate",_.cateList[a].value))}),50);return(l,_)=>{const v=m,z=d,U=n(p("u-image"),ae),E=n(p("u-icon"),S),T=b,A=V,I=k,$=h,F=n(p("u-form-item"),Y);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(W,{title:"模型选择",tips:"让AI根据此模型的风格绘制图片，修改合适的描述词和参数可以让生成效果更加精美",required:""}),u(F,{label:""},{default:s((()=>[u(v,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg overflow-hidden"},{default:s((()=>[u(z,{class:"text-sm whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),o(i,null,r(e.cateList,((e,l)=>(a(),t(v,{key:l,class:c(["inline-block bg-page rounded-full mr-[30rpx] px-[40rpx] text-main",{"!bg-primary !text-white":l===L.value}]),onClick:w((e=>f(C)(l)),["stop"])},{default:s((()=>[x(g(e.label),1)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u($,{class:"h-[480rpx]",circular:"",current:L.value,"indicator-dots":!1,onChange:_[0]||(_[0]=e=>f(C)(e))},{default:s((()=>[(a(!0),o(i,null,r(e.cateList,((l,m)=>(a(),t(I,{key:m},{default:s((()=>[u(z,{"scroll-y":"true",class:"h-[480rpx] pt-[20rpx] mx-[-10rpx]"},{default:s((()=>[e.modelList.length?(a(),t(v,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(!0),o(i,null,r(e.modelList,(e=>(a(),t(v,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:s((()=>[u(v,{class:"h-full",onClick:l=>{return a=e.model_name,void(j.value=a);var a}},{default:s((()=>[u(v,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[u(v,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[u(U,{src:e.cover,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),f(j)===e.model_name?(a(),t(v,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[u(E,{name:"checkmark-circle-fill",size:40})])),_:1})):y("v-if",!0)])),_:2},1024),u(v,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[x(g(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(a(),t(v,{key:1,class:"flex flex-col items-center justify-center h-full"},{default:s((()=>[u(T,{class:"w-[200rpx] h-[200rpx]",src:f(ne)},null,8,["src"]),u(A,{class:"mt-4 text-content"},{default:s((()=>[x("暂无相关模型")])),_:1})])),_:1}))])),_:1})])),_:2},1024)))),128))])),_:1},8,["current"])])),_:1})])),_:1})])),_:1})}}}),ce=e({__name:"sd-lora",props:{modelValue:{default:()=>[]},currentLora:null,modelList:null},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const d=e,{modelValue:c}=ee(d,l),_=v([]);j((()=>d.currentLora),(e=>{var l;_.value=(null==(l=d.modelList.find((l=>l.model_name===e)))?void 0:l.loras)||[],c.value.len?_.value.map((e=>{var l;c.value.includes(e.model_name)||(c.value=null==(l=c.value)?void 0:l.filter((l=>l!==e.model_name)))})):c.value=[]}),{immediate:!0,deep:!1});return(e,l)=>{const d=n(p("u-image"),ae),v=m,h=n(p("u-icon"),S),w=b,k=V,j=n(p("u-form-item"),Y);return a(),t(v,{class:"mt-4"},{default:s((()=>[u(W,{title:"模型选择",tips:"在基础模型上叠加微调模型，让画面更细腻更可控"}),u(j,{label:""},{default:s((()=>[u(v,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[_.value.length?(a(),t(v,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(!0),o(i,null,r(_.value,(e=>(a(),t(v,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:s((()=>[u(v,{class:"h-full",onClick:l=>{return a=e.model_name,void(c.value.includes(a)?c.value=c.value.filter((e=>e!==a)):c.value.push(a));var a}},{default:s((()=>[u(v,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[u(v,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[u(d,{src:e.cover,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),f(c).includes(e.model_name)?(a(),t(v,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[u(h,{name:"checkmark-circle-fill",size:40})])),_:1})):y("v-if",!0)])),_:2},1024),u(v,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[x(g(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):(a(),t(v,{key:1,class:"flex flex-col items-center justify-center h-full"},{default:s((()=>[u(w,{class:"w-[200rpx] h-[200rpx]",src:f(ne)},null,8,["src"]),u(k,{class:"mt-4 text-content"},{default:s((()=>[x("暂无关联的微调模型")])),_:1})])),_:1}))])),_:1})])),_:1})])),_:1})}}}),fe=le(e({__name:"sd-options",props:{modelValue:{default:()=>{}},samplers:{default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:l}){const o=e,r=v(!0),{modelValue:i}=ee(o,l),d=e=>{const l=parseFloat(e.target.value);i.value.step=l>=150?150:l<0?0:l},c=e=>{const l=parseFloat(e.target.value);i.value.cfg_scale=l>=30?30:l<0?0:l};return(l,o)=>{const _=n(p("app-slider"),ue),x=m,g=L,v=n(p("app-select"),oe),h=n(p("u-collapse-item"),re),w=n(p("u-collapse"),ie);return a(),t(w,null,{default:s((()=>[(a(),t(h,{title:"高级参数",key:"index",open:r.value},{default:s((()=>[u(x,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[y(" 绘画步数 "),u(x,{class:"text-base text-main"},{default:s((()=>[u(W,{title:"绘画步数",tips:"越低：细节简练，耗时更短；越高：细节丰富，耗时变长；注*步数过高可能产生细节扭曲","font-weight":"400"}),u(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[u(x,{class:"w-[480rpx]"},{default:s((()=>[u(_,{min:0,max:150,step:1,showValue:!1,activeColor:l.$theme.primaryColor,modelValue:f(i).step,"onUpdate:modelValue":o[0]||(o[0]=e=>f(i).step=e)},null,8,["activeColor","modelValue"])])),_:1}),u(g,{class:"options-input",type:"number",min:0,max:150,style:{width:"80rpx"},step:"1",modelValue:f(i).step,"onUpdate:modelValue":o[1]||(o[1]=e=>f(i).step=e),onBlur:d},null,8,["modelValue"])])),_:1})])),_:1}),y(" 文本强度 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(W,{title:"文本强度",tips:"低：淡化输入的特征，淡化风格；高：强化输入的特征，强化风格；最佳使用区间7-12，推荐不超过15","font-weight":"400"}),u(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[u(x,{class:"w-[480rpx]"},{default:s((()=>[u(_,{min:0,max:30,step:.5,showValue:!1,activeColor:l.$theme.primaryColor,modelValue:f(i).cfg_scale,"onUpdate:modelValue":o[2]||(o[2]=e=>f(i).cfg_scale=e)},null,8,["step","activeColor","modelValue"])])),_:1}),u(g,{class:"options-input",type:"number",min:0,max:30,style:{width:"80rpx"},step:"0.5",modelValue:f(i).cfg_scale,"onUpdate:modelValue":o[3]||(o[3]=e=>f(i).cfg_scale=e),onBlur:c},null,8,["modelValue"])])),_:1})])),_:1}),y(" 采样模式 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(W,{title:"采样模式",tips:"靠前的采样（euler）：适合动漫，细节简练，快速；靠后的采样（DPM）：适合写实，细节丰富，较慢","font-weight":"400"}),u(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[u(v,{modelValue:f(i).sampler_name,"onUpdate:modelValue":o[4]||(o[4]=e=>f(i).sampler_name=e),popupTitle:"采样器",dataLists:e.samplers,placeholder:"请选择",closeable:!1,name:"name",value:"name"},null,8,["modelValue","dataLists"])])),_:1})])),_:1}),y(" 随机种子 "),u(x,{class:"text-base text-main mt-2"},{default:s((()=>[u(W,{title:"随机种子",tips:"每次生成图的初始画布，种子、提示词、参数和模型相同的情况下，可复原绘画结果","font-weight":"400"}),u(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[u(g,{class:"options-input",type:"number",modelValue:f(i).seed,"onUpdate:modelValue":o[5]||(o[5]=e=>f(i).seed=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["open"]))])),_:1})}}}),[["__scopeId","data-v-589577a1"]]),_e=le(e({__name:"sd",setup(e){const _=A(),h=I(),w=C(),b=z(),k=U(),j=v([{mode:Z.TEXT,name:"文生图"},{mode:Z.IMAGE,name:"图生图"}]),L=v({draw_api:H.SD,draw_type:Z.TEXT,draw_model:"",draw_loras:"",denoising_strength:.75,size:"512x512",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{step:20,sampler_name:"Euler a",seed:-1,cfg_scale:7}}),W=l({model:{cate:[],list:[]},config:{},loras:[],samplers:[]}),Y=async()=>P().then((async e=>{const l=e.map((e=>({value:e.id,label:e.name})));W.model.cate=[{label:"全部",value:0},...l],await ee()})),ee=async(e=0)=>{const l=await J({category_id:e});W.model.list=l},le=$((async()=>{W.config=await N({draw_api:H.DALLE})}),Y,ee,(async()=>{W.samplers=await Q()})),{lockFn:ae,isLock:te}=B((async()=>{try{if(L.value.draw_type===Z.IMAGE&&""===L.value.image_mask)return uni.$u.toast("请上传参考图");if(console.log(L.value.prompt),""===L.value.prompt)return uni.$u.toast("请输入提示词");if(""===L.value.draw_api)return uni.$u.toast("请选择主要模型");"img2img"!==L.value.draw_type&&(L.value.image_mask=""),await R({...L.value}),L.value.prompt="",_.navigateTo("/packages/pages/draw_list/draw_list?model=sd")}catch(e){}}));return le(),E((()=>{T("drawRegenerate",(e=>{Object.assign(L.value,e)}));const e=h.query;try{const l=JSON.parse(e.data);Object.assign(L.value,l)}catch(l){}})),(e,l)=>{const _=n(p("page-meta"),F),v=n(p("u-empty"),D),h=n(p("tabbar"),q),C=m,z=n(p("u-icon"),S),U=n(p("router-navigate"),G),E=n(p("u-navbar"),M),T=n(p("u-form"),O),A=d,I=V,$=n(p("u-button"),X);return a(),o(i,null,[u(_,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),u(C,{class:"h-full flex flex-col bg-[#f5f8fd]"},{default:s((()=>[f(b).config.switch.sd_status?(a(),o(i,{key:1},[u(E,{"back-text":"绘画工作台"},{right:s((()=>[u(U,{to:"/packages/pages/draw_list/draw_list?model=sd"},{default:s((()=>[u(C,{class:"flex items-center mr-[20rpx]"},{default:s((()=>[u(C,{class:"text-primary flex"},{default:s((()=>[u(z,{name:"clock",size:32})])),_:1}),u(C,{class:"text-muted ml-[10rpx]"},{default:s((()=>[x("历史记录")])),_:1})])),_:1})])),_:1})])),_:1}),u(C,{class:"p-[20rpx]"},{default:s((()=>[u(C,{class:"flex p-[14rpx] bg-white rounded-full"},{default:s((()=>[(a(!0),o(i,null,r(j.value,(e=>(a(),t(C,{key:e.mode,class:c(["flex items-center px-[10rpx] py-[5rpx] flex-1 justify-center text-primary rounded-full",{"!bg-primary !text-white":L.value.draw_type===e.mode}]),onClick:l=>L.value.draw_type=e.mode},{default:s((()=>[u(C,{class:"leading-[30px]"},{default:s((()=>[x(g(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),u(C,{class:"flex-1 min-h-0"},{default:s((()=>[u(A,{class:"h-full","scroll-y":""},{default:s((()=>[u(C,{class:"px-[20rpx] pb-[30rpx]"},{default:s((()=>[u(T,{ref_key:"uFormRef",ref:w,model:L.value,"label-position":"top","border-bottom":!1},{default:s((()=>[y("    图片上传    "),L.value.draw_type===f(Z).IMAGE?(a(),t(me,{key:0,modelValue:L.value.image_mask,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.image_mask=e)},null,8,["modelValue"])):y("v-if",!0),y("    关键词    "),u(K,{modelValue:L.value.prompt,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.prompt=e),negative:L.value.negative_prompt,"onUpdate:negative":l[2]||(l[2]=e=>L.value.negative_prompt=e),model:f(H).SD,"is-negative":"",example:W.example,typeEnum:f(Z),showTranslate:!!W.config.translate_switch},null,8,["modelValue","negative","model","example","typeEnum","showTranslate"]),y("    生成尺寸    "),u(de,{modelValue:L.value.size,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value.size=e)},null,8,["modelValue"]),y("    生成模型    "),u(pe,{"cate-list":W.model.cate,"model-list":W.model.list,modelValue:L.value.draw_model,"onUpdate:modelValue":l[4]||(l[4]=e=>L.value.draw_model=e),onChangeCate:l[5]||(l[5]=e=>ee(e))},null,8,["cate-list","model-list","modelValue"]),y("    Lora模型    "),u(ce,{modelValue:L.value.draw_loras,"onUpdate:modelValue":l[6]||(l[6]=e=>L.value.draw_loras=e),"model-list":W.model.list,"current-lora":L.value.draw_model},null,8,["modelValue","model-list","current-lora"]),y("    高级参数    "),u(fe,{samplers:W.samplers,modelValue:L.value.complex_params,"onUpdate:modelValue":l[7]||(l[7]=e=>L.value.complex_params=e)},null,8,["samplers","modelValue"])])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),u(C,{class:"p-[20rpx] bg-white safe-area-inset-bottom"},{default:s((()=>[u($,{type:"primary",loading:f(te),onClick:f(ae)},{default:s((()=>[u(C,null,{default:s((()=>[u(I,{class:"text-xl font-bold"},{default:s((()=>[x("立即生成")])),_:1}),W.config.is_member?(a(),t(I,{key:0,class:"text-sm ml-[4px]"},{default:s((()=>[x(" 会员免费 ")])),_:1})):y("v-if",!0),0!=W.config.power&&!W.config.is_member&&f(k).isLogin?(a(),t(I,{key:1,class:"text-sm ml-[4px]"},{default:s((()=>[x(" 消耗"+g(W.config.power||"--")+g(f(b).getTokenUnit),1)])),_:1})):y("v-if",!0)])),_:1})])),_:1},8,["loading","onClick"])])),_:1})],64)):(a(),t(C,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:s((()=>[u(v,{text:"绘画功能未开启",mode:"favor"}),u(h)])),_:1})),u(h)])),_:1})],64)}}}),[["__scopeId","data-v-9e57ce91"]]);export{_e as default};
