import{d as e,A as l,M as a,s as t,o as s,c as i,w as u,b as o,e as r,N as d,p as n,f as c,g as p,z as m,r as f,a as x,h as _,j as h,G as y,k as g,l as v,F as k,m as b,n as w,t as V,q as j,S as z,L as C,B as F,i as $,b6 as L,u as M,Z as S,bo as T,ad as I,I as U}from"./index-9f08b835.js";import{_ as q}from"./page-meta.d2ccf398.js";import{_ as B}from"./u-icon.f0423eb2.js";import{_ as P}from"./router-navigate.3e9d7fb5.js";import{_ as G}from"./u-navbar.9b578443.js";import{_ as J}from"./u-form.1bf0b756.js";import{_ as N}from"./u-button.cd082997.js";import{_ as O}from"./tabbar.vue_vue_type_script_setup_true_lang.da8cbb67.js";import{t as R,g as A,p as E}from"./video.a7b79a96.js";import{u as W}from"./useLockFn.cde70c0d.js";import{_ as X}from"./u-loading.15b95fef.js";import{_ as Z}from"./l-textarea.5288c032.js";import{_ as D}from"./u-form-item.95df05ac.js";import{a as H}from"./index.f8572cdb.js";import{_ as K}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as Q}from"./u-image.e6fb9592.js";import{_ as Y}from"./uni-file-picker.55c7ce72.js";import{_ as ee}from"./image-uploader.b31ee9fb.js";import"./u-badge.508fc5b2.js";import"./emitter.1571a5d9.js";import"./index.73309c03.js";const le=K(e({__name:"prompt",props:{modelValue:{default:""},config:{default:()=>({})},showTranslate:{type:Boolean,default:!1},type:{default:1}},emits:["update:modelValue"],setup(e,{emit:y}){const g=e,v=m(),k=l(),{modelValue:b}=H(g,y),w=a((()=>1===g.type)),V={1:{label:"视频场景",placeholder:"在此描述你的视频场景，包含内容主体+动作/场景"},2:{label:"描述词",placeholder:"描述视频中需要变化的内容即可～"}},j=a((()=>V[g.type]||{})),z=t(-1),C=()=>{k.isLogin||v.navigateTo("/pages/login/login")},F=()=>{var e;const l=null==(e=g.config.data)?void 0:e.length;if(l){let e=Math.round(Math.random()*(l-1));z.value===e&&(e<l-1?e++:e--),e<0&&(e=0),z.value=e;const a=g.config.data[e];a&&(b.value=a)}},{lockFn:$,isLock:L}=W((async()=>{if(!b.value)return uni.$u.toast("请输入描述词");const e=await R({prompt:b.value});b.value=e.result}));return(l,a)=>{const t=f(x("u-icon"),B),m=_,y=h,g=f(x("u-loading"),X),v=f(x("l-textarea"),Z),k=f(x("u-form-item"),D);return s(),i(k,{label:r(j).label,prop:"title",required:""},{default:u((()=>[o(y,{class:"flex-1 min-w-0"},{default:u((()=>[o(v,{modelValue:r(b),"onUpdate:modelValue":a[1]||(a[1]=e=>d(b)?b.value=e:null),rows:4,"custom-class":{background:"#fff",paddingBottom:"70rpx",fontSize:"28rpx"},placeholder:r(j).placeholder,onClick:C},{"length-suffix":u((()=>[o(y,{class:"flex length-suffix"},{default:u((()=>[o(y,{class:"flex-1 flex items-center"},{default:u((()=>[r(w)?(s(),i(y,{key:0,class:"inline-flex items-center text-primary mr-[10rpx]",onClick:n(F,["stop"])},{default:u((()=>[o(t,{name:"bookmark",size:"24"}),o(m,{class:"ml-[8rpx]"},{default:u((()=>[o(m,null,{default:u((()=>[c(" 试试示例 ")])),_:1})])),_:1})])),_:1},8,["onClick"])):p("v-if",!0),e.showTranslate?(s(),i(y,{key:1,class:"inline-flex items-center text-primary",onClick:n(r($),["stop"])},{default:u((()=>[r(L)?(s(),i(g,{key:0,mode:"flower",size:"24"})):(s(),i(t,{key:1,name:"reload",size:"24"})),o(m,{class:"ml-[8rpx]"},{default:u((()=>[o(m,null,{default:u((()=>[c(" 翻译成英文 ")])),_:1})])),_:1})])),_:1},8,["onClick"])):p("v-if",!0)])),_:1}),o(y,{class:"flex items-center text-content text-xs ml-auto",onClick:a[0]||(a[0]=n((e=>b.value=""),["stop"]))},{default:u((()=>[o(t,{name:"trash"}),o(y,{class:"ml-[8rpx]"},{default:u((()=>[c(" 清空 ")])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue","placeholder"])])),_:1})])),_:1},8,["label"])}}}),[["__scopeId","data-v-17eab16a"]]),ae=K(e({__name:"video-size",props:{modelValue:{default:"1:1"}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,{modelValue:t}=H(a,l),d=y({lists:[{scaleValue:"1:1",width:40,height:40},{scaleValue:"3:4",width:30,height:40},{scaleValue:"4:3",width:40,height:30},{scaleValue:"9:16",width:24,height:40},{scaleValue:"16:9",width:40,height:24}]});return t.value="1:1",(e,l)=>{const a=h,n=f(x("u-form-item"),D);return s(),i(n,{prop:"scale",label:"生成尺寸",required:""},{default:u((()=>[o(a,{class:"flex-1 min-w-0 overflow-hidden"},{default:u((()=>[o(a,{class:"flex flex-wrap mx-[-12rpx]"},{default:u((()=>[(s(!0),g(k,null,v(d.lists,((e,l)=>(s(),i(a,{key:l,class:"w-[33.3%] px-[12rpx]"},{default:u((()=>[o(a,{class:b(["picture-size cursor-pointer text-center hover:text-primary",{"picture-size-active":r(t)==(null==e?void 0:e.scaleValue),"picture-size-disable":!(null==e?void 0:e.scaleValue)}]),onClick:l=>t.value=e.scaleValue},{default:u((()=>[o(a,{class:"flex justify-center items-center h-[40rpx]"},{default:u((()=>[o(a,{class:"rect",style:w({width:`${e.width}rpx`,height:`${e.height}rpx`})},null,8,["style"])])),_:2},1024),o(a,{class:"text-[#101010] dark:text-white mt-[8rpx] size-scale"},{default:u((()=>[c(V(e.scaleValue),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-225eb997"]]),te=e({__name:"video-style",props:{modelValue:{default:()=>[]},styleList:null},emits:["update:modelValue"],setup(e,{emit:l}){const d=e,{modelValue:n}=H(d,l),m=t(8),_=e=>d.styleList.slice(m.value*e,m.value*(e+1)),y=a((()=>Math.ceil(d.styleList.length/m.value)));return(e,l)=>{const a=f(x("u-image"),Q),t=h,d=f(x("u-icon"),B),m=z,b=j,w=f(x("u-form-item"),D);return s(),i(w,{label:"选择风格"},{default:u((()=>[o(t,{class:"flex-1 min-w-0 bg-white rounded-[16rpx]"},{default:u((()=>[o(b,{class:"h-[520rpx]",circular:"","indicator-dots":r(y)>1,"indicator-active-color":e.$theme.primaryColor},{default:u((()=>[(s(!0),g(k,null,v(r(y),((e,l)=>(s(),i(m,{key:l},{default:u((()=>[o(t,{class:"flex flex-wrap px-[20rpx] pt-[20rpx] mx-[-10rpx]"},{default:u((()=>[(s(!0),g(k,null,v(_(l),(e=>(s(),i(t,{class:"w-[25%] px-[10rpx] mb-[10rpx]",key:e.id},{default:u((()=>[o(t,{class:"h-full cursor-pointer",onClick:l=>(e=>{const l=n.value.findIndex((l=>l===e));-1!==l?n.value.splice(l,1):n.value.push(e)})(e.id)},{default:u((()=>[o(t,{class:"pt-[100%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:u((()=>[o(t,{class:"absolute inset-0 left-0 top-0"},{default:u((()=>[o(a,{src:e.image,class:"h-full w-full",width:"100%",height:"100%"},null,8,["src"])])),_:2},1024),r(n).includes(e.id)||r(n).includes(String(e.id))?(s(),i(t,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:u((()=>[o(d,{name:"checkmark-circle-fill",size:40})])),_:1})):p("v-if",!0)])),_:2},1024),o(t,{class:"text-center text-xs"},{default:u((()=>[c(V(e.name),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)])),_:2},1024)))),128))])),_:1},8,["indicator-dots","indicator-active-color"])])),_:1})])),_:1})}}}),se=K(e({__name:"uploader-picture",props:{modelValue:{default:""},type:{default:"image"}},emits:["update:modelValue"],setup(e,{emit:l}){const a=e,{modelValue:d}=H(a,l),m=C(),y=t({}),{lockFn:g,isLock:v}=W((async e=>{var l;null==(l=m.value)||l.clearFiles();const[t]=e.tempFiles;if(!t)return uni.$u.toast("文件不存在");if(t.size>10485760)uni.$u.toast("文件大小不能超过10MB");else try{const e=await L(a.type,{filePath:t.url,name:"file"});d.value=e.uri,y.value=t}catch(s){uni.$u.toast(s)}}));return(e,l)=>{const a=$,t=f(x("u-icon"),B),k=h,b=_,w=f(x("u-loading"),X),j=f(x("uni-file-picker"),Y),z=f(x("u-form-item"),D);return s(),i(z,{prop:"image",label:"上传参考图",required:""},{default:u((()=>[o(k,{class:"flex-1 leading-snug"},{default:u((()=>[o(j,{ref_key:"filePickerRef",ref:m,limit:"1",fileMediatype:"image",onSelect:r(g),mode:"list","list-styles":{display:"none"},"auto-upload":!1},{default:u((()=>[o(k,{class:"bg-white rounded-[7rpx] h-[300rpx] border-light border border-dashed relative overflow-hidden"},{default:u((()=>[r(d)?(s(),i(k,{key:0,class:"flex justify-center items-center relative h-full"},{default:u((()=>[o(a,{class:"w-full h-[100%]",src:y.value.url||r(d),mode:"aspectFit"},null,8,["src"]),o(k,{class:"!absolute right-0 top-0 z-10 text-muted",onClick:l[0]||(l[0]=n((e=>d.value=""),["stop"]))},{default:u((()=>[o(t,{name:"close-circle-fill",size:50})])),_:1})])),_:1})):(s(),i(k,{key:1,class:"uploader-container flex justify-center items-center flex-col h-full"},{default:u((()=>[F("img",{src:ee,alt:"文件上传",class:"w-[80rpx] h-[80rpx] mx-auto mb-2"}),o(k,{class:"text-[#798696] !text-[13px]"},{default:u((()=>[o(b,{class:"text-primary"},{default:u((()=>[c("点击上传")])),_:1})])),_:1}),o(k,{class:"text-[#798696] !text-[13px] mt-[10rpx]"},{default:u((()=>[c(V("支持图片格式：JPG/JPEG/PNG，低于10MB"),1)])),_:1})])),_:1})),r(v)?(s(),i(k,{key:2,class:"absolute top-0 left-0 w-full h-full bg-[rgba(0,0,0,0.5)] flex flex-col items-center justify-center"},{default:u((()=>[o(k,null,{default:u((()=>[o(w,{size:"40",mode:"circle"})])),_:1}),o(b,{class:"text-white mt-[10rpx]"},{default:u((()=>[c(" 上传中... ")])),_:1})])),_:1})):p("v-if",!0)])),_:1})])),_:1},8,["onSelect"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-f9462d2b"]]),ie=K(e({__name:"video",setup(e){const l=m(),d=I(),n=C(),w=M(),j=t([{mode:1,name:"文生视频"},{mode:2,name:"图生视频"}]),z=y({type:1,prompt:"",scale:"1:1",image:"",style_id:[],channel:""}),F=t({model:{},style:[],example:{}}),$=a((()=>F.value.model[z.channel]||{})),{lockFn:L,isLock:R}=W((async()=>{try{if(!z.prompt)return uni.$u.toast("请输入"+(1===z.type?"视频场景":"描述词"));if(2===z.type&&!z.image)return uni.$u.toast("请上传参考图");await E({...z}),z.prompt="",z.style_id=[],z.image="",l.navigateTo("/packages/pages/video_list/video_list")}catch(e){}}));return(async()=>{F.value=await A(),z.channel=F.value.channel})(),S((()=>{T("videoRegenerate",(e=>{Object.assign(z,e)}));const e=d.query;try{const l=JSON.parse(e.data);Object.assign(z,l)}catch(l){}})),(e,l)=>{const a=f(x("page-meta"),q),t=f(x("u-icon"),B),d=h,m=f(x("router-navigate"),P),y=f(x("u-navbar"),G),C=f(x("u-form"),J),M=U,S=_,T=f(x("u-button"),N),I=f(x("tabbar"),O);return s(),g(k,null,[o(a,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),o(d,{class:"h-full flex flex-col"},{default:u((()=>[o(y,{"back-text":"视频"},{right:u((()=>[o(m,{to:"/packages/pages/video_list/video_list"},{default:u((()=>[o(d,{class:"flex items-center mr-[20rpx]"},{default:u((()=>[o(d,{class:"text-primary flex"},{default:u((()=>[o(t,{name:"clock",size:32})])),_:1}),o(d,{class:"text-muted ml-[10rpx]"},{default:u((()=>[c("历史记录")])),_:1})])),_:1})])),_:1})])),_:1}),o(d,{class:"p-[20rpx]"},{default:u((()=>[o(d,{class:"flex p-[14rpx] bg-white rounded-full"},{default:u((()=>[(s(!0),g(k,null,v(j.value,(e=>(s(),i(d,{key:e.mode,class:b(["flex items-center px-[10rpx] py-[5rpx] flex-1 justify-center text-primary rounded-full",{"!bg-primary !text-white":Number(z.type)===e.mode}]),onClick:l=>z.type=e.mode},{default:u((()=>[o(d,{class:"leading-[30px]"},{default:u((()=>[c(V(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),o(d,{class:"flex-1 min-h-0"},{default:u((()=>[o(M,{class:"h-full","scroll-y":""},{default:u((()=>[o(d,{class:"px-[20rpx]"},{default:u((()=>[o(C,{ref_key:"uFormRef",ref:n,model:z,"label-position":"top","border-bottom":!1},{default:u((()=>[2===z.type?(s(),i(se,{key:0,modelValue:z.image,"onUpdate:modelValue":l[0]||(l[0]=e=>z.image=e)},null,8,["modelValue"])):p("v-if",!0),o(le,{type:z.type,modelValue:z.prompt,"onUpdate:modelValue":l[1]||(l[1]=e=>z.prompt=e),config:F.value.example,showTranslate:!!F.value.translate_switch},null,8,["type","modelValue","config","showTranslate"]),o(ae,{modelValue:z.scale,"onUpdate:modelValue":l[2]||(l[2]=e=>z.scale=e)},null,8,["modelValue"]),F.value.style.length?(s(),i(te,{key:1,"style-list":F.value.style,modelValue:z.style_id,"onUpdate:modelValue":l[3]||(l[3]=e=>z.style_id=e)},null,8,["style-list","modelValue"])):p("v-if",!0)])),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),o(d,{class:"p-[20rpx] bg-white"},{default:u((()=>[o(T,{type:"primary",loading:r(R),onClick:r(L)},{default:u((()=>[o(d,null,{default:u((()=>[o(S,{class:"text-xl font-bold"},{default:u((()=>[c("立即生成")])),_:1}),F.value.is_member?(s(),i(S,{key:0,class:"text-sm ml-[4px]"},{default:u((()=>[c(" 会员免费 ")])),_:1})):r($).price>0?(s(),i(S,{key:1,class:"text-sm ml-[4px]"},{default:u((()=>[c(" 消耗 "+V(r($).price)+" "+V(r(w).getTokenUnit),1)])),_:1})):p("v-if",!0)])),_:1})])),_:1},8,["loading","onClick"])])),_:1}),o(I)])),_:1})],64)}}}),[["__scopeId","data-v-f879f5fc"]]);export{ie as default};
