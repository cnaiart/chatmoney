import{d as e,G as l,o as a,c as t,w as s,b as o,k as u,l as i,F as r,j as m,I as d,r as n,a as p,m as c,e as f,n as _,f as v,t as x,g,M as w,x as h,N as V,s as y,a5 as b,L as j,u as k,A as L,Z as U,bo as q,z,ad as C,af as I,h as A}from"./index-9f08b835.js";import{_ as F}from"./page-meta.d2ccf398.js";import{_ as T}from"./u-empty.765dbffc.js";import{_ as M}from"./tabbar.vue_vue_type_script_setup_true_lang.da8cbb67.js";import{_ as O}from"./u-icon.f0423eb2.js";import{_ as $}from"./router-navigate.3e9d7fb5.js";import{_ as J}from"./u-navbar.9b578443.js";import{_ as G}from"./u-form.1bf0b756.js";import{_ as P}from"./u-button.cd082997.js";import{u as R}from"./useLockFn.cde70c0d.js";import{b as B,c as E}from"./draw.0416aa95.js";import{_ as D,a as K,D as N,p as S}from"./item-title.vue_vue_type_script_setup_true_lang.01a451c0.js";import{U as X}from"./uploader-picture.87a63e0a.js";import{_ as Q}from"./u-form-item.95df05ac.js";import{a as W}from"./index.f8572cdb.js";import{_ as Z}from"./_plugin-vue_export-helper.1b428a4d.js";import{_ as H}from"./u-image.e6fb9592.js";import{_ as Y}from"./app-select.e953affb.js";import{_ as ee}from"./app-slider.58a81c69.js";import{_ as le,a as ae}from"./u-collapse.3475c9a9.js";import"./u-badge.508fc5b2.js";import"./l-textarea.5288c032.js";import"./u-loading.15b95fef.js";import"./u-popup.6c89de8e.js";import"./uni-file-picker.55c7ce72.js";import"./image-uploader.b31ee9fb.js";import"./emitter.1571a5d9.js";import"./index.73309c03.js";import"./u-tag.d6be710f.js";import"./u-search.333cf11c.js";import"./u-radio-group.31ee5ed9.js";import"./u-checkbox.468f126b.js";const te=Z(e({__name:"mj-size",props:{modelValue:{default:"512x512"}},emits:["update:modelValue"],setup(e,{emit:g}){const w=e,{modelValue:h}=W(w,g),V=l({lists:[{name:"头像",scaleLabel:"1:1",scaleValue:"1:1",width:40,height:40},{name:"手机壁纸",scaleLabel:"1:2",scaleValue:"1:2",width:20,height:40},{name:"小红书",scaleLabel:"2:3",scaleValue:"2:3",width:25,height:40},{name:"文章",scaleLabel:"4:3",scaleValue:"4:3",width:40,height:30},{name:"媒体",scaleLabel:"3:4",scaleValue:"3:4",width:30,height:40},{name:"宣传海报",scaleLabel:"9:16",scaleValue:"9:16",width:24,height:40},{name:"电脑壁纸",scaleLabel:"16:9",scaleValue:"16:9",width:40,height:24},{name:"横版名片",scaleLabel:"3:2",scaleValue:"3:2",width:40,height:30}]});return h.value="1:1",(e,l)=>{const g=m,w=d,y=n(p("u-form-item"),Q);return a(),t(g,{class:"mt-4"},{default:s((()=>[o(D,{title:"图片尺寸",tips:"指定生成图像的宽高比",required:""}),o(y,{prop:"size"},{default:s((()=>[o(g,{class:"flex-1 bg-white rounded-lg py-[20rpx] pr-[20rpx] overflow-hidden"},{default:s((()=>[o(w,{class:"flex-1 min-w-0 whitespace-nowrap","scroll-x":""},{default:s((()=>[(a(!0),u(r,null,i(V.lists,((e,l)=>(a(),t(g,{key:l,class:"inline-block w-[140rpx] ml-[20rpx]"},{default:s((()=>[o(g,{class:c(["picture-size text-center hover:text-primary",{"picture-size-active":f(h)==(null==e?void 0:e.scaleValue)}]),onClick:l=>h.value=e.scaleValue},{default:s((()=>[o(g,{class:"flex justify-center items-center h-[40rpx]"},{default:s((()=>[o(g,{class:"rect",style:_({width:`${e.width}rpx`,height:`${e.height}rpx`})},null,8,["style"])])),_:2},1024),o(g,{class:"text-[#101010] font-medium mt-[8rpx] size-scale"},{default:s((()=>[v(x(e.scaleLabel),1)])),_:2},1024),o(g,{class:"text-[#808D9C] mt-[8rpx] text-xs size-scale"},{default:s((()=>[v(x(e.name),1)])),_:2},1024)])),_:2},1032,["class","onClick"])])),_:2},1024)))),128))])),_:1})])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-db754d12"]]),se=e({__name:"mj-model",props:{modelValue:{default:""}},emits:["update:modelValue","changeCate"],setup(e,{emit:l}){const d=e,{modelValue:c}=W(d,l),_=window.origin+"/",w=[{value:"mj",title:"真实感强",cover:_+"resource/image/api/draw/mj.png"},{value:"niji",title:"卡通动漫",cover:_+"resource/image/api/draw/nj.png"}];return(e,l)=>{const d=n(p("u-image"),H),_=m,h=n(p("u-icon"),O),V=n(p("u-form-item"),Q);return a(),t(_,{class:"mt-4"},{default:s((()=>[o(D,{title:"模型选择",tips:"让AI根据此模型的风格绘制图片，修改合适的描述词和参数可以让生成效果更加精美",required:""}),o(V,{label:""},{default:s((()=>[o(_,{class:"flex-1 min-w-0 pt-[20rpx] px-[20rpx] bg-white rounded-lg overflow-hidden"},{default:s((()=>[w.length?(a(),t(_,{key:0,class:"flex flex-wrap"},{default:s((()=>[(a(),u(r,null,i(w,((e,l)=>o(_,{key:e.cover,class:"w-[50%] px-[10rpx]"},{default:s((()=>[o(_,{class:"h-full",onClick:l=>{return a=e.value,void(c.value=a);var a}},{default:s((()=>[o(_,{class:"pt-[70%] relative h-0 rounded-[10rpx] overflow-hidden"},{default:s((()=>[o(_,{class:"absolute inset-0 left-0 top-0"},{default:s((()=>[o(d,{src:e.cover,class:"h-full w-full",width:"100%",mode:"widthFix"},null,8,["src"])])),_:2},1024),f(c)===e.value?(a(),t(_,{key:0,class:"absolute bg-[rgba(0,0,0,0.5)] inset-0 left-0 top-0 flex items-center justify-center text-white"},{default:s((()=>[o(h,{name:"checkmark-circle-fill",size:40})])),_:1})):g("v-if",!0)])),_:2},1024),o(_,{class:"text-center text-xs line-clamp-1"},{default:s((()=>[v(x(e.title),1)])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1024))),64))])),_:1})):g("v-if",!0)])),_:1})])),_:1})])),_:1})}}}),oe=e({__name:"mj-version",props:{modelValue:{default:""},versionList:{default:[]},drawModel:null},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,{modelValue:i}=W(u,l),r=w((()=>{var e;return(null==(e=null==u?void 0:u.versionList)?void 0:e.map((e=>({value:e,label:`${e}`}))))||[]}));return h((()=>[null==u?void 0:u.versionList,u.drawModel]),(()=>{(null==u?void 0:u.versionList.length)&&(i.value=null==u?void 0:u.versionList[0])})),(e,l)=>{const u=n(p("app-select"),Y),d=m,c=n(p("u-form-item"),Q);return a(),t(d,{class:"mt-4"},{default:s((()=>[o(D,{title:"版本选择",tips:"指定midjourney的渲染版本",required:""}),o(c,{prop:"size"},{default:s((()=>[o(d,{class:"flex-1 bg-white rounded-lg py-[20rpx] px-[20rpx] overflow-hidden"},{default:s((()=>[o(u,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=e=>V(i)?i.value=e:null),popupTitle:"版本选择",dataLists:f(r),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1})])),_:1})}}}),ue=e({__name:"mj-styles",props:{modelValue:{default:""},stylesList:{default:{}}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,{modelValue:i}=W(u,l),r=w((()=>Reflect.ownKeys(u.stylesList).map((e=>({value:e,label:u.stylesList[e]})))));return(e,l)=>{const u=n(p("app-select"),Y),d=m,c=n(p("u-form-item"),Q);return a(),t(d,{class:"mt-4"},{default:s((()=>[o(D,{title:"风格选择",tips:"指定midjourney的渲染风格",required:""}),o(c,{prop:"size"},{default:s((()=>[o(d,{class:"flex-1 bg-white rounded-lg py-[20rpx] px-[20rpx] overflow-hidden"},{default:s((()=>[o(u,{modelValue:f(i),"onUpdate:modelValue":l[0]||(l[0]=e=>V(i)?i.value=e:null),popupTitle:"风格选择",dataLists:f(r),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1})])),_:1})}}}),ie=Z(e({__name:"mj-options",props:{modelValue:{default:()=>{}},qList:{default:{}}},emits:["update:modelValue"],setup(e,{emit:l}){const u=e,i=y(!0),{modelValue:r}=W(u,l),d=w((()=>Reflect.ownKeys(u.qList).map((e=>({value:e,label:u.qList[e]}))))),c=e=>{const l=parseFloat(e.target.value);r.value.iw=l>=2?2:l<0?.5:l},_=e=>{const l=parseFloat(e.target.value);r.value.s=l>=1e3?1e3:l<0?0:l},v=e=>{const l=parseFloat(e.target.value);r.value.c=l>=100?100:l<0?0:l};return(e,l)=>{const u=n(p("app-slider"),ee),x=m,w=b,h=n(p("app-select"),Y),V=n(p("u-collapse-item"),le),y=n(p("u-collapse"),ae);return a(),t(y,null,{default:s((()=>[(a(),t(V,{title:"高级参数",key:"index",open:i.value},{default:s((()=>[o(x,{class:"flex-1 min-w-0 p-[20rpx] bg-white rounded-lg"},{default:s((()=>[g(" 参考图权重 "),o(x,{class:"text-base text-main"},{default:s((()=>[o(D,{title:"参考图权重",tips:"设置生成图片时垫图的权重，值越大越像垫图，取值范围0.5-2， 默认值1","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:.1,min:.5,max:2,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).iw,"onUpdate:modelValue":l[0]||(l[0]=e=>f(r).iw=e)},null,8,["step","min","activeColor","modelValue"])])),_:1}),o(w,{class:"options-input",type:"number",step:.1,min:.5,max:2,style:{width:"80rpx"},modelValue:f(r).iw,"onUpdate:modelValue":l[1]||(l[1]=e=>f(r).iw=e),onBlur:c},null,8,["step","min","modelValue"])])),_:1})])),_:1}),g(" 图片质量 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(D,{title:"图片质量",tips:"设置图片的质量，越大质量越高，取值范围0.3-5，默认值1","font-weight":"400"}),o(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[o(h,{modelValue:f(r).q,"onUpdate:modelValue":l[2]||(l[2]=e=>f(r).q=e),popupTitle:"图片质量",dataLists:f(d),placeholder:"请选择",closeable:!1,name:"label",value:"value"},null,8,["modelValue","dataLists"])])),_:1})])),_:1}),g(" 风格化值 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(D,{title:"风格化值",tips:"设置生成图片时的风格化程度，值越大，风格化的程度越高，取值范围0-1000， 默认值100","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:1,max:1e3,min:0,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).s,"onUpdate:modelValue":l[3]||(l[3]=e=>f(r).s=e)},null,8,["activeColor","modelValue"])])),_:1}),o(w,{class:"options-input",type:"number",step:1,max:1e3,min:0,style:{width:"80rpx"},modelValue:f(r).s,"onUpdate:modelValue":l[4]||(l[4]=e=>f(r).s=e),onBlur:_},null,8,["modelValue"])])),_:1})])),_:1}),g(" 混乱值 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(D,{title:"混乱值",tips:"本参数会控制生成4张图的差别， 值越大，生成4张图的区别越大，值越小,生成的4张图越接近，取值范围0-100， 默认值0","font-weight":"400"}),o(x,{class:"flex items-center justify-between mt-[10rpx]"},{default:s((()=>[o(x,{class:"w-[480rpx]"},{default:s((()=>[o(u,{step:1,max:100,min:0,showValue:!1,activeColor:e.$theme.primaryColor,modelValue:f(r).c,"onUpdate:modelValue":l[5]||(l[5]=e=>f(r).c=e)},null,8,["activeColor","modelValue"])])),_:1}),o(w,{class:"options-input",type:"number",step:1,max:100,min:0,style:{width:"80rpx"},modelValue:f(r).c,"onUpdate:modelValue":l[6]||(l[6]=e=>f(r).c=e),onBlur:v},null,8,["modelValue"])])),_:1})])),_:1}),g(" 随机种子 "),o(x,{class:"text-base text-main mt-2"},{default:s((()=>[o(D,{title:"随机种子",tips:"种子用于指定生成效果，可以用于生成套图，保障生成的一系列图片保持同一种风格","font-weight":"400"}),o(x,{class:"flex-1 mt-[10rpx]"},{default:s((()=>[o(w,{class:"options-input",type:"number",modelValue:f(r).seed,"onUpdate:modelValue":l[7]||(l[7]=e=>f(r).seed=e)},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["open"]))])),_:1})}}}),[["__scopeId","data-v-20c3535a"]]),re=Z(e({__name:"mj",setup(e){const i=z(),c=C(),_=j(),w=k(),h=L(),V=y({draw_api:K.MJ_GOAPI,draw_type:N.TEXT,draw_model:"mj",size:"1:1",prompt:"",negative_prompt:"",action:"generate",image_mask:"",image_id:"",complex_params:{seed:"",iw:1,q:"1",s:100,c:0},style:"",version:"",origin_task_id:""}),b=l({config:{mj_version:{},mj_style:{},mj_quality:{}}}),D=I((async()=>{b.config=await E({draw_api:K.MJ_GOAPI})})),{lockFn:Q,isLock:W}=R((async e=>{try{if(e&&(V.value.action=e),""===V.value.prompt)return uni.$u.toast("请输入提示词");await B({...V.value}),V.value.prompt="",i.navigateTo({path:"/packages/pages/draw_list/draw_list",query:{model:K.MJ_GOAPI}})}catch(l){}}));return D(),U((()=>{q("drawRegenerate",(e=>{Object.assign(V.value,e),"generate"!==e.action&&Q(e.action)}));const e=c.query;try{const l=JSON.parse(e.data);Object.assign(V.value,l),"generate"!==l.action&&Q(l.action)}catch(l){}})),(e,l)=>{const i=n(p("page-meta"),F),c=n(p("u-empty"),T),y=n(p("tabbar"),M),j=m,k=n(p("u-icon"),O),L=n(p("router-navigate"),$),U=n(p("u-navbar"),J),q=n(p("u-form"),G),z=d,C=A,I=n(p("u-button"),P);return a(),u(r,null,[o(i,{"page-style":e.$theme.pageStyle},null,8,["page-style"]),o(j,{class:"h-full flex flex-col bg-[#f5f8fd]"},{default:s((()=>[f(w).config.switch.mj_status?(a(),u(r,{key:1},[o(U,{"back-text":"绘画工作台"},{right:s((()=>[o(L,{to:{path:"/packages/pages/draw_list/draw_list",query:{model:f(K).MJ_GOAPI}}},{default:s((()=>[o(j,{class:"flex items-center mr-[20rpx]"},{default:s((()=>[o(j,{class:"text-primary flex"},{default:s((()=>[o(k,{name:"clock",size:32})])),_:1}),o(j,{class:"text-muted ml-[10rpx]"},{default:s((()=>[v("历史记录")])),_:1})])),_:1})])),_:1},8,["to"])])),_:1}),o(j,{class:"flex-1 min-h-0"},{default:s((()=>[o(z,{class:"h-full","scroll-y":""},{default:s((()=>[o(j,{class:"px-[20rpx] pb-[30rpx] pt-[6rpx]"},{default:s((()=>[o(q,{ref_key:"uFormRef",ref:_,model:V.value,"label-position":"top","border-bottom":!1},{default:s((()=>{var e,s;return[g("    关键词    "),o(S,{modelValue:V.value.prompt,"onUpdate:modelValue":l[0]||(l[0]=e=>V.value.prompt=e),negative:V.value.negative_prompt,"onUpdate:negative":l[1]||(l[1]=e=>V.value.negative_prompt=e),"is-negative":!0,model:f(K).MJ_GOAPI,example:b.example,typeEnum:f(N),showTranslate:!!b.config.translate_switch},null,8,["modelValue","negative","model","example","typeEnum","showTranslate"]),g("    图片上传    "),o(X,{modelValue:V.value.image_mask,"onUpdate:modelValue":l[2]||(l[2]=e=>V.value.image_mask=e)},null,8,["modelValue"]),g("    图片尺寸    "),o(te,{modelValue:V.value.size,"onUpdate:modelValue":l[3]||(l[3]=e=>V.value.size=e)},null,8,["modelValue"]),g(" 绘画模型 "),o(se,{modelValue:V.value.draw_model,"onUpdate:modelValue":l[4]||(l[4]=e=>V.value.draw_model=e)},null,8,["modelValue"]),g(" 版本选择 "),o(oe,{modelValue:V.value.version,"onUpdate:modelValue":l[5]||(l[5]=e=>V.value.version=e),"draw-model":V.value.draw_model,versionList:null==(e=b.config)?void 0:e.mj_version[V.value.draw_model]},null,8,["modelValue","draw-model","versionList"]),g(" 风格选择 "),5==V.value.version&&"niji"==V.value.draw_model?(a(),t(ue,{key:0,"styles-list":null==(s=b.config)?void 0:s.mj_style,modelValue:V.value.style,"onUpdate:modelValue":l[6]||(l[6]=e=>V.value.style=e)},null,8,["styles-list","modelValue"])):g("v-if",!0),g(" 高级参数 "),o(ie,{modelValue:V.value.complex_params,"onUpdate:modelValue":l[7]||(l[7]=e=>V.value.complex_params=e),"q-list":b.config.mj_quality},null,8,["modelValue","q-list"])]})),_:1},8,["model"])])),_:1})])),_:1})])),_:1}),o(j,{class:"p-[20rpx] bg-white safe-area-inset-bottom"},{default:s((()=>[o(I,{type:"primary",loading:f(W),onClick:l[8]||(l[8]=e=>f(Q)("generate"))},{default:s((()=>[o(j,null,{default:s((()=>[o(C,{class:"text-xl font-bold"},{default:s((()=>[v("立即生成")])),_:1}),b.config.is_member?(a(),t(C,{key:0,class:"text-sm ml-[4px]"},{default:s((()=>[v(" 会员免费 ")])),_:1})):g("v-if",!0),0!=b.config.power&&!b.config.is_member&&f(h).isLogin?(a(),t(C,{key:1,class:"text-sm ml-[4px]"},{default:s((()=>[v(" 消耗"+x(b.config.power||"--")+x(f(w).getTokenUnit),1)])),_:1})):g("v-if",!0)])),_:1})])),_:1},8,["loading"])])),_:1})],64)):(a(),t(j,{key:0,class:"w-full h-full bg-white rounded-[6px] flex items-center justify-center"},{default:s((()=>[o(c,{text:"绘画功能未开启",mode:"favor"}),o(y)])),_:1})),o(y)])),_:1})],64)}}}),[["__scopeId","data-v-0197d0a6"]]);export{re as default};
