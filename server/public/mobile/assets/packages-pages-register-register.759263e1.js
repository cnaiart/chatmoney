import{_ as e}from"./page-meta.d2ccf398.js";import{d as a,s as l,M as o,u as t,L as s,G as r,Z as u,o as i,k as m,b as n,w as d,e as c,c as p,g as f,m as b,f as v,t as _,F as g,z as y,a1 as x,a0 as j,$ as w,r as h,a as V,j as $,h as k,br as C,ab as B,ac as R}from"./index-9f08b835.js";import{_ as U}from"./u-tabs.3aba862d.js";import{_ as E}from"./u-input.6dc4a2b4.js";import{_ as F}from"./u-form-item.95df05ac.js";import{_ as G}from"./u-verification-code.cfa37ce6.js";import{_ as L}from"./u-form.1bf0b756.js";import{_ as P}from"./agreement.a2ed3b1e.js";import{_ as S}from"./u-button.cd082997.js";import{u as T}from"./useLockFn.cde70c0d.js";import{F as I}from"./floating-menu.a8f47c3e.js";import{_ as z}from"./_plugin-vue_export-helper.1b428a4d.js";import"./u-badge.508fc5b2.js";import"./u-icon.f0423eb2.js";import"./emitter.1571a5d9.js";import"./router-navigate.3e9d7fb5.js";import"./u-checkbox.468f126b.js";const A=z(a({__name:"register",setup(a){const z=[{name:"手机号注册",type:"1"},{name:"邮箱注册",type:"2"}],A=l(0),D=o((()=>{var e;return(null==(e=M.getLoginConfig)?void 0:e.register_way)||[]})),J=o((()=>z.filter((e=>D.value.includes(e.type))))),M=t(),N=y(),O=s(),Z=r({scene:"2",mobile:"",code:"",email:"",password:"",password_confirm:""}),q=s(),H=l(""),K=e=>{H.value=e},Q=o((()=>uni.$u.test.mobile(Z.mobile))),W=o((()=>uni.$u.test.email(Z.email))),X=o((()=>{var e;return 1==(null==(e=M.getLoginConfig)?void 0:e.register_sms_verify)})),Y=o((()=>"1"==Z.scene)),ee=o((()=>"2"==Z.scene)),ae=e=>{A.value=e,Z.scene=z[e].type,1==e?Z.mobile="":Z.email=""},le=async()=>{var e,a;if(null==(e=q.value)?void 0:e.canGetCode)try{Y.value?await te():await oe(),uni.$u.toast("发送成功"),null==(a=q.value)||a.start()}catch(l){console.log("发送验证码失败=>",l)}},oe=async()=>(console.log(W.value),Z.email?W.value?void(await x({scene:j.REGISTER,email:Z.email})):(uni.$u.toast("请输入正确的邮箱地址"),Promise.reject()):(uni.$u.toast("请输入邮箱"),Promise.reject())),te=async()=>Z.mobile?W.value?(uni.$u.toast("请输入正确的手机号"),Promise.reject()):void(await w({scene:j.REGISTER,mobile:Z.mobile})):(uni.$u.toast("请输入手机号"),Promise.reject()),{lockFn:se}=T((async()=>{var e;if(!(null==(e=O.value)?void 0:e.checkAgreement()))return;if(!Z.mobile&&Y.value)return uni.$u.toast("请输入手机号码");if(!Z.email&&ee.value)return uni.$u.toast("请输入邮箱");if(!Z.code&&X.value)return uni.$u.toast("请输入验证码");if(!Z.password)return uni.$u.toast("请输入密码");if(!Z.password_confirm)return uni.$u.toast("请再次输入密码");if(Z.password!=Z.password_confirm)return uni.$u.toast("两次输入的密码不一致");const a=await C(Z);B.set(R,JSON.stringify(a)),setTimeout((()=>{N.navigateBack()}),1500)}));return u((async({type:e})=>{setTimeout((()=>{Z.scene=e,2==e&&D.value.includes("1")&&(A.value=1)}),300)})),(a,l)=>{const o=h(V("page-meta"),e),t=h(V("u-tabs"),U),s=$,r=h(V("u-input"),E),u=h(V("u-form-item"),F),y=h(V("u-verification-code"),G),x=k,j=h(V("u-form"),L),w=h(V("agreement"),P),C=h(V("u-button"),S);return i(),m(g,null,[n(o,{"page-style":a.$theme.pageStyle},null,8,["page-style"]),n(s,{class:"register bg-white min-h-full flex flex-col items-center px-[40rpx] pt-[40rpx] box-border"},{default:d((()=>[n(s,{class:"w-full"},{default:d((()=>[n(s,{class:"pb-[40rpx]"},{default:d((()=>[n(t,{list:c(J),modelValue:A.value,"onUpdate:modelValue":l[0]||(l[0]=e=>A.value=e),"active-color":a.$theme.primaryColor,onChange:ae},null,8,["list","modelValue","active-color"])])),_:1}),n(j,{borderBottom:"","label-width":150},{default:d((()=>[c(Y)?(i(),p(u,{key:0,label:"手机号",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",modelValue:Z.mobile,"onUpdate:modelValue":l[1]||(l[1]=e=>Z.mobile=e),border:!1,placeholder:"请输入手机号码"},null,8,["modelValue"])])),_:1})):f("v-if",!0),c(ee)?(i(),p(u,{key:1,label:"邮箱",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",modelValue:Z.email,"onUpdate:modelValue":l[2]||(l[2]=e=>Z.email=e),border:!1,placeholder:"请输入邮箱账号"},null,8,["modelValue"])])),_:1})):f("v-if",!0),c(X)?(i(),p(u,{key:2,label:"验证码"},{default:d((()=>[n(r,{class:"flex-1",modelValue:Z.code,"onUpdate:modelValue":l[3]||(l[3]=e=>Z.code=e),placeholder:"请输入验证码",border:!1},null,8,["modelValue"]),n(s,{class:"border-l border-solid border-0 border-light pl-3 leading-4 ml-3 w-[180rpx]",onClick:le},{default:d((()=>[n(y,{ref_key:"uCodeRef",ref:q,seconds:60,onChange:K,"change-text":"x秒"},null,512),n(x,{class:b(["text-muted",{"text-primary":c(Q)&&c(Y)||c(W)&&c(ee)}])},{default:d((()=>[v(_(H.value),1)])),_:1},8,["class"])])),_:1})])),_:1})):f("v-if",!0),n(u,{label:"设置密码",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",type:"password",modelValue:Z.password,"onUpdate:modelValue":l[4]||(l[4]=e=>Z.password=e),placeholder:"请输入字母+数字组合的密码",border:!1},null,8,["modelValue"])])),_:1}),n(u,{label:"确认密码",borderBottom:""},{default:d((()=>[n(r,{class:"flex-1",type:"password",modelValue:Z.password_confirm,"onUpdate:modelValue":l[5]||(l[5]=e=>Z.password_confirm=e),placeholder:"再次输入密码",border:!1},null,8,["modelValue"])])),_:1})])),_:1}),n(s,{class:"mt-[40rpx]"},{default:d((()=>[n(w,{ref_key:"agreementRef",ref:O},null,512)])),_:1}),n(s,{class:"mt-[60rpx]"},{default:d((()=>[n(C,{type:"primary",shape:"circle",onClick:c(se)},{default:d((()=>[v(" 注册 ")])),_:1},8,["onClick"])])),_:1})])),_:1})])),_:1}),f("    悬浮菜单    "),n(I)],64)}}}),[["__scopeId","data-v-796775ec"]]);export{A as default};
