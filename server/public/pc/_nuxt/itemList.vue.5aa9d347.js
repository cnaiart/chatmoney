import{_ as Q}from"./index.vue.403e5f16.js";import{a as X,b as Z,f as ee,E as te,g as ae,v as se}from"./entry.df16adda.js";import{b as ne,a as oe}from"./el-select.b349f79d.js";import{a as le,E as ie}from"./el-checkbox.033475fe.js";import{_ as ue}from"./index.vue.b9ae65fe.js";import{u as de,_ as ce}from"./index.vue.1307e7a7.js";import"./el-tag.7a8069da.js";import"./el-scrollbar.f4d658ff.js";import"./el-popper.89e34564.js";import{k as re,a as x,s as me,E as pe,I as i,J as f,K as d,a2 as a,a4 as T,a0 as l,ae as k,u as s,ad as _e,W as fe,$ as C,Y as c,e as ke,n as K}from"./swiper-vue.397ea2eb.js";import{_ as ye}from"./editPop.vue.d3c9e835.js";import{i as ve,h as be,j as ge,l as he}from"./my_database.5da0ead6.js";import{u as we}from"./usePolling.7824bae6.js";const xe={class:"pb-[20px] flex items-center font-bold cursor-pointer"},Ce={class:"ml-2"},Re={class:"md:flex"},Ve={class:"mt-2 md:mt-0 lg:flex ml-auto"},$e={class:"min-w-[240px]"},De={class:"min-w-[180px] lg:ml-2 mt-2 md:mt-0"},Ee={key:0},Se={key:1,class:"text-warning"},Ie={key:2,class:"text-success"},qe={key:3,class:"text-danger"},Ne={key:4,class:"text-danger"},Be={class:"flex justify-end mt-4"},He=re({__name:"itemList",props:{itemId:{type:Number,default:0},itemName:{type:String,default:""}},emits:["back"],setup($,{emit:Pe}){const h=X(),L=Z(),D=h.query.id,y=x(),R=$,v=x(!1),V=me(),_=x({keyword:"",status:"",fd_id:R.itemId,kb_id:h.query.id}),{pager:r,getLists:b,resetPage:E,resetParams:Te}=de({fetchFun:ve,params:_.value}),U=x(0),j=async()=>{const n=r.lists.map(o=>o.uuid),{tasks:t,lists:u}=await he({..._.value,uuids:n});r.lists.map(o=>{const w=u.findIndex(m=>o.uuid==m.uuid);o.status=u[w].status,o.tokens=u[w].tokens}),U.value=t.length,t.length==0&&F()},z=async()=>{j()},{start:g,end:F}=we(z),O=async()=>{v.value=!0,await K(),V.value.open({kb_id:h.query.id,fd_id:R.itemId})},W=async n=>{v.value=!0,await K(),V.value.open({kb_id:h.query.id,fd_id:R.itemId,uuid:n})},S=async n=>{await be({kb_id:D,uuids:n}),b(),g()},I=async n=>{await ee.confirm("请确认是否删除！"),await ge({kb_id:D,uuids:n}),b(),g()},A=async()=>{var t;const n=(t=y.value)==null?void 0:t.getSelectionRows().map(u=>u.uuid);await I(n)},J=async()=>{var t;const n=(t=y.value)==null?void 0:t.getSelectionRows().map(u=>u.uuid);await S(n)},M=()=>{E()};return pe(async()=>{await b(),g()}),(n,t)=>{var N,B;const u=Q,o=te,w=ae,m=ne,Y=oe,p=ie,q=ue,G=ce,H=se;return i(),f("div",null,[d("div",xe,[d("div",{onClick:t[0]||(t[0]=e=>n.$emit("back")),class:"flex items-center"},[a(u,{name:"el-icon-Back",size:"16"}),d("span",Ce,T($.itemName),1)])]),d("div",Re,[d("div",null,[a(o,{type:"primary",onClick:O},{default:l(()=>[k(" 导入数据 ")]),_:1}),a(o,{disabled:!((N=s(y))!=null&&N.getSelectionRows().length),onClick:J},{default:l(()=>[k(" 批量重试 ")]),_:1},8,["disabled"]),a(o,{disabled:!((B=s(y))!=null&&B.getSelectionRows().length),onClick:A},{default:l(()=>[k(" 批量删除 ")]),_:1},8,["disabled"])]),d("div",Ve,[d("div",$e,[a(w,{modelValue:s(_).keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>s(_).keyword=e),placeholder:"请输入问题/回答内容关键词进行搜索",clearable:"",onKeyup:_e(s(E),["enter"])},null,8,["modelValue","onKeyup"])]),d("div",De,[a(Y,{modelValue:s(_).status,"onUpdate:modelValue":t[2]||(t[2]=e=>s(_).status=e),onChange:M},{default:l(()=>[a(m,{label:"全部",value:""}),a(m,{label:"等待学习",value:0}),a(m,{label:"学习中",value:1}),a(m,{label:"学习失败",value:3}),a(m,{label:"学习成功",value:2})]),_:1},8,["modelValue"])])])]),fe((i(),C(s(le),{ref_key:"tableRef",ref:y,class:"mt-4",data:s(r).lists,size:"large","row-class-name":"h-[70px]"},{default:l(()=>[a(p,{type:"selection",width:"55"}),a(p,{label:"文档内容",prop:"question","min-width":"200"},{default:l(({row:e})=>[a(q,{content:e.question,line:2,teleported:!0,effect:"light"},null,8,["content"])]),_:1}),a(p,{label:"补充内容",prop:"answer","min-width":"200"},{default:l(({row:e})=>[a(q,{content:e.answer||"-",line:2,teleported:!0,effect:"light"},null,8,["content"])]),_:1}),a(p,{label:"学习状态",prop:"source","min-width":"150"},{default:l(({row:e})=>[e.status==0?(i(),f("div",Ee,"等待学习")):c("",!0),e.status==1?(i(),f("div",Se,"学习中")):c("",!0),e.status==2?(i(),f("div",Ie,"学习成功")):c("",!0),e.status==3?(i(),f("div",qe,"学习失败")):c("",!0),e.status==3?(i(),f("div",Ne," 原因："+T(e.error),1)):c("",!0)]),_:1}),a(p,{label:`消耗${s(L).getTokenUnit}`,prop:"tokens","min-width":"150"},null,8,["label"]),a(p,{label:"最后更新时间",prop:"update_time","min-width":"150"}),a(p,{label:"操作",prop:"source","min-width":"180"},{default:l(({row:e})=>[e.status!=1?(i(),C(o,{key:0,type:"primary",onClick:P=>W(e.uuid),link:""},{default:l(()=>[k("修正")]),_:2},1032,["onClick"])):c("",!0),e.status==3?(i(),C(o,{key:1,type:"primary",onClick:P=>S([e.uuid]),link:""},{default:l(()=>[k("重试")]),_:2},1032,["onClick"])):c("",!0),a(o,{type:"danger",onClick:P=>I([e.uuid]),link:""},{default:l(()=>[k("删除")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[H,s(r).loading]]),d("div",Be,[a(G,{modelValue:s(r),"onUpdate:modelValue":t[3]||(t[3]=e=>ke(r)?r.value=e:null),onChange:t[4]||(t[4]=()=>{s(g)(),s(b)()})},null,8,["modelValue"])]),s(v)?(i(),C(ye,{key:0,ref_key:"popRef",ref:V,onSuccess:t[5]||(t[5]=()=>{v.value=!1,s(b)(),s(g)()}),onClose:t[6]||(t[6]=e=>v.value=!1)},null,512)):c("",!0)])}}});export{He as _};
