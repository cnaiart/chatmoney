import{k as V,ar as X,I as t,J as l,K as c,Y as f,_ as R,a4 as w,S as j,a5 as ee,$ as h,a0 as a,a2 as v,Z as S,ap as B,a as $,l as L,u as r,ae as A,an as te,ao as oe,s as G,w as ne,e as se}from"./swiper-vue.397ea2eb.js";import{_ as W}from"./_plugin-vue_export-helper.c27b6911.js";import{_ as le}from"./index.vue.f6fe58b5.js";import{E as ae}from"./el-image-viewer.ad15677e.js";import{E as ie}from"./el-link.00e3f970.js";import{_ as Q}from"./index.vue.403e5f16.js";import{y as re,z as D,U as ue,A as Y,E as K,b as de,e as ce,g as pe}from"./entry.df16adda.js";import{u as me}from"./useAudioPlay.49014f22.js";import{u as fe}from"./useCopy.20b5e5cf.js";import{E as Z}from"./el-scrollbar.f4d658ff.js";import{E as F}from"./el-dialog.64289190.js";import{u as ve}from"./unique-id.302803f8.js";import{g as _e}from"./chat.e58126ff.js";import{E as he}from"./el-popper.89e34564.js";import"./el-tooltip.4ed993c7.js";const ye=["src"],ge={key:0,class:"h-[20px] mb-[10px] text-tx-secondary"},ke=V({__name:"item",props:{type:{default:"left"},avatar:{default:""},bg:{default:""},color:{default:"black"},time:{default:""}},setup(s){return X(e=>({"6b1c0865":e.color})),(e,_)=>(t(),l("div",{class:"chat-msg-item",style:ee(e.bg?`--item-bg: ${e.bg}`:"")},[c("div",{class:R(`chat-msg-item__${e.type}`)},[e.avatar?(t(),l("img",{key:0,class:"chat-msg-item__avatar",src:e.avatar},null,8,ye)):f("",!0),c("div",{class:R([`chat-msg-item__${e.type}-wrap`,{"has-time":e.time}])},[e.time?(t(),l("div",ge,w(e.time),1)):f("",!0),c("div",{class:R(`chat-msg-item__${e.type}-content`)},[j(e.$slots,"default",{},void 0,!0)],2),c("div",null,[j(e.$slots,"actions",{},void 0,!0)])],2)],2)],4))}});const rt=W(ke,[["__scopeId","data-v-5faf495b"]]),be="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAgCAYAAABgrToAAAACJElEQVRYR+2YMWsUURSFz3m7s+nskjUIQSutbMRi7WzUVjSadMHCbVLkByjmLygaCVYWRqMEUhkFS9Gg0cJfYCPZjYUQFbPs+I7c2R1Q2ZjZfRNYYS4MAzPv3vnmvDvL3kMA2Hl5/CjLI9ckf4ZwY3Zt15C+gfwIao3So0rt3XsJtPUk9M/cAW6y9ap2DIyfAjgCwANwGeoYiEFtk/5e5CvXeer1D2neATcGgiTZM4+t9RNLEKcBtAFEGeBsiRWzl7EoSXo+8rV9gWc/fDc1B1VSEoEnDpj0KTB33tS26DGaEezvZQZpRxmODyoT5+vwBwS3zeTcT4yjTdZNJEiPSykk1bjZX6HeD/WQJ1zUApgq2w+etcsniBuAVlH9vELOx6Yo1VywgkmTB4X1kEGGhyAtg/Ecq3NNqnknDwVTrNBaactEts88OHs5b8Bw/Tof4M+kr4WrwwhoL9n5uRPWhxWwsxPEl+EGNMacP5I8evCPGgVgqKSFgoWCoQqE5hc9WCgYqkBoftGDeSiYz1/+UJLe+foftvh2A2B1fwQIrapkaFoDcK4PVyH0qVnyU4fjGdW4NQ2WlgDE5hLkMoJmQdh9zW9Dk59K5lhtLjyE01TX/jDILP5MGEbvbFPOJroIXvc5PjvTBbx7GM4vAjjd9WdSc2g/IPaqaTv5Aq58haP1TSb2Au20GGErvgTxIqiTAA7tVSnn+2Z9vAXdCsa4bD6Nsf0C/gYA5PMzcW0AAAAASUVORK5CYII=",we={class:"h-[65vh]"},Ce={class:"font-medium text-tx-primary"},xe={class:"text-muted text-sm whitespace-pre-wrap"},Ae=V({__name:"context-popup",props:{context:{default:()=>[]}},emits:["close"],setup(s,{emit:e}){const _=e;return(y,u)=>{const g=Z,p=F;return t(),h(p,{title:`对话上下文(${y.context.length}条)`,"model-value":!0,width:"700px",onClose:u[0]||(u[0]=m=>_("close"))},{default:a(()=>[c("div",we,[v(g,null,{default:a(()=>[(t(!0),l(S,null,B(y.context,(m,b)=>(t(),l("div",{key:b,class:"py-[6px] px-[10px] border border-solid border-br-light rounded mb-[10px]"},[c("div",Ce,w(m.role),1),c("div",xe,w(m.content),1)]))),128))]),_:1})])]),_:1},8,["title"])}}}),Ee={class:"h-[65vh]"},Ie={key:0,class:"text-muted text-sm"},$e={key:1,class:"text-muted text-sm"},Se=V({__name:"quote-popup",props:{quotes:{default:()=>[]}},emits:["close"],setup(s,{emit:e}){const _=e;return(y,u)=>{const g=Z,p=F;return t(),h(p,{title:`知识库引用(${y.quotes.length}条)`,"model-value":!0,width:"700px",onClose:u[0]||(u[0]=m=>_("close"))},{default:a(()=>[c("div",Ee,[v(g,null,{default:a(()=>[(t(!0),l(S,null,B(y.quotes,(m,b)=>(t(),l("div",{key:b,class:"py-[6px] px-[10px] border border-solid border-br-light rounded mb-[10px]"},[m.question?(t(),l("div",Ie,w(m.question),1)):f("",!0),m.answer?(t(),l("div",$e,w(m.answer),1)):f("",!0)]))),128))]),_:1})])]),_:1},8,["title"])}}});function Be(s){return $request.post({url:"/KnowDialogue/shareAuth",params:s},{withToken:!1})}const Ve=re({id:"chatStore",state:()=>{const s=D(ue,"");return s.value||(s.value=ve()),{uuid:s.value||"",token:"",channelId:""}},getters:{isAuth:s=>!!s.token},actions:{init(s){this.channelId=s;const e=D(Y,{});this.token=e.value[this.channelId]||""},clearAuth(){const s=D(Y,{});delete s.value[this.channelId],this.token=""},async auth(s=""){const e=await Be({password:s,channel:this.channelId,identity:this.uuid});this.token=e.token;const _=D(Y,{});_.value=Object.assign({[this.channelId]:e.token},_.value)}}}),qe=s=>(te("data-v-28645e68"),s=s(),oe(),s),Te={class:"chat-content"},De={class:"chat-text"},Re={key:2,class:"flex flex-wrap mx-[-5px]"},Pe={key:3,class:"mt-[15px]"},ze=qe(()=>c("img",{class:"w-[18px] h-[14px] mr-2",src:be},null,-1)),Me={class:"line-clamp-1 mr-[10px]"},Ne={key:0,class:"mt-[10px]"},Ue=V({__name:"content",props:{type:{default:"text"},content:{default:""},context:{default:()=>[]},quotes:{default:()=>[]},images:{default:()=>[]},files:{default:()=>[]},typing:{type:Boolean,default:!1},lineNumbers:{type:Boolean,default:!0},showCopy:{type:Boolean,default:!1},showContext:{type:Boolean,default:!1},showQuote:{type:Boolean,default:!1},showVoice:{type:Boolean,default:!1},recordId:{default:0},index:{default:0},recordType:{default:1},channel:{default:""},userId:{default:""}},setup(s){Ve();const e=s,_=$(!1),y=$(!1),u=async()=>(await _e({records_id:e.recordId,content:e.index,type:e.recordType},{Authorization:e.channel,Identity:e.userId})).file,g=L(()=>e.images.map(({url:o})=>o)),{play:p,audioPlaying:m,pause:b,audioLoading:q}=me(),{copy:P}=fe();return(o,i)=>{var E;const z=le,M=ae,N=ie,I=Q,C=K;return t(),l("div",Te,[c("div",De,[o.type==="html"?(t(),h(z,{key:0,content:o.content,"line-numbers":o.lineNumbers,typing:o.typing},null,8,["content","line-numbers","typing"])):o.type==="text"?(t(),l("div",{key:1,class:R(["whitespace-pre-wrap text-lg",{"wait-typing":o.typing}])},w(o.content),3)):f("",!0),r(g).length?(t(),l("div",Re,[(t(!0),l(S,null,B(r(g),(k,n)=>(t(),h(M,{key:n,"preview-src-list":r(g),"preview-teleported":!0,infinite:!1,"initial-index":n,"hide-on-click-modal":!0,class:"w-[120px] h-[120px] mx-[5px] mt-[10px]",src:k,fit:"cover"},null,8,["preview-src-list","initial-index","src"]))),128))])):f("",!0),(E=o.files)!=null&&E.length?(t(),l("div",Pe,[(t(!0),l(S,null,B(o.files,(k,n)=>(t(),l("div",{key:n,class:"flex mb-[10px] items-center"},[ze,c("div",Me,w(k.name),1),v(N,{href:k.url,target:"_blank",type:"primary"},{default:a(()=>[A(" 下载 ")]),_:2},1032,["href"])]))),128))])):f("",!0)]),!o.typing&&(o.showCopy||o.showVoice||o.showQuote||o.showContext)?(t(),l("div",Ne,[o.showCopy?(t(),h(C,{key:0,link:"",onClick:i[0]||(i[0]=k=>r(P)(o.content))},{icon:a(()=>[v(I,{name:"el-icon-CopyDocument"})]),default:a(()=>[A(" 复制 ")]),_:1})):f("",!0),o.showVoice?(t(),l(S,{key:1},[r(m)?(t(),h(C,{key:0,link:"",onClick:r(b)},{icon:a(()=>[v(I,{name:"local-icon-audio_voice"})]),default:a(()=>[A(" 停止 ")]),_:1},8,["onClick"])):(t(),h(C,{key:1,link:"",loading:r(q),onClick:i[1]||(i[1]=k=>r(p)(u))},{icon:a(()=>[v(I,{name:"local-icon-audio_voice"})]),default:a(()=>[A(" 朗读 ")]),_:1},8,["loading"]))],64)):f("",!0),o.quotes.length&&o.showQuote?(t(),h(C,{key:2,link:"",type:"primary",onClick:i[2]||(i[2]=k=>y.value=!0)},{default:a(()=>[A(w(o.quotes.length)+"条引用 ",1)]),_:1})):f("",!0),o.context.length&&o.showContext?(t(),h(C,{key:3,link:"",type:"primary",onClick:i[3]||(i[3]=k=>_.value=!0)},{default:a(()=>[A(w(o.context.length)+"条上下文 ",1)]),_:1})):f("",!0)])):f("",!0),r(_)?(t(),h(Ae,{key:1,context:o.context,onClose:i[4]||(i[4]=k=>_.value=!1)},null,8,["context"])):f("",!0),r(y)?(t(),h(Se,{key:2,quotes:o.quotes,onClose:i[5]||(i[5]=k=>y.value=!1)},null,8,["quotes"])):f("",!0)])}}});const ut=W(Ue,[["__scopeId","data-v-28645e68"]]),Ye={class:"chat-action"},je={class:"p-[10px]"},Le={class:"mb-[10px] flex flex-wrap items-center"},We={class:"ml-[10px]"},Ge=V({__name:"index",props:{placeholder:{default:"请输入问题"},loading:{type:Boolean,default:!1},showManual:{type:Boolean,default:!1},menus:{default:()=>[]},btnColor:{default:"#fff"}},emits:["clear","pause","blur","focus","enter"],setup(s,{expose:e,emit:_}){const y=s,u=_,g=de(),p=$(""),m=G(),b=G(),q=$(!1),P=()=>{q.value=!1,u("blur")},o=()=>{q.value=!0,u("focus")},i=$(!1),z=L(()=>`${y.placeholder} ${g.isMobile?"":"（Shift + Enter）= 换行"}`),M=n=>{var d;if(!(n.shiftKey&&n.keyCode===13)&&!i.value&&n.keyCode===13)return(d=b.value)==null||d.blur(),u("enter",p.value),n.preventDefault()},N=L(()=>g.isMobile?{maxRows:4,minRows:1}:{maxRows:6,minRows:1}),I=$(!1),{height:C}=ce(m);let E=0;return ne(()=>{E===0&&(E=C.value),C.value>E&&(I.value=!0),p.value===""&&C.value>E&&(I.value=!1)}),e({setInputValue:(n="")=>{p.value=n},focus:()=>{var n;return(n=b.value)==null?void 0:n.focus()},blur:()=>{var n;return(n=b.value)==null?void 0:n.blur()}}),(n,d)=>{const U=Q,T=K,J=pe,O=he;return t(),l("div",Ye,[c("div",je,[c("div",Le,[j(n.$slots,"btn",{},void 0,!0),v(T,{color:n.btnColor,disabled:!n.loading,round:"",style:{"--el-button-disabled-text-color":"var(--el-button-text-color)"},onClick:d[0]||(d[0]=x=>u("pause"))},{icon:a(()=>[v(U,{name:"el-icon-VideoPause"})]),default:a(()=>[A(" 停止 ")]),_:1},8,["color","disabled"]),v(T,{color:n.btnColor,style:{"--el-button-disabled-text-color":"var(--el-button-text-color)"},disabled:n.loading,round:"",onClick:d[1]||(d[1]=x=>u("clear"))},{icon:a(()=>[v(U,{name:"el-icon-Delete"})]),default:a(()=>[A(" 清空 ")]),_:1},8,["color","disabled"]),(t(!0),l(S,null,B(n.menus,(x,H)=>(t(),h(T,{color:n.btnColor,style:{"--el-button-disabled-text-color":"var(--el-button-text-color)"},disabled:n.loading,round:"",onClick:Qe=>u("enter",x.keyword),key:H},{default:a(()=>[A(w(x.keyword),1)]),_:2},1032,["color","disabled","onClick"]))),128))]),c("div",{ref_key:"textContainerRef",ref:m,class:"relative text-container flex items-center"},[v(J,{ref_key:"textareaRef",ref:b,modelValue:r(p),"onUpdate:modelValue":d[2]||(d[2]=x=>se(p)?p.value=x:null),type:"textarea",disabled:n.loading,autosize:r(N),placeholder:r(z),resize:"none",onCompositionstart:d[3]||(d[3]=x=>i.value=!0),onCompositionend:d[4]||(d[4]=x=>i.value=!1),onKeydown:M,onBlur:P,onFocus:o},null,8,["modelValue","disabled","autosize","placeholder"]),c("div",We,[v(O,{content:"发送（enter）",placement:"top",disabled:r(g).isMobile},{default:a(()=>[v(T,{disabled:!r(p)||n.loading,size:"large",type:"primary",onClick:d[5]||(d[5]=x=>u("enter",r(p)))},{default:a(()=>[v(U,{name:"el-icon-Promotion",size:20})]),_:1},8,["disabled"])]),_:1},8,["disabled"])])],512)])])}}});const dt=W(Ge,[["__scopeId","data-v-b595820f"]]);export{rt as _,dt as a,ut as b};
