import{a as Se,E as ke}from"./el-menu.5bfff4ee.js";import{E as Ie}from"./el-scrollbar.f4d658ff.js";import{a as Ee,b as Ce,c as Ve,d as be,cl as Le,f as N,j as Re,E as $e,_ as Me}from"./entry.df16adda.js";import{k as Ue,a as y,r as oe,ah as K,b as j,j as De,I as h,J as z,a2 as f,ax as Ne,u as o,a0 as m,$ as R,ae,K as $,Z as le,ap as Ke,e as E,Y as A,aG as ze,aH as Ae,a4 as Te,n as Fe}from"./swiper-vue.397ea2eb.js";import{E as qe}from"./el-drawer.a696086e.js";import"./el-tooltip.4ed993c7.js";import"./el-popper.89e34564.js";import{u as T}from"./asyncData.10050198.js";import{u as Be}from"./useLockFn.a803ddfa.js";import re from"./create-panel.2bb06aa0.js";import ne from"./create-results.d3bd24d0.js";import{_ as se}from"./model-select.vue.788e7aea.js";import{c as He,a as Oe,b as je}from"./chat.e58126ff.js";import{g as Pe,a as Ge,b as Je}from"./create.257daca9.js";import{u as Ye}from"./recharge.98a08a81.js";import{c as ie}from"./cloneDeep.8862a013.js";import{_ as Ze}from"./_plugin-vue_export-helper.c27b6911.js";import"./use-dialog.825901d5.js";import"./index.vue.403e5f16.js";import"./el-form-item.f85b8636.js";import"./_baseClone.000a3762.js";import"./_getTag.af7a9d71.js";/* empty css                */import"./el-select.b349f79d.js";import"./strings.294b5976.js";import"./isEqual.b93d80e7.js";import"./debounce.2369182b.js";import"./el-tag.7a8069da.js";import"./el-radio-group.1cf97d3f.js";/* empty css                        */import"./index.6edb46f6.js";import"./index.vue.a507811b.js";import"./useQuery.59804ae0.js";import"./index.vue.f6fe58b5.js";import"./useCopy.20b5e5cf.js";import"./useAudioPlay.49014f22.js";import"./el-tabs.bf76dc43.js";import"./el-empty.941f3aa6.js";import"./index.vue.b9ae65fe.js";import"./position.a44f3ead.js";import"./throttle.92cc074e.js";import"./nuxt-link.ee69c354.js";const Xe=(C,l="yyyy-mm-dd")=>{C||(C=Number(new Date)),C.toString().length===10&&(C*=1e3);const i=new Date(C);let u;const V={"y+":i.getFullYear().toString(),"m+":(i.getMonth()+1).toString(),"d+":i.getDate().toString(),"h+":i.getHours().toString(),"M+":i.getMinutes().toString(),"s+":i.getSeconds().toString()};for(const _ in V)u=new RegExp(`(${_})`).exec(l),u&&(l=l.replace(u[1],u[1].length===1?V[_]:V[_].padStart(u[1].length,"0")));return l},Qe={class:"flex flex-col h-full w-[150px] text-tx-primary category"},We={class:"w-[20px] h-[20px] mr-[6px]"},et=["src"],tt={class:"h-full p-main sm:flex overflow-hidden"},ot={class:"h-full bg-white flex rounded-[20px] overflow-hidden"},at=Ue({__name:"produce",async setup(C){let l,i;const u=y(""),V=Ee();Ye();const _=y(!0),P=y([]),d=y({}),k=Ce(),de=Ve(),F=be(),{cateId:ue,modelId:pe}=V.query,x=y("current"),n=oe({cateId:ue||"0",modelId:pe,modelKey:""}),ce=async t=>{n.cateId=t,await J();const[e]=D.value||[];F.replace({path:"",query:{cateId:t,modelId:e==null?void 0:e.id}})},{data:q,pending:lt,refresh:rt}=([l,i]=K(()=>T(()=>Pe(),{default(){return[]}},"$3iMOmfmgi4")),l=await l,i(),l),M=y(!1),G=y(0),me=t=>{G.value=t.activeIndex};let U=null;const fe=t=>{U=t},L=t=>{try{U==null||U.slideTo(t)}catch(e){console.error(e)}},{data:D,refresh:J}=([l,i]=K(()=>T(()=>Ge({keyword:u.value,category_id:n.cateId}),{lazy:!0},"$VSSSR0UZJy")),l=await l,i(),l);Le(u,t=>{J()},{debounce:500});const Y=async()=>{await N.confirm("确定清空创作记录？"),await He({type:2,other_id:n.modelId}),c.value=[],B()},{data:b,refresh:ve}=([l,i]=K(()=>T(()=>Je({id:n.modelId}),{default(){return{}},transform(t){return t}},"$dzxelPzSXF")),l=await l,i(),l),p=oe({pageNo:1,count:0,pageSize:15,lists:[]}),{refresh:Z,pending:ge}=([l,i]=K(()=>T(()=>Oe({other_id:n.modelId||0,page_size:p.pageSize,page_no:p.pageNo,type:2}),{default(){return[]},transform(t){p.count=t.count;const e=t.lists.map(s=>{let g="";if(Re(s.ask)){const I=(s==null?void 0:s.ask[0])||{};g=`${I.title}：${I.value}`}else g=s.ask;return{...s,title:g}});return p.pageNo===1&&(p.lists=[]),p.lists.push(...e),e}},"$T4LGrdB7sx")),l=await l,i(),l),B=()=>{Object.assign(p,{pageNo:1,count:0,pageSize:15,lists:[]}),Z()},X=()=>{ge.value||p.count>=p.pageNo*p.pageSize&&(p.pageNo++,Z())},Q=t=>{n.modelId=t.id},{lockFn:W}=Be(async t=>{t.extra&&(d.value=t.extra,await Fe(),H())}),ee=()=>{var t,e;(e=(t=b.value)==null?void 0:t.form)==null||e.forEach(s=>{s.props.placeholder&&!s.props.defaultValue&&(d.value[s.props.field]=s.props.placeholder)})},ye=()=>{var t;(t=b.value)==null||t.form.forEach(e=>{e.props.defaultValue?d.value[e.props.field]=ie(e.props.defaultValue):d.value[e.props.field]=void 0})},he=()=>{_.value?(_.value=!1,P.value=[]):(P.value=q.value.map(t=>t.id),_.value=!0)},c=y([]),_e=()=>{var e;const t=((e=b.value)==null?void 0:e.form[0])||{};return`${t.props.title}：${d.value[t.props.field]||""}`},v=y(!1);let r;const H=async()=>{if(!v.value){x.value="current",v.value=!0,c.value=[],L(1);try{r=je({other_id:n.modelId,question:d.value,type:2,model:n.modelKey}),r.addEventListener("close",async()=>{de.getUser(),setTimeout(()=>{v.value=!1,B()},200)}),r.addEventListener("error",async t=>{var e;if(((e=t.data)==null?void 0:e.code)===1100){k.getIsShowRecharge?(await N.confirm(`${k.getTokenUnit}数量已用完，请前往充值`),F.push("/recharge")):N.msgError(`${k.getTokenUnit}数量已用完。请联系客服增加`);return}t.errorType==="connectError"&&N.msgError("请求失败，请重试"),setTimeout(()=>{v.value=!1,L(0)},200)}),r.addEventListener("chat",({data:t})=>{const{id:e,event:s,data:g,code:I,index:w}=t;let S=c.value.findIndex(O=>O.id===e);S===-1&&(c.value.push({create_time:Xe(Date.now(),"yyyy-mm-dd hh:MM:ss"),title:d.value.question?d.value.question:_e(),reply:[],extra:ie(d.value),id:e}),S=c.value.length-1),g&&(c.value[S].reply[w]||(c.value[S].reply[w]=""),c.value[S].reply[w]+=g)}),r.addEventListener("finish",({data:t})=>{const{data:e,index:s,id:g}=t,I=c.value.findIndex(w=>w.id===g);e&&(c.value[I].reply[s]+=e),ye()})}catch{v.value=!1}}};j(q,t=>{_.value=!1,he()},{immediate:!0});const te=()=>{r==null||r.removeEventListener("close"),r==null||r.removeEventListener("chat"),r==null||r.removeEventListener("error"),r==null||r.removeEventListener("finish"),r==null||r.abort(),v.value=!1};return j(()=>V.query,({cateId:t,modelId:e})=>{n.cateId=t,n.modelId=e,c.value=[],x.value="current",L(0),te(),e?(ve(),B()):b.value={}}),j(()=>D.value,t=>{t.length&&n.modelId==null&&F.replace({path:"",query:{cateId:n.cateId,modelId:t[0].id}})},{deep:!0}),De(()=>{te()}),(t,e)=>{const s=ke,g=Se,I=Ie,w=$e,S=ze,O=Ae,xe=qe,we=Me;return h(),z("div",null,[f(we,{name:"default"},Ne({panel:m(()=>[$("div",Qe,[f(I,null,{default:m(()=>[f(g,{"default-active":o(n).cateId,onSelect:ce},{default:m(()=>[(h(!0),z(le,null,Ke(o(q),a=>(h(),R(s,{key:a.id,index:String(a.id)},{default:m(()=>[$("div",We,[a.image?(h(),z("img",{key:0,class:"w-full h-full",src:a.image,alt:""},null,8,et)):A("",!0)]),$("span",null,Te(a.name),1)]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),_:1})])]),default:m(()=>[$("div",tt,[o(k).isMobile?A("",!0):(h(),z(le,{key:0},[$("div",ot,[f(se,{modelValue:o(u),"onUpdate:modelValue":e[2]||(e[2]=a=>E(u)?u.value=a:null),"model-state":o(n),"current-model-list":o(D),onSelect:Q},null,8,["modelValue","model-state","current-model-list"]),f(re,{modelValue:o(d),"onUpdate:modelValue":e[3]||(e[3]=a=>E(d)?d.value=a:null),"model-key":o(n).modelKey,"onUpdate:modelKey":e[4]||(e[4]=a=>o(n).modelKey=a),class:"2xl:w-[400px] xl:w-[350px] lg:w-[320px] w-[250px]","model-data":o(b),loading:o(v),onInsert:ee,onCreate:H},null,8,["modelValue","model-key","model-data","loading"])]),f(ne,{current:o(x),"onUpdate:current":e[5]||(e[5]=a=>E(x)?x.value=a:null),"current-creation-history":o(c),loading:o(v),"page-info":o(p),onLoad:X,onClean:Y,onRewrite:o(W)},null,8,["current","current-creation-history","loading","page-info","onRewrite"])],64)),o(k).isMobile?(h(),R(O,{key:1,"slides-per-view":1,class:"h-full w-full",direction:"vertical","allow-touch-move":!1,onActiveIndexChange:me,onSwiper:fe},{default:m(()=>[f(S,null,{default:m(()=>[f(re,{modelValue:o(d),"onUpdate:modelValue":e[6]||(e[6]=a=>E(d)?d.value=a:null),"model-key":o(n).modelKey,"onUpdate:modelKey":e[7]||(e[7]=a=>o(n).modelKey=a),class:"h-full bg-white flex rounded-[20px] overflow-hidden","model-data":o(b),loading:o(v),onInsert:ee,onCreate:H,onSelect:e[8]||(e[8]=a=>M.value=!0)},null,8,["modelValue","model-key","model-data","loading"])]),_:1}),f(S,null,{default:m(()=>[f(ne,{current:o(x),"onUpdate:current":e[9]||(e[9]=a=>E(x)?x.value=a:null),"current-creation-history":o(c),loading:o(v),"page-info":o(p),onLoad:X,onClean:Y,onRewrite:o(W)},null,8,["current","current-creation-history","loading","page-info","onRewrite"])]),_:1})]),_:1})):A("",!0),o(k).isMobile?(h(),R(xe,{key:2,modelValue:o(M),"onUpdate:modelValue":e[11]||(e[11]=a=>E(M)?M.value=a:null),"custom-class":"model-select-drawer",title:"选择模型",size:"60%"},{default:m(()=>[f(se,{modelValue:o(u),"onUpdate:modelValue":e[10]||(e[10]=a=>E(u)?u.value=a:null),"model-state":o(n),"current-model-list":o(D),onSelect:Q},null,8,["modelValue","model-state","current-model-list"])]),_:1},8,["modelValue"])):A("",!0)])]),_:2},[o(k).isMobile?{name:"header",fn:m(()=>[o(G)==0?(h(),R(w,{key:0,link:"",type:"primary",onClick:e[0]||(e[0]=a=>L(1))},{default:m(()=>[ae(" 创作历史 ")]),_:1})):(h(),R(w,{key:1,link:"",type:"primary",onClick:e[1]||(e[1]=a=>L(0))},{default:m(()=>[ae(" 创作页面 ")]),_:1}))]),key:"0"}:void 0]),1024)])}}});const Jt=Ze(at,[["__scopeId","data-v-63fba022"]]);export{Jt as default};
