import{_ as Y}from"./index.ae25ad6e.js";import{a as W,b as ee,_ as te}from"./index.e1737bf1.js";import{_ as se}from"./index.vue.403e5f16.js";import{y as oe,b as ne,c as ae,d as ie,e as re,w as le,f as x,_ as ce,E as de}from"./entry.df16adda.js";import{_ as pe}from"./index.vue.a507811b.js";import{u as z}from"./asyncData.10050198.js";import{u as ue}from"./useCopy.20b5e5cf.js";import me from"./sample-lists.2b207b48.js";import{e as fe,f as _e,h as he,i as ge,j as ye,a as Se,c as ve,b as we}from"./chat.e58126ff.js";import{E as Ce}from"./el-scrollbar.f4d658ff.js";import{k as xe,s as j,a as D,ah as F,b as Le,E as ke,n as Ee,j as be,I as u,J as w,a2 as m,ax as Te,u as s,a0 as p,K as v,a4 as Ie,Z as P,ap as H,e as Re,$,ae as Ae,Y as Z,_ as Ve}from"./swiper-vue.397ea2eb.js";import"./_plugin-vue_export-helper.c27b6911.js";import"./index.vue.f6fe58b5.js";import"./el-image-viewer.ad15677e.js";import"./throttle.92cc074e.js";import"./debounce.2369182b.js";import"./position.a44f3ead.js";import"./el-link.00e3f970.js";import"./useAudioPlay.49014f22.js";import"./el-dialog.64289190.js";import"./use-dialog.825901d5.js";import"./refs.2a024717.js";import"./unique-id.302803f8.js";import"./el-popper.89e34564.js";import"./el-tooltip.4ed993c7.js";import"./el-select.b349f79d.js";import"./strings.294b5976.js";import"./isEqual.b93d80e7.js";import"./_getTag.af7a9d71.js";import"./el-tag.7a8069da.js";import"./useQuery.59804ae0.js";import"./el-tabs.bf76dc43.js";const De=oe({id:"dialogueSate",state:()=>({sessionId:"",sessionLists:[]}),getters:{getCurrentSession:n=>n.sessionLists.find(f=>String(f.id)===String(n.sessionId))||{}},actions:{setSessionId(n=""){this.sessionId=String(n)},setSessionSelect(n){n||([n]=this.sessionLists),this.setSessionId((n==null?void 0:n.id)||"")},async getSessionLists(){const n=await fe({page_type:0});return this.sessionLists=n.lists||[],this.sessionLists},async sessionAdd(){await _e({}),await this.getSessionLists(),this.setSessionSelect()},async sessionEdit(n){await he({...n}),await this.getSessionLists()},async sessionClear(){await ge(),await this.getSessionLists(),this.setSessionSelect()},async sessionDelete(n){await ye({id:n}),await this.getSessionLists(),this.setSessionSelect()}}}),$e={class:"line-clamp-1"},Be={class:"h-full flex flex-col"},Ue={class:"flex-1 min-h-0"},Ne={class:"p-main"},Me={class:"my-[5px]"},ze={key:1,class:"max-w-[1000px] mx-auto"},je={class:"mb-[10px]"},Fe={class:"mr-[10px]"},vt=xe({__name:"index",async setup(n){let f,L;const g=ne(),_=ae(),k=j(),e=De(),q=ie(),E=D(""),{copy:G}=ue();[f,L]=F(()=>z(()=>e.getSessionLists(),"$Xp0jUNBkTp")),await f,L(),e.setSessionSelect();const{data:h,refresh:I}=([f,L]=F(()=>z(()=>Se({type:1,category_id:e.sessionId,page_type:0}),{transform(a){return a.lists||[]},default(){return[]},lazy:!1},"$QNzZSPGkTt")),f=await f,L(),f),J=async()=>{if(!_.isLogin)return _.toggleShowLogin();e.sessionId&&(await x.confirm("确定清空记录？"),await ve({category_id:e.sessionId,type:1}),I())},K=()=>{var a;if(!_.isLogin)return(a=k.value)==null||a.blur(),_.toggleShowLogin();C()};let t=null;const y=D(!1);let R=!1;const B=async(a,i="input")=>{var b;if(!_.isLogin)return _.toggleShowLogin();if(!a)return x.msgError("请输入问题");if(y.value)return;const S=Date.now();y.value=!0,h.value.push({type:1,content:a}),h.value.push({type:2,typing:!0,content:[""],key:S}),(b=k.value)==null||b.setInputValue();const r=h.value.find(l=>l.key===S);e.sessionId||(R=!0,await e.sessionAdd(),R=!1),e.getCurrentSession.name==="新的会话"&&await e.sessionEdit({id:e.sessionId,name:a}),t=we({type:1,other_id:e.sessionId,question:a,model:E.value}),t.addEventListener("chat",({data:l})=>{const{data:c,index:d}=l;r.content[d]||(r.content[d]=""),r.content[d]+=c}),t.addEventListener("finish",({data:l})=>{const{data:c,index:d}=l;c&&(r.content[d]+=c)}),t.addEventListener("close",async()=>{await _.getUser(),setTimeout(async()=>{await I(),y.value=!1,r.typing=!1,C()},600)}),t.addEventListener("error",async l=>{var c,d;if(((c=l.data)==null?void 0:c.code)===1100){g.getIsShowRecharge?(await x.confirm(`${g.getTokenUnit}数量已用完，请前往充值`),q.push("/recharge")):x.msgError(`${g.getTokenUnit}数量已用完。请联系客服增加`);return}l.errorType==="connectError"&&x.msgError("请求失败，请重试"),["connectError","responseError"].includes(l.errorType)&&(h.value.splice(h.value.length-2,2),i==="input"&&((d=k.value)==null||d.setInputValue(a))),r.typing=!1,setTimeout(()=>{y.value=!1},200)})},A=j(),U=D(),C=async()=>{var i,S,r;const a=(S=(i=A.value)==null?void 0:i.wrapRef)==null?void 0:S.scrollHeight;(r=A.value)==null||r.setScrollTop(a)},{height:O}=re(U);le(O,()=>{y.value&&C()},{immediate:!0});const N=()=>{t==null||t.removeEventListener("chat"),t==null||t.removeEventListener("close"),t==null||t.removeEventListener("error"),t==null||t.removeEventListener("finish"),t==null||t.abort(),y.value=!1};return Le(()=>e.sessionId,async()=>{R||(N(),await I(),C())}),ke(async()=>{await Ee(),h.value.length&&C()}),be(()=>{N()}),(a,i)=>{const S=Y,r=ee,b=se,l=de,c=te,d=pe,Q=W,X=ce;return u(),w("div",null,[m(X,{name:"default"},Te({panel:p(()=>[m(S,{modelValue:s(e).sessionId,"onUpdate:modelValue":i[0]||(i[0]=o=>s(e).sessionId=o),data:s(e).sessionLists,onAdd:s(e).sessionAdd,onEdit:s(e).sessionEdit,onDelete:s(e).sessionDelete,onClear:s(e).sessionClear,onClickItem:s(e).setSessionSelect},null,8,["modelValue","data","onAdd","onEdit","onDelete","onClear","onClickItem"])]),default:p(()=>[v("div",Be,[v("div",Ue,[m(s(Ce),{ref_key:"scrollbarRef",ref:A},{default:p(()=>[v("div",Ne,[s(h).length?(u(),w("div",{key:0,ref_key:"innerRef",ref:U,class:"sm:px-[20px]"},[(u(!0),w(P,null,H(s(h),(o,T)=>(u(),w("div",{key:o.id+""+T,class:"mt-4 sm:pb-[20px]"},[o.type==1?(u(),$(c,{key:0,type:"right",avatar:s(_).userInfo.avatar,color:"white"},{actions:p(()=>[v("div",Me,[m(l,{link:"",type:"info",onClick:M=>s(G)(o.content)},{icon:p(()=>[m(b,{name:"el-icon-CopyDocument"})]),default:p(()=>[Ae(" 复制 ")]),_:2},1032,["onClick"])])]),default:p(()=>[m(r,{content:o.content},null,8,["content"])]),_:2},1032,["avatar"])):Z("",!0),o.type==2?(u(),$(c,{key:1,type:"left",avatar:s(g).getChatConfig.chat_logo,time:o.create_time},{default:p(()=>[(u(!0),w(P,null,H(o.content,(M,V)=>(u(),$(r,{key:V,content:M,type:"html",typing:o.typing,"line-numbers":!s(g).isMobile,"show-copy":"","show-voice":s(g).getIsVoiceOpen,class:Ve(["mb-[15px] last-of-type:mb-0",{"pt-[15px] border-t border-solid border-br-light":V>0}]),index:V,"record-id":o.id},null,8,["content","typing","line-numbers","show-voice","class","index","record-id"]))),128))]),_:2},1032,["avatar","time"])):Z("",!0)]))),128))],512)):(u(),w("div",ze,[m(me,{onClickItem:i[1]||(i[1]=o=>B(o,"sample"))})]))])]),_:1},512)]),v("div",je,[m(Q,{ref_key:"chatActionRef",ref:k,loading:s(y),onEnter:B,onClear:J,onPause:i[3]||(i[3]=o=>{var T;return(T=s(t))==null?void 0:T.abort()}),onFocus:K},{btn:p(()=>[v("div",Fe,[m(d,{class:"min-w-[280px]",modelValue:s(E),"onUpdate:modelValue":i[2]||(i[2]=o=>Re(E)?E.value=o:null)},null,8,["modelValue"])])]),_:1},8,["loading"])])])]),_:2},[s(g).isMobile?{name:"header",fn:p(()=>{var o;return[v("div",$e,Ie((o=s(e).getCurrentSession)==null?void 0:o.name),1)]}),key:"0"}:void 0]),1024)])}}});export{vt as default};
